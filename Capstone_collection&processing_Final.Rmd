---
title: "Capstone_Dataprocess"
output: html_document
date: "2023-05-04"
---

#Packages
```{r}
library(plyr)
library(tidyverse)
library(readxl)
library(data.table) 
library(httr)
library(jsonlite)
library(xml2)
library(XML)
library(methods)
library(svMisc)
library(googleLanguageR)
library(countrycode)
library(xml2)
library(cld3)
library(tibble)
library(stringr)
library(conflicted)
library(extrafont)
library(gt)
library(gtsummary)
conflicts_prefer(dplyr::filter)
conflicts_prefer(dplyr::mutate)
conflicts_prefer(dplyr::rename)
conflicted::conflicts_prefer(dplyr::arrange)
conflicted::conflicts_prefer(dplyr::summarise)
conflicted::conflicts_prefer(dplyr::summarize)
`%!in%` = Negate(`%in%`)
loadfonts(device = "win")
```




#Downloading Data from SHAB
The following code chunks were used to download the data on which the study is based. Note that all of these steps were executed separately for all four years investigated (2019-2022). Apart from the labels of the data frames (19,20,21,22) the code was identical for all of the years and it is thus only presented once.

##Step 1: Capture the list of all new entries from a given year via the API
```{r}
#Challenge in capturing all observations via the SHAB REST API: We cannot request all 50000+ obeservations for the entire year in one go as this would overload the API. The following code is thus implementing sequential requesting

#Creating a dataframe that entails all dates of a year. Leapyears are automatically detected by R
dates <- seq(as.Date("2021-01-01"), as.Date("2021-12-31"), by = "day")
date_strings <- format(dates, "%Y-%m-%d")
date_df <- data.frame(date = date_strings, stringsAsFactors = FALSE)

#Creating corresponding api-links
date_df <- date_df %>% 
  mutate(api_link = paste0("https://amtsblattportal.ch/api/v1/publications/xml?publicationDate.start=", date, "&publicationDate.end=", date, "&publicationStates=PUBLISHED&pageRequest.size=1000&pageRequest.sortOrders=column:PUBLICATION_DATE%7Cdirection:DESC&subRubrics=HR01"))



#Creating a function to iterate over the list of api-links split by dates
get_listofpub <- function(api_link) {
  pub_data = read_xml(api_link)
  pub_xml <<- xmlParse(pub_data)
  df_pub_meta <<- xmlToDataFrame(nodes=getNodeSet(pub_xml, "//meta"))
  df_pub_list[[api_link]] <<- df_pub_meta
  print("Iteration done")
  Sys.sleep(5)
}


#Iterate over the dataframes of dates using the function
df_pub_list <- list()
purrr::walk(date_df$api_link, get_listofpub)

  
#Investigating whether there were potentially days with more than 1000 new entries! This would mean we would lose observations at one should not request more than 1000 entries at once from the API
View(df_pub_list)

#No days with more than 1000 new entries -> dataset is thus complete. This method manages to recover the number of observations obtained through the manual download of csv-files via the webpage

#Stiching the data-frames together
shab19_raw <- do.call(rbind.fill, df_pub_list)


#Saving dataset
write_rds(shab21_raw, "shab21_raw.rds")

#Investigating wether there were days with more than 1000 new entries II -> No day with close to 1000 entries
max(table(shab21_raw$publicationDate))

```


##Step 1: Alternative: Read in csv's downloaded from webpage. One can manually download CSV's from the SHAB-page with 3000 entries each and stich them together. This approach takes more time than the one presented above, but it works independently from the API.
```{r, eval = FALSE}
files <- list.files(pattern = ".csv")
temp <- lapply(files, fread, sep=";")
shab22 <- rbindlist(temp)

#Save data as rds-file
write_rds(shab22, "shab22.Rds")
```

##Step 2: Get details for every new entry in a given year
After one has downloaded the list of all new entries for a given year one has to call the API again to get all of the data for a specific observation. This step recovers the publication-text for each of the new firms, which is the key information our study builds upon.

###Step 2.1: Preparation for API-Retrieval of observations
```{r}
#Reading in the dataframe created in the previous step
shab21 <- readRDS("shab21_raw.Rds")

#Creating api-urls with ids (used for api retrieval)
shab21 <- shab21 %>% mutate(
  api_link =  sub("^", "https://amtsblattportal.ch/api/v1/publications/", id ),
  api_link =  sub("$", "/xml", api_link)
)
```


###Step 2.2: API-Retrieval of observations
```{r}
#Getting the data for the Full dataset -> Execution time for 1000 cases -> 05:50Mins.

#Defining a function to interact with the API
get_fulldata_byurl <- function(api_link) {
  single_data <<- read_xml(api_link) #Calling the api
  single_xml <<- xmlParse(single_data) #Creating a structure that is readable for r
  df_single_meta <<- xmlToDataFrame(nodes=getNodeSet(single_xml, "//meta")) #Converting meta data to dataframe
  df_single_content <<- xmlToDataFrame(nodes=getNodeSet(single_xml, "//content")) #Converting content data to dataframe
  shab19_meta_list[[api_link]] <<- df_single_meta
  shab19_content_list[[api_link]] <<- df_single_content
}


#Creating packs of 500 to ensure a stable API-connection
shab19_packlist <- split(shab21 , (seq(nrow(shab19))-1) %/% 500) 
#Code snipet to break list into parts. Note: Real collection was done by splitting the list into several pieces. The reason for this were unexpected HTTP-Errors that halted the collection after some time.
shab19_packlist <- shab21_packlist[81:90]


#Applying the whole process to each pack
frames2 <- list()

#Iterate over the items in shab22_packlist
for (i in seq_along(shab_packlist)) {
  shab21_meta_list <- list()
  shab21_content_list <- list()
  purrr::walk(shab21_packlist[[i]]$api_link, get_fulldata_byurl)
  
  #Combine the metadata and content into separate data frames and then into a single one
  shab21_1meta <- do.call(rbind.fill, shab21_meta_list)
  shab21_1content <- do.call(rbind.fill, shab21_content_list)
  shab21_mc <- cbind(shab21_1meta, shab21_1content)
  frames2[[i]] <- shab21_mc
  
  #Pause for 10 seconds to prevent API-Overloading and print a message in the console
  Sys.sleep(10)
  print(paste0("Iteration ", i, " done"))
}


capture.output(frames5, file = "frames5.csv")


#Stiching the lists together into one dataframe. This step was necessary as the API had performance issues and sometimes stoped the downloading process. The previous process was however saved in the list. We thus only had to restart the process for the observations that were not yet captured and save them in a new list (frames, frames1, frames2), which were then stiched together.
shab21_comp <- do.call(rbind, lapply(list(frames, frames1, frames2), function(lst) do.call(rbind, lapply(lst, as.data.frame))))


#Check for duplicated observations
length(unique(shab21_comp$id))
#50545 unique rows, thus no duplicates


#Testing if all observations present in shab21_raw are also present in the new dataframe
all_present <- all(shab21_raw$id %in% shab21_comp$id)
all_present
#All ids in raw dataset present in new dataset


#Saving complete dataframe as rds and csv
write.csv(shab21_comp, "shab21_complete.csv")
write_rds(shab21_comp, "shab21_complete.Rds")
```

#Data extraction
The following code chunks implement the data cleaning (as described in section 5.1 of the study). The process is the same for every year, but with some minor manual adjustments, which is why the process is presented for each year separately.

##2019
```{r}
#First, we read in the data that has been collected from the API and load another data frame with lists of country names that will be needed later.
shab19_comp <- readRDS("shab19_complete.Rds")
countries <- readRDS("countries.RDS")

#Adjusting countries-datasets
##This step is necessary, since some names are missing in the list. They are manually added here.
countries2 <- countries |> select(country.name.fr)
new_row1 <- data.frame(country.name.fr = "Grande-Bretagne")
new_row2 <- data.frame(country.name.fr = "Mauritius")
new_row3 <- data.frame(country.name.fr = "Etats-Unis d'Amérique")
new_row4 <- data.frame(country.name.fr = "Arabie Saoudite")
countries <- rbind(countries2, new_row1, new_row2, new_row3)


#Part-function that is necessary to find countries in strings of french-speaking cantons
find_country <- function(string, country_names) {
  for (country_name in country_names) {
    if (!is.na(country_name) && str_detect(string, country_name)) {
      return(country_name)
    }
  }
  return(NULL)
}



#Function to extract nationalities from the owner-column
##This function examines the later established "owner_info_cleaned" variable and looks for certain keywords which are followed by the nationality of an individual. Since the structure of the entries of some French-speaking cantons are different (and the keywords are missing there), the function checks whether a country from the list above is mentioned in the text.
extract_nationalities <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
      
      if (is.na(nationality)) {
        #Search for the country in the given column
        nationality <- find_country(owner, country_names)
        
        if (is.null(nationality)) {
          nationalities <- append(nationalities, "Swiss")
        } else {
          nationalities <- append(nationalities, nationality)
        }
      } else {
        nationalities <- append(nationalities, nationality)
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}



#Function with company
##Same function as before basically, but since for example auditors and other companies can be mentioned as founders in the text, this function checks for the "CHE"-number (specific number to identify a certain company) in the text. This step ensures that companies are not falsely identified as individuals.
extract_nationalities22 <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
      #Check if one of the owners is a company
      if (grepl("\\(CHE-\\d+\\.\\d+\\.\\d+\\)", owner)) {
        nationalities <- append(nationalities, "Company")
      } else {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
        
        if (is.na(nationality)) {
          #Search for the country in the given column
          nationality <- find_country(owner, country_names)
          
          if (is.null(nationality)) {
            nationalities <- append(nationalities, "Swiss")
          } else {
            nationalities <- append(nationalities, nationality)
          }
        } else {
          nationalities <- append(nationalities, nationality)
        }
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}




#Applying the custom functions to the owner_info_cleaned column and select other information from the publication text (like for example the company name) and save it in a new variable.
##The crucial owner_info_cleaned section is also established in this section. This variable tries to extract only the part of the publication text where the founders are mentioned.
df <- shab19_comp %>%
  mutate(
    company_name = str_extract(publicationText, "^[^,]+"),
    location = ifelse(
      str_detect(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      str_extract(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      ifelse(
        str_detect(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), 
        str_extract(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), NA
      )
    ), 
    
        is_ag_or_sa = as.integer(str_detect(company_name, "\\b(AG|SA|ag|s.a.|sa)\\b")),
    
    is_kollektivgesellschaft = as.integer(str_detect(publicationText, "\\b(Kollektivgesellschaft|KLG|SNC|société en nom collectif|snc|klg|kollektivgesellschaft|Société en nom collectif|società collettiva)\\b")),
    
    is_kommanditgesellschaft = as.integer(str_detect(publicationText, "\\b(Kommanditgesellschaft|KMG|SCM|société en commandite|scm|KmG|kommanditgesellschaft|Société en commandite|società in accomandita)\\b")),
    
    is_einzelunternehmen = as.integer(str_detect(publicationText, "\\b(Einzelunternehmen|entreprise individuelle|einzelunternehmen|impresa individuale|ditta individuale)\\b")),
    
    is_gmbh = as.integer(str_detect(company_name, "\\b(GmbH|Sàrl|Srl|SAGL|Sagl|SARL|sàrl|SàRL|SÀRL)\\b")),
    
    is_gmbh2 = as.integer(str_detect(publicationText, "\\b(Gesellschaft mit beschränkter Haftung|società a garanzia limitata)\\b")),
    
    is_stiftung = as.integer(str_detect(publicationText, "\\b(Stiftung|Fondation|Fondazione)\\b")),
    
    is_verein = as.integer(str_detect(publicationText, "\\b(Verein|Association|association|Associazione|associazione)\\b")),
    
    is_genossenschat = as.integer(str_detect(publicationText, "\\b(Genossenschaft|société coopérative|Société Coopérative)\\b")),
    
    company_as_founder = as.integer(str_detect(publicationText, "\\b(Firma Hauptsitz|Société anonyme|société anonyme|Ditta della sede principale)\\b")),
    
   owner_info = str_extract(publicationText, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personnes inscrites|Personne incrite|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*)(.*?)\\s*(?=\\sbut|\\sBut|$)"),
   
    owner_info_cleaned = str_trim(str_replace(owner_info, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personne incrite|Personnes inscrites|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*) ?", "")), 
   
    owner_nationality = sapply(owner_info_cleaned, extract_nationalities, countries$country.name.fr),
   
    owner_nationality_company = sapply(owner_info_cleaned, extract_nationalities22, countries$country.name.fr),
   
    ow_owc_identical = ifelse(owner_nationality == owner_nationality_company, TRUE, FALSE)
  )



  

#Code for evaluation of company code
##This code was used the evaluate if the functions above worked correctly.
df_sample <- df |>
  sample_n(size = 1000, replace = FALSE) |> select(senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, ow_owc_identical)
df_test2 <- df |> filter(owner_nationality_company == "Company")
table(df_test2$senderOffice) #Most of the problematic cases are produced by the "problem cantons". Manual correction for the other cases
df_test3 <- df |> filter(owner_nationality != owner_nationality_company)

df1 <- df %>% dplyr::filter(!is.na(owner_info))
df1$owner_nationality <- as.factor(df1$owner_nationality)
df_test <- df %>% dplyr::filter(is.na(owner_info))
# df_test <- Firmengründungen2022 %>% dplyr::filter(is.na(owner_info))
df_test2 <- df %>% dplyr::filter(company_as_founder == 1)
df_test4 <- df %>% dplyr::filter(company_as_founder == 0) %>% dplyr::filter(is.na(owner_info))



###################################### Special treatment for problematic cantons
##These cantons have a very different approach for naming the founders, so a different approach for the extraction is necessary.
offices_to_exclude <- c("Registre du commerce du Canton de Genève", 
                        "Registre du commerce du Canton de Neuchâtel", 
                        "Registre du commerce du Canton de Vaud")

df_new <- df %>% 
  dplyr::filter((senderOffice %in% offices_to_exclude))

df_new$owner_info_cleaned <- sub("\\(CHE-\\d+\\.\\d+\\.\\d+\\), à", "", df_new$owner_info_cleaned)

df_new$nationality <- NA

#For each row in the data frame
for (i in 1:nrow(df_new)) {
  
  #Skip if the value is NA
  if(is.na(df_new$owner_info_cleaned[i])){
    next
  }
  #Extract the string between "de" or "du" and "à" (it should be the nationality)
  nationalities <- str_extract_all(df_new$owner_info_cleaned[i], "(?<=, de |, du |, d'|, des ).*?(?=, à|, au)")
  #Count the number of "de et à" in the text and add that many "Swiss" to the nationalities
  swiss_count <- str_count(df_new$owner_info_cleaned[i], "de et à| de et au| du et au")
  if (swiss_count > 0) {
    nationalities[[1]] <- c(nationalities[[1]], rep("Swiss", swiss_count))
  }
  #Check if nationality is not null 
  if (length(nationalities[[1]]) > 0) {
    #Assign the extracted nationality to the nationality column
    #Save all nationalities in a single string, with each nationality separated by a semicolon
    df_new$nationality[i] <- paste(nationalities[[1]], collapse = "; ")
  }
}


df_newxy <- dplyr::filter(df_new, is.na(nationality))




#Create a new column to store the matching countries
df_new$match_country <- NA

#For each row in df_new
for (i in 1:nrow(df_new)) {
  #Skip if the value is NA
  if(is.na(df_new$nationality[i])){
    next
  }
  #Extract the nationalities
  nationalities <- strsplit(df_new$nationality[i], split = "; ")
  # Initialize a list to store the matching countries
  matches <- c()
  #For each nationality
  for (nat in nationalities[[1]]) {
    #Check if nationality exists in countries$country.name.fr
    if (nat %in% countries$country.name.fr) {
      matches <- c(matches, nat)
    } else {
      matches <- c(matches, "Swiss")
    }
  }
  #Save the matches, separated by a semicolon
  df_new$match_country[i] <- paste(matches, collapse = "; ")
}


#Evaluation to see if the code worked
set.seed(1234)
df_newsample2 <- df_new |>
  sample_n(size = 1000, replace = FALSE) |> select(id, senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, match_country)


#Merging data sets
##Merging the "older" data set with the newer one with the special approach for the three problematic cantons.
df <- left_join(df, df_new[c("id", "match_country")], by = "id")

df2 <- df |> dplyr::mutate(
  owner_nationality = coalesce(match_country, owner_nationality),
  owner_nationality_company = coalesce(match_country, owner_nationality_company)
)
df2$owner_nationality_wcomp <- NA
df2$owner_nationality_wcomp <- str_replace_all(df2$owner_nationality_company, "Company, |, Company|Company", "") #added company for the cases where it is mentioned without a comma, because only companies are named

#Remove the match_country column
df2$match_country <- NULL


df <- df2

###################################### Correction for wrong "Administration" cases
##The word "Administration" is used in some names of German companies. However, it is also a keyword for the French cases. Therefore, a correction has the be made for the cases where the code wrongfully identified the names as keywords. The correction is done manually.
df_correction <- df |> select(id, senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company)

df[df$id == "e0a8ff71-1b89-4a3b-b7d1-fbbb43a249ec", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "1a04997d-95e2-4e61-9c52-6959a3c57b76", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "9329ab31-a1d1-4bee-99b9-fa556846ccb1", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "b39110f0-04af-4a48-88e0-13482704dd57", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "507b5e39-80ca-4381-a4db-b5d392cd0ad0", "owner_nationality_wcomp"] <- "Swiss, Swiss, Espagne"
df[df$id == "cd8ece26-46f3-49c7-82b2-4ca0794e39e3", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "f15dafef-4331-45e9-95b5-89b17e847379", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, deutsche Staatsangehörige"
df[df$id == "6362c8b4-083f-412e-8e0c-bae0dd32e6f0", "owner_nationality_wcomp"] <- "Danemark"
df[df$id == "29772f53-b53f-4bf7-9c39-5994ae9a3238", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "2769bf81-76a9-4f97-b819-62f65a4be028", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "4597e9f6-7936-4584-a178-359847e0c05f", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "278b7b72-dea5-4538-b7f7-fd465b7daa17", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss"
df[df$id == "2f5df754-c2cd-4703-9ef9-df0b0bbf4d00", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "2db7fdb4-ffa6-41f5-a0fb-8e5ab09399e0", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "31de6218-6639-48ea-a82c-4847d59296cf", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "bbc2a537-f0e1-4d27-ae84-3fb55116d9ef", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "7d8a4a88-436a-41e8-8ebf-2e88ce419189", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "8c56c395-22b9-4ccb-99d4-e77efc45a64b", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "ef7f80f2-1bd5-4738-a82e-124046f6e489", "owner_nationality_wcomp"] <- "serbische Staatsangehörige"
df[df$id == "9882e661-218a-41d8-a114-818ce20af50b", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "07ae80a3-986c-46a9-826c-8ee16c14d88c", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "e8b3b02b-4b69-43d7-934f-d3a66db2d501", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "48d44207-4af9-4048-834e-e91dec21fc6c", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "2c3e4f66-2629-4111-8081-8a545a36aebe", "owner_nationality_wcomp"] <- "österreichische Staatsangehörige"
df[df$id == "72836797-f6e0-42fd-9907-a8757466ca61", "owner_nationality_wcomp"] <- "irischer Staatsangehörige, irischer Staatsangehörige, deutscher Staatsangehörige"
df[df$id == "db0d58e2-5952-4f8c-8b8f-fdc35ddbdabf", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "7771bf03-e1de-457b-8bf1-5e71a54c28dc", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "54651997-7a7d-49b1-8051-1dc2e1f6d2e7", "owner_nationality_wcomp"] <- "kroatische Staatsangehörige"
df[df$id == "bdbffe87-6bcf-4257-80a5-404a7cc98972", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "e7bb5a74-3128-4aff-a883-478930c78713", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "cc10c886-61cd-474d-b474-aaf49868321e", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "90cda9d8-46d8-4934-bd3f-907fa7f88a2c", "owner_nationality_wcomp"] <- "Swiss, afghanischer Staatsangehörige"
df[df$id == "7d97af56-54e2-44e5-be4e-613a163c3ab8", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "8dba5e15-b20e-420d-90a4-4cde0869f477", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "8e855bb8-a955-4f29-b5a1-99d85474e46b", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "93b6da0b-05c7-4e65-9da2-9d461bd9f0bf", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "b17ae64b-22c9-4def-9090-150d3b8d383f", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "f28adc2b-651b-494f-bfe0-214ee2e85ac6", "owner_nationality_wcomp"] <- "portugiesische Staatsangehörige"
df[df$id == "c7b02cef-4090-4100-a142-e09099d8af01", "owner_nationality_wcomp"] <- "serbischer Staatsangehörige"
df[df$id == "821f6580-56b0-4199-959d-c92d8a02dd3c", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "bed66c00-719f-474c-9cd4-6f1350d2b97c", "owner_nationality_wcomp"] <- "Swiss, deutscher Staatsangehörige, Swiss, Swiss"
df[df$id == "0b89748b-9db4-485f-81c1-23523c96392c", "owner_nationality_wcomp"] <- "Swiss"



###################################### Einzelunternehmen, delete second persons
##We focus only on the founder and not any other "Zeichnungsberechtigte Personen" for the "Einzelunternehmen". We thus delete all persons mentioned except for the first person for all "Einzelunternehmen" 

#Function to extract the first nationality from the comma- or semicolon-separated string
extract_first_nationality <- function(nationalities) {
  nationality <- strsplit(nationalities, ",|;")[[1]][1]
  return(trimws(nationality))
}

 
#Delete additional persons for "Einzelunternehmen"
df <- df %>%
  mutate(owner_nationality_wcomp2 = ifelse(is_einzelunternehmen == "1",
                                    sapply(owner_nationality_wcomp, extract_first_nationality),
                                    owner_nationality_wcomp))


#Check how many NAs are left
df$owner_nationality_empty <- nzchar(df$owner_nationality_wcomp2)
df_warum <- df %>% dplyr::filter(owner_nationality_empty == FALSE)
table(df_warum$company_as_founder)


#Data inspection of NAs and see how many "Zweigniederlassungen" there are.
##A lot of the NAs are "Zweigniederlassungen" which we do not include in the final data, as they are not a "new" company in the sense as we use it on our study.
df_warum$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale de|succursale d')\\b"))
df_warum$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df_warum$ZweigniederlassungDE <- as.integer(str_detect(df_warum$publicationText, "\\b(Firma Hauptsitz)\\b"))
df_warum$Zweigniederlassung <- as.integer(df_warum$ZweigniederlassungFR == 1 | df_warum$ZweigniederlassungDE == 1 | df_warum$ZweigniederlassungIT == 1)
table(df_warum$Zweigniederlassung)


#Filter whole data of Zweigniederlassungen
df$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale de|succursale d')\\b"))
df$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df$ZweigniederlassungDE <- as.integer(str_detect(df$publicationText, "\\b(Firma Hauptsitz)\\b"))
df$Zweigniederlassung <- as.integer(df$ZweigniederlassungFR == 1 | df$ZweigniederlassungDE == 1 | df$ZweigniederlassungIT == 1)
table(df$Zweigniederlassung)
df <- df %>% dplyr::filter(Zweigniederlassung == 0)

###################################### Saving the dataset
saveRDS(df, "Firmengründungen2019.Rds")



#####################################Additional cleaning
#Check for number of mentions of "tous deux" and therefore robustness of the data

Firmengründungen2019 <- readRDS("Firmengründungen2019.Rds")
shab19_comp <- readRDS("shab19_complete.Rds")

shab19_comp_überprüfung <- shab19_comp %>%
  mutate(tousdeux = as.integer(str_detect(publicationText, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)

Firmengründungen2019_überprüfung <- Firmengründungen2019 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)


#Filter out the above specified cases and filter for empty owner_nationality_wcomp2
Firmengründungen2019 <- Firmengründungen2019 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>% 
  dplyr::filter(tousdeux != 1) %>%
  dplyr::filter(!is.na(owner_nationality_wcomp2))


###################################### Saving the dataset
saveRDS(Firmengründungen2019, "Firmengründungen2019.Rds")
```





##2020
```{r}
#First, we read in the data that has been collected from the API and load another data frame with lists of country names that will be needed later.
shab20_comp <- readRDS("shab20_complete.Rds")
countries <- readRDS("countries.RDS")

#Adjusting countries-datasets
##This step is necessary, since some names are missing in the list. They are manually added here.
countries2 <- countries |> select(country.name.fr)
new_row1 <- data.frame(country.name.fr = "Grande-Bretagne")
new_row2 <- data.frame(country.name.fr = "Mauritius")
new_row3 <- data.frame(country.name.fr = "Etats-Unis d'Amérique")
new_row4 <- data.frame(country.name.fr = "Arabie Saoudite")
countries <- rbind(countries2, new_row1, new_row2, new_row3)


#Part-function that is necessary to find countries in strings of french-speaking cantons
find_country <- function(string, country_names) {
  for (country_name in country_names) {
    if (!is.na(country_name) && str_detect(string, country_name)) {
      return(country_name)
    }
  }
  return(NULL)
}


#Function to extract nationalities from the owner-column
##This function examines the later established "owner_info_cleaned" variable and looks for certain keywords which are followed by the nationality of an individual. Since the structure of the entries of some French-speaking cantons are different (and the keywords are missing there), the function checks whether a country from the list above is mentioned in the text.
extract_nationalities <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
      
      if (is.na(nationality)) {
        #Search for the country in the given column
        nationality <- find_country(owner, country_names)
        
        if (is.null(nationality)) {
          nationalities <- append(nationalities, "Swiss")
        } else {
          nationalities <- append(nationalities, nationality)
        }
      } else {
        nationalities <- append(nationalities, nationality)
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}



#Function with company
##Same function as before basically, but since for example auditors and other companies can be mentioned as founders in the text, this function checks for the "CHE"-number (specific number to identify a certain company) in the text. This step ensures that companies are not falsely identified as individuals.
extract_nationalities22 <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
      #Check if one of the owners is a company
      if (grepl("\\(CHE-\\d+\\.\\d+\\.\\d+\\)", owner)) {
        nationalities <- append(nationalities, "Company")
      } else {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
        
        if (is.na(nationality)) {
          #Search for the country in the given column
          nationality <- find_country(owner, country_names)
          
          if (is.null(nationality)) {
            nationalities <- append(nationalities, "Swiss")
          } else {
            nationalities <- append(nationalities, nationality)
          }
        } else {
          nationalities <- append(nationalities, nationality)
        }
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}




#Applying the custom functions to the owner_info_cleaned column and select other information from the publication text (like for example the company name) and save it in a new variable.
## The crucial owner_info_cleaned section is also established in this section. This variable tries to extract only the part of the publication text where the founders are mentioned.
df <- shab20_comp %>%
  mutate(
    company_name = str_extract(publicationText, "^[^,]+"),
    location = ifelse(
      str_detect(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      str_extract(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      ifelse(
        str_detect(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), 
        str_extract(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), NA
      )
    ), 
    
    is_ag_or_sa = as.integer(str_detect(company_name, "\\b(AG|SA|ag|s.a.|sa)\\b")),
    
    is_kollektivgesellschaft = as.integer(str_detect(publicationText, "\\b(Kollektivgesellschaft|KLG|SNC|société en nom collectif|snc|klg|kollektivgesellschaft|Société en nom collectif|società collettiva)\\b")),
    
    is_kommanditgesellschaft = as.integer(str_detect(publicationText, "\\b(Kommanditgesellschaft|KMG|SCM|société en commandite|scm|KmG|kommanditgesellschaft|Société en commandite|società in accomandita)\\b")),
    
    is_einzelunternehmen = as.integer(str_detect(publicationText, "\\b(Einzelunternehmen|entreprise individuelle|einzelunternehmen|impresa individuale)\\b")),
    
    is_gmbh = as.integer(str_detect(company_name, "\\b(GmbH|Sàrl|Srl|SAGL|Sagl|SARL|sàrl|SàRL|SÀRL)\\b")),
    
    is_gmbh2 = as.integer(str_detect(publicationText, "\\b(Gesellschaft mit beschränkter Haftung|società a garanzia limitata)\\b")),
    
    is_stiftung = as.integer(str_detect(publicationText, "\\b(Stiftung|Fondation|Fondazione)\\b")),
    
    is_verein = as.integer(str_detect(publicationText, "\\b(Verein|Association|association|Associazione|associazione)\\b")),
    
    is_genossenschat = as.integer(str_detect(publicationText, "\\b(Genossenschaft|société coopérative|Société Coopérative)\\b")),
    
    company_as_founder = as.integer(str_detect(publicationText, "\\b(Firma Hauptsitz|Société anonyme|société anonyme|Ditta della sede principale)\\b")),
    
   owner_info = str_extract(publicationText, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personnes inscrites|Personne incrite|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*)(.*?)\\s*(?=\\sbut|\\sBut|$)"),
   
    owner_info_cleaned = str_trim(str_replace(owner_info, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personne incrite|Personnes inscrites|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*) ?", "")), 
   
    owner_nationality = sapply(owner_info_cleaned, extract_nationalities, countries$country.name.fr),
   
    owner_nationality_company = sapply(owner_info_cleaned, extract_nationalities22, countries$country.name.fr),
   
    ow_owc_identical = ifelse(owner_nationality == owner_nationality_company, TRUE, FALSE)
  )



  

#Code for evaluation of company code
##This code was used the evaluate the functions above.
df_sample <- df |>
  sample_n(size = 1000, replace = FALSE) |> select(senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, ow_owc_identical)
df_test2 <- df |> filter(owner_nationality_company == "Company")
table(df_test2$senderOffice) #Most of the cases are produced by the "problem cantons". Manual correction for the other cases
df_test3 <- df |> filter(owner_nationality != owner_nationality_company)

df1 <- df %>% dplyr::filter(!is.na(owner_info))
df1$owner_nationality <- as.factor(df1$owner_nationality)
df_test <- df %>% dplyr::filter(is.na(owner_info))
# df_test <- Firmengründungen2022 %>% dplyr::filter(is.na(owner_info))
df_test2 <- df %>% dplyr::filter(company_as_founder == 1)
df_test4 <- df %>% dplyr::filter(company_as_founder == 0) %>% dplyr::filter(is.na(owner_info))



###################################### Special treatment for problematic cantons
##These cantons have a very different approach for naming the founders, so a different approach for the extraction is necessary.
offices_to_exclude <- c("Registre du commerce du Canton de Genève", 
                        "Registre du commerce du Canton de Neuchâtel", 
                        "Registre du commerce du Canton de Vaud")

df_new <- df %>% 
  dplyr::filter((senderOffice %in% offices_to_exclude))

df_new$owner_info_cleaned <- sub("\\(CHE-\\d+\\.\\d+\\.\\d+\\), à", "", df_new$owner_info_cleaned)

# Create a new column to store the extracted nationalities
df_new$nationality <- NA

#For each row in the data frame
for (i in 1:nrow(df_new)) {
  
  #Skip if the value is NA
  if(is.na(df_new$owner_info_cleaned[i])){
    next
  }
  #Extract the string between "de" or "du" and "à" (it should be the nationality)
  nationalities <- str_extract_all(df_new$owner_info_cleaned[i], "(?<=, de |, du |, d'|, des ).*?(?=, à|, au)")
  #Count the number of "de et à" in the text and add that many "Swiss" to the nationalities
  swiss_count <- str_count(df_new$owner_info_cleaned[i], "de et à| de et au| du et au")
  if (swiss_count > 0) {
    nationalities[[1]] <- c(nationalities[[1]], rep("Swiss", swiss_count))
  }
  #Check if nationality is not null 
  if (length(nationalities[[1]]) > 0) {
    #Assign the extracted nationality to the nationality column
    df_new$nationality[i] <- paste(nationalities[[1]], collapse = "; ")
  }
}


df_newxy <- dplyr::filter(df_new, is.na(nationality))




#Create a new column to store the matching countries
df_new$match_country <- NA

#For each row in df_new
for (i in 1:nrow(df_new)) {
  #Skip if the value is NA
  if(is.na(df_new$nationality[i])){
    next
  }
  #Extract the nationalities
  nationalities <- strsplit(df_new$nationality[i], split = "; ")
  #Initialize a list to store the matching countries
  matches <- c()
  #For each nationality
  for (nat in nationalities[[1]]) {
    #Check if nationality exists in countries$country.name.fr
    if (nat %in% countries$country.name.fr) {
      matches <- c(matches, nat)
    } else {
      matches <- c(matches, "Swiss")
    }
  }
  #Save the matches, separated by a semicolon
  df_new$match_country[i] <- paste(matches, collapse = "; ")
}


#Evaluation to see if the code worked
set.seed(1234)
df_newsample2 <- df_new |>
  sample_n(size = 1000, replace = FALSE) |> select(id, senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, match_country)


#Merging datasets
##Merging the "older" data set with the newer one with the special approach for the three problematic cantons.
df <- left_join(df, df_new[c("id", "match_country")], by = "id")

df2 <- df |> dplyr::mutate(
  owner_nationality = coalesce(match_country, owner_nationality),
  owner_nationality_company = coalesce(match_country, owner_nationality_company)
)
df2$owner_nationality_wcomp <- NA
df2$owner_nationality_wcomp <- str_replace_all(df2$owner_nationality_company, "Company, |, Company|Company", "") #added company for the cases where it is mentioned without a comma, because only companies are name

#Remove the match_country column
df2$match_country <- NULL


df <- df2

######################################Correction for wrong "Administration" cases
##The word "Administration" is used in some names of German companies. However, it is also a keyword for the French cases. Therefore, a correction has the be made for the cases where the code wrongfully identified the names as keywords. The correction is done manually.
df_correction <- df |> select(id, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company)

df[df$id == "7a4f747a-7707-408f-902a-657ef4fdf25a", "owner_nationality_wcomp"] <- "Swiss, deutsche Staatsangehörige"
df[df$id == "a7d9fd2e-8b45-4704-a570-99bf40afeb2c", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "b67012b2-f15e-4045-9efb-28fa8b55336f", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "97a8dab3-913b-46fc-ad06-83d3bb2489a0", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "6e731bd0-1777-419b-9f8f-56f6ad0cd995", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "4914c6c4-898c-4955-b8ec-144bd7ac52dd", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "fa5780a6-0dc0-42c5-bfa6-9a0a98d2c7cd", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige, Swiss"
df[df$id == "a0f5bed7-51ab-4c8f-aaf0-e90fb04c0497", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "41e19a61-377e-4c2c-a122-b55bbc3357fa", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "5290a5ca-afaf-48a2-9bcf-bd5aff91d126", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "b82b9076-6634-4cc9-b2cb-097d40babc1a", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "be7d2b76-6b5d-4b35-98b7-b1f8c30e0f80", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige"
df[df$id == "d4236654-04b8-431e-b916-484a5b96e0d1", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "caff4a12-26d0-4cae-9cdc-b1d41be60842", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "ba499b95-5f6e-4720-8c7d-6fd97d33f84d", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "87a67503-200a-4499-a4f7-df5b5dfdc0cb", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "66f0bd22-4a0c-4ebe-9746-bddfea323a1e", "owner_nationality_wcomp"] <- "kasachischer Staatsangehörige, Swiss"
df[df$id == "acd60e8c-7ae4-4328-bc54-34cf4d1ba370", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "5556cc8f-1f26-43cf-b110-ed1118b2c093", "owner_nationality_wcomp"] <- "deutsche Staatsangehörige, Swiss"
df[df$id == "0b479f02-498a-4cd2-afb1-f898b633a01d", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "de18e1cf-b53b-46b6-be40-97213d9232a7", "owner_nationality_wcomp"] <- "deutsche Staatsangehörige, Swiss"
df[df$id == "6a0c6e11-0c25-488c-bfda-afdea3841bf8", "owner_nationality_wcomp"] <- "italienischer Staatsangehörige"
df[df$id == "392f8446-e5c2-486d-8081-3bb4ffa29623", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "c19343e5-4610-4b3d-bab2-4cadc072abb6", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "13f8660c-9d75-4cdb-9a36-4f3fddc072e6", "owner_nationality_wcomp"] <- "kroatische Staatsangehörige, Swiss"
df[df$id == "7799e00c-2a40-4004-bb3e-3d5dc70ffa22", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss"
df[df$id == "d341c5ff-75b5-4c13-aef0-d8e629b128bc", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige, österreichischer Staatsangehörige"
df[df$id == "2b064417-7941-4b9f-a3a0-1d1c513049c8", "owner_nationality_wcomp"] <- "Swiss, deutscher Staatsangehörige"
df[df$id == "1b3bfe6c-5314-4933-893b-e72bbea0613b", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "9b466757-bbfc-49aa-b841-362fe3166176", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "2c00354b-c292-4981-b0d5-5f800f74a041", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "8f1d5a4f-ea4e-4df4-8a7e-f75bde6543da", "owner_nationality_wcomp"] <- "kroatische Staatsangehörige, Swiss"
df[df$id == "69e15a56-4e1f-4dad-8c8b-3ce1ab3aaf1d", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "31cd3f31-9fd8-4e3d-9424-ec686b58286d", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige, Swiss"
df[df$id == "b0e96718-639e-447c-b353-0fa8cbb18149", "owner_nationality_wcomp"] <- "dänischer Staatsangehörige"
df[df$id == "218f60d9-f2f7-4432-b776-07312c530197", "owner_nationality_wcomp"] <- "Swiss, Swiss"



###################################### Einzelunternehmen, delete second persons
##We focus only on the founder here and not any other "Zeichnungsberechtigte Personen".


#Function to extract the first nationality from the comma- or semicolon-separated string
extract_first_nationality <- function(nationalities) {
  nationality <- strsplit(nationalities, ",|;")[[1]][1]
  return(trimws(nationality))
}

 
#Delete additional persons for "Einzelunternehmen"
df <- df %>%
  mutate(owner_nationality_wcomp2 = ifelse(is_einzelunternehmen == "1",
                                    sapply(owner_nationality_wcomp, extract_first_nationality),
                                    owner_nationality_wcomp))


#Check how many NAs are left
df$owner_nationality_empty <- nzchar(df$owner_nationality_wcomp2)
df_warum <- df %>% dplyr::filter(owner_nationality_empty == FALSE)
table(df_warum$company_as_founder)


#Data inspection of NAs and see how many "Zweigniederlassungen" there are.
##A lot of the NAs are "Zweigniederlassungen" which we do not include in the final data, as they are not a "new" company in the sense as we use it on our study.
df_warum$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale de|succursale d')\\b"))
df_warum$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df_warum$ZweigniederlassungDE <- as.integer(str_detect(df_warum$publicationText, "\\b(Firma Hauptsitz)\\b"))
df_warum$Zweigniederlassung <- as.integer(df_warum$ZweigniederlassungFR == 1 | df_warum$ZweigniederlassungDE == 1 | df_warum$ZweigniederlassungIT == 1)
table(df_warum$Zweigniederlassung)


#Filter whole data of Zweigniederlassungen
df$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale de|succursale d')\\b"))
df$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df$ZweigniederlassungDE <- as.integer(str_detect(df$publicationText, "\\b(Firma Hauptsitz)\\b"))
df$Zweigniederlassung <- as.integer(df$ZweigniederlassungFR == 1 | df$ZweigniederlassungDE == 1 | df$ZweigniederlassungIT == 1)
table(df$Zweigniederlassung)
df <- df %>% dplyr::filter(Zweigniederlassung == 0)

###################################### Saving the dataset
saveRDS(df, "Firmengründungen2020.Rds")



#####################################Additional cleaning
# Check for number of mentions of "tous deux" and therefore robustness of the data

Firmengründungen2020 <- readRDS("Firmengründungen2020.Rds")
shab20_comp <- readRDS("shab20_complete.Rds")

shab20_comp_überprüfung <- shab20_comp %>%
  mutate(tousdeux = as.integer(str_detect(publicationText, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)

Firmengründungen2020_überprüfung <- Firmengründungen2020 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)


# Filter out the above specified cases and filter for empty owner_nationality_wcomp2

Firmengründungen2020 <- Firmengründungen2020 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>% 
  dplyr::filter(tousdeux != 1) %>%
  dplyr::filter(!is.na(owner_nationality_wcomp2))


###################################### Saving the dataset
saveRDS(Firmengründungen2020, "Firmengründungen2020.Rds")
```



##2021
```{r}
#First, we read in the data that has been collected from the API and load another data frame with lists of country names that will be needed later.
shab21_comp <- readRDS("shab21_complete.Rds")
countries <- readRDS("countries.RDS")

#Adjusting countries-datasets
##This step is necessary, since some names are missing in the list. They are manually added here.
countries2 <- countries |> select(country.name.fr)
new_row1 <- data.frame(country.name.fr = "Grande-Bretagne")
new_row2 <- data.frame(country.name.fr = "Mauritius")
new_row3 <- data.frame(country.name.fr = "Etats-Unis d'Amérique")
new_row4 <- data.frame(country.name.fr = "Arabie Saoudite")
countries <- rbind(countries2, new_row1, new_row2, new_row3)


#Part-function that is necessary to find countries in strings of french-speaking cantons
find_country <- function(string, country_names) {
  for (country_name in country_names) {
    if (!is.na(country_name) && str_detect(string, country_name)) {
      return(country_name)
    }
  }
  return(NULL)
}


#Function to extract nationalities from the owner-column
##This function examines the later established "owner_info_cleaned" variable and looks for certain keywords which are followed by the nationality of an individual. Since the structure of the entries of some French-speaking cantons are different (and the keywords are missing there), the function checks whether a country from the list above is mentioned in the text.
extract_nationalities <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
      
      if (is.na(nationality)) {
        #Search for the country in the given column
        nationality <- find_country(owner, country_names)
        
        if (is.null(nationality)) {
          nationalities <- append(nationalities, "Swiss")
        } else {
          nationalities <- append(nationalities, nationality)
        }
      } else {
        nationalities <- append(nationalities, nationality)
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}



#Function with company
##Same function as before basically, but since for example auditors and other companies can be mentioned as founders in the text, this function checks for the "CHE"-number (specific number to identify a certain company) in the text. This step ensures that companies are not falsely identified as individuals.
extract_nationalities22 <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
      #Check if one of the owners is a company
      if (grepl("\\(CHE-\\d+\\.\\d+\\.\\d+\\)", owner)) {
        nationalities <- append(nationalities, "Company")
      } else {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
        
        if (is.na(nationality)) {
          #Search for the country in the given column
          nationality <- find_country(owner, country_names)
          
          if (is.null(nationality)) {
            nationalities <- append(nationalities, "Swiss")
          } else {
            nationalities <- append(nationalities, nationality)
          }
        } else {
          nationalities <- append(nationalities, nationality)
        }
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}




#Applying the custom functions to the owner_info_cleaned column and select other information from the publication text (like for example the company name) and save it in a new variable.
## The crucial owner_info_cleaned section is also established in this section. This variable tries to extract only the part of the publication text where the founders are mentioned.
df <- shab21_comp %>%
  mutate(
    company_name = str_extract(publicationText, "^[^,]+"),
    location = ifelse(
      str_detect(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      str_extract(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      ifelse(
        str_detect(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), 
        str_extract(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), NA
      )
    ), 
    
    is_ag_or_sa = as.integer(str_detect(company_name, "\\b(AG|SA|ag|s.a.|sa)\\b")),
    
    is_kollektivgesellschaft = as.integer(str_detect(publicationText, "\\b(Kollektivgesellschaft|KLG|SNC|société en nom collectif|snc|klg|kollektivgesellschaft|Société en nom collectif|società collettiva)\\b")),
    
    is_kommanditgesellschaft = as.integer(str_detect(publicationText, "\\b(Kommanditgesellschaft|KMG|SCM|société en commandite|scm|KmG|kommanditgesellschaft|Société en commandite|società in accomandita)\\b")),
    
    is_einzelunternehmen = as.integer(str_detect(publicationText, "\\b(Einzelunternehmen|entreprise individuelle|einzelunternehmen|impresa individuale)\\b")),
    
    is_gmbh = as.integer(str_detect(company_name, "\\b(GmbH|Sàrl|Srl|SAGL|Sagl|SARL|sàrl|SàRL|SÀRL)\\b")),
    
    is_gmbh2 = as.integer(str_detect(publicationText, "\\b(Gesellschaft mit beschränkter Haftung|società a garanzia limitata)\\b")),
    
    is_stiftung = as.integer(str_detect(publicationText, "\\b(Stiftung|Fondation|Fondazione)\\b")),
    
    is_verein = as.integer(str_detect(publicationText, "\\b(Verein|Association|association|Associazione|associazione)\\b")),
    
    is_genossenschat = as.integer(str_detect(publicationText, "\\b(Genossenschaft|société coopérative|Société Coopérative)\\b")),
    
    company_as_founder = as.integer(str_detect(publicationText, "\\b(Firma Hauptsitz|Société anonyme|société anonyme|Ditta della sede principale)\\b")),
    
   owner_info = str_extract(publicationText, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personnes inscrites|Personne incrite|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*)(.*?)\\s*(?=\\sbut|\\sBut|$)"),
   
    owner_info_cleaned = str_trim(str_replace(owner_info, "(Eingetragene Person(en)?|Eingetragenen Personen|Signature collective à deux est conférée à|Conseil exécutif|Direction|Signature individuelle est conférée à|Administration|Administrateur|Administrateurs|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personne incrite|Personnes inscrites|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*) ?", "")), 
   
    owner_nationality = sapply(owner_info_cleaned, extract_nationalities, countries$country.name.fr),
   
    owner_nationality_company = sapply(owner_info_cleaned, extract_nationalities22, countries$country.name.fr),
   
    ow_owc_identical = ifelse(owner_nationality == owner_nationality_company, TRUE, FALSE)
  )



  

#Code for evaluation of company code
##This code was used the evaluate the functions above.
df_sample <- df |>
  sample_n(size = 1000, replace = FALSE) |> select(senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, ow_owc_identical)
df_test2 <- df |> filter(owner_nationality_company == "Company")
table(df_test2$senderOffice) #Most of the cases are produced by the "problem cantons". Manual correction for the other cases
df_test3 <- df |> filter(owner_nationality != owner_nationality_company)

df1 <- df %>% dplyr::filter(!is.na(owner_info))
df1$owner_nationality <- as.factor(df1$owner_nationality)
df_test <- df %>% dplyr::filter(is.na(owner_info))
# df_test <- Firmengründungen2022 %>% dplyr::filter(is.na(owner_info))
df_test2 <- df %>% dplyr::filter(company_as_founder == 1)
df_test4 <- df %>% dplyr::filter(company_as_founder == 0) %>% dplyr::filter(is.na(owner_info))



###################################### Special treatment for problematic cantons
##These cantons have a very different approach for naming the founders, so a different approach for the extraction is necessary.
offices_to_exclude <- c("Registre du commerce du Canton de Genève", 
                        "Registre du commerce du Canton de Neuchâtel", 
                        "Registre du commerce du Canton de Vaud")

df_new <- df %>% 
  dplyr::filter((senderOffice %in% offices_to_exclude))

df_new$owner_info_cleaned <- sub("\\(CHE-\\d+\\.\\d+\\.\\d+\\), à", "", df_new$owner_info_cleaned)

# Create a new column to store the extracted nationalities
df_new$nationality <- NA

#For each row in the data frame
for (i in 1:nrow(df_new)) {
  
  #Skip if the value is NA
  if(is.na(df_new$owner_info_cleaned[i])){
    next
  }
  #Extract the string between "de" or "du" and "à" (it should be the nationality)
  nationalities <- str_extract_all(df_new$owner_info_cleaned[i], "(?<=, de |, du |, d'|, des ).*?(?=, à|, au)")
  #Count the number of "de et à" in the text and add that many "Swiss" to the nationalities
  swiss_count <- str_count(df_new$owner_info_cleaned[i], "de et à| de et au| du et au")
  if (swiss_count > 0) {
    nationalities[[1]] <- c(nationalities[[1]], rep("Swiss", swiss_count))
  }
  #Check if nationality is not null 
  if (length(nationalities[[1]]) > 0) {
    #Assign the extracted nationality to the nationality column
    df_new$nationality[i] <- paste(nationalities[[1]], collapse = "; ")
  }
}


df_newxy <- dplyr::filter(df_new, is.na(nationality))




#Create a new column to store the matching countries
df_new$match_country <- NA

#For each row in df_new
for (i in 1:nrow(df_new)) {
  #Skip if the value is NA
  if(is.na(df_new$nationality[i])){
    next
  }
  #Extract the nationalities
  nationalities <- strsplit(df_new$nationality[i], split = "; ")
  # Initialize a list to store the matching countries
  matches <- c()
  #For each nationality
  for (nat in nationalities[[1]]) {
    #Check if nationality exists in countries$country.name.fr
    if (nat %in% countries$country.name.fr) {
      matches <- c(matches, nat)
    } else {
      matches <- c(matches, "Swiss")
    }
  }
  #Save the matches, separated by a semicolon
  df_new$match_country[i] <- paste(matches, collapse = "; ")
}


#Evaluation to see if the code worked
set.seed(1234)
df_newsample2 <- df_new |>
  sample_n(size = 1000, replace = FALSE) |> select(id, senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, match_country)


#Merging datasets
##Merging the "older" data set with the newer one with the special approach for the three problematic cantons.
df <- left_join(df, df_new[c("id", "match_country")], by = "id")

df2 <- df |> dplyr::mutate(
  owner_nationality = coalesce(match_country, owner_nationality),
  owner_nationality_company = coalesce(match_country, owner_nationality_company)
)
df2$owner_nationality_wcomp <- NA
df2$owner_nationality_wcomp <- str_replace_all(df2$owner_nationality_company, "Company, |, Company|Company", "") #added company for the cases where it is mentioned without a comma, because only companies are name

#Remove the match_country column
df2$match_country <- NULL


df <- df2

######################################Correction for wrong "Administration" cases
##The word "Administration" is used in some names of German companies. However, it is also a keyword for the French cases. Therefore, a correction has the be made for the cases where the code wrongfully identified the names as keywords. The correction is done manually.
df_correction <- df |> select(id, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company)

df[df$id == "a0ddd39a-5544-4550-9eb7-ade00a626d14", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "b7093bd8-5ee3-45b9-9b0b-24d0ed8e3ba5", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "cbe60e50-ebe4-4a4b-ad23-38383c39669c", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "8569dfa9-6832-40b6-9076-14376aff42c8", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "8c1a4f6a-fada-4722-bfa2-b45b15b50886", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige, deutsche Staatsangehörige"
df[df$id == "f37fffba-545f-4704-a8dc-55bf24153172", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "a9cbfa55-8a79-445c-b124-d09d992f3153", "owner_nationality_wcomp"] <- "deutsche Staatsangehörige"
df[df$id == "7fb23f93-b5e2-4860-ac15-2c1d36cdfbc1", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "068f19c7-0327-40b7-add3-19450c351c20", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "af97e74a-2855-4de6-9e9c-4a6219eb38c0", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "fe280c50-7a20-4692-ab8e-a695fa998c76", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "07fe6b72-3d5e-4df3-9222-9984a8532bc7", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "f2aa7caf-2b1a-49bc-848c-d0b60b40782a", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "baeb1261-7e15-4422-b963-89c51b375b18", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige, Swiss"
df[df$id == "5adc3b62-7cac-45cc-9cf3-baec191c86ee", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "9769e7d5-afa5-42c8-af0e-cbd98a6f78c0", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "", "owner_nationality_wcomp"] <- "Swiss, Swiss"



###################################### Einzelunternehmen, delete second persons
##We focus only on the founder here and not any other "Zeichnungsberechtigte Personen".

#Function to extract the first nationality from the comma- or semicolon-separated string
extract_first_nationality <- function(nationalities) {
  nationality <- strsplit(nationalities, ",|;")[[1]][1]
  return(trimws(nationality))
}

 
#Delete additional persons for "Einzelunternehmen"
df <- df %>%
  mutate(owner_nationality_wcomp2 = ifelse(is_einzelunternehmen == "1",
                                    sapply(owner_nationality_wcomp, extract_first_nationality),
                                    owner_nationality_wcomp))


#Check how many NAs are left
df$owner_nationality_empty <- nzchar(df$owner_nationality_wcomp2)
df_warum <- df %>% dplyr::filter(owner_nationality_empty == FALSE)
table(df_warum$company_as_founder)


#Data inspection of NAs and see how many "Zweigniederlassungen" there are.
##A lot of the NAs are "Zweigniederlassungen" which we do not include in the final data, as they are not a "new" company in the sense as we use it on our study.
df_warum$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale de|succursale d')\\b"))
df_warum$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df_warum$ZweigniederlassungDE <- as.integer(str_detect(df_warum$publicationText, "\\b(Firma Hauptsitz)\\b"))
df_warum$Zweigniederlassung <- as.integer(df_warum$ZweigniederlassungFR == 1 | df_warum$ZweigniederlassungDE == 1 | df_warum$ZweigniederlassungIT == 1)
table(df_warum$Zweigniederlassung)


#Filter whole data of Zweigniederlassungen
df$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale de|succursale d')\\b"))
df$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df$ZweigniederlassungDE <- as.integer(str_detect(df$publicationText, "\\b(Firma Hauptsitz)\\b"))
df$Zweigniederlassung <- as.integer(df$ZweigniederlassungFR == 1 | df$ZweigniederlassungDE == 1 | df$ZweigniederlassungIT == 1)
table(df$Zweigniederlassung)
df <- df %>% dplyr::filter(Zweigniederlassung == 0)

###################################### Saving the dataset
saveRDS(df, "Firmengründungen2021.Rds")



#####################################Additional cleaning
##Check for number of mentions of "tous deux" and therefore robustness of the data

Firmengründungen2021 <- readRDS("Firmengründungen2021.Rds")
shab21_comp <- readRDS("shab21_complete.Rds")

shab21_comp_überprüfung <- shab21_comp %>%
  mutate(tousdeux = as.integer(str_detect(publicationText, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)

Firmengründungen2021_überprüfung <- Firmengründungen2021 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)


#Filter for the above specified cases and filter for empty owner_nationality_wcomp2

Firmengründungen2021 <- Firmengründungen2021 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>% 
  dplyr::filter(tousdeux != 1) %>%
  dplyr::filter(!is.na(owner_nationality_wcomp2))


######################################Saving the dataset
saveRDS(Firmengründungen2021, "Firmengründungen2021.Rds")
```



##2022
```{r}
#First, we read in the data that has been collected from the API and load another data frame with lists of country names that will be needed later.
shab22_comp <- readRDS("shab22_complete.Rds")
countries <- readRDS("countries.RDS")

#Adjusting countries-datasets
##This step is necessary, since some names are missing in the list. They are manually added here.
countries2 <- countries |> select(country.name.fr)
new_row1 <- data.frame(country.name.fr = "Grande-Bretagne")
new_row2 <- data.frame(country.name.fr = "Mauritius")
countries <- rbind(countries2, new_row1, new_row2)


#Part-function that is necessary to find countries in strings of french-speaking cantons
find_country <- function(string, country_names) {
  for (country_name in country_names) {
    if (!is.na(country_name) && str_detect(string, country_name)) {
      return(country_name)
    }
  }
  return(NULL)
}


#Function to extract nationalities from the owner-column
##This function exmines the later established "owner_info_cleaned" variable and looks for certain keywords which are followed by the nationality of an individual. Since the structure of the entries of some French-speaking cantons are different (and the keywords are missing there), the function checks whether a country from the list above is mentioned in the text.
extract_nationalities <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
      nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
      
      if (is.na(nationality)) {
        #Search for the country in the given column
        nationality <- find_country(owner, country_names)
        
        if (is.null(nationality)) {
          nationalities <- append(nationalities, "Swiss")
        } else {
          nationalities <- append(nationalities, nationality)
        }
      } else {
        nationalities <- append(nationalities, nationality)
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}



#Function with company
##Same function as before basically, but since for example auditors and other companies can be mentioned as founders in the text, this function checks for the "CHE"-number (specific number to identify a certain company) in the text. This step ensures that companies are not falsely identified as individuals.
extract_nationalities22 <- function(owner_info_cleaned, country_names) {
  owners <- unlist(strsplit(owner_info_cleaned, ";"))
  nationalities <- c()
  
  for (owner in owners) {
    if (!is.na(owner)) {
      #Check if one of the owners is a company
      if (grepl("\\(CHE-\\d+\\.\\d+\\.\\d+\\)", owner)) {
        nationalities <- append(nationalities, "Company")
      } else {
        nationality <- str_extract(owner, "\\b(\\w+) Staatsangehörige?|cittadin[oa] (\\w+)|citoyen (\\w+)|citoyenne (\\w+)|ressortissant (\\w+)|ressortissante (\\w+)")
        
        if (is.na(nationality)) {
          #Search for the country in the given column
          nationality <- find_country(owner, country_names)
          
          if (is.null(nationality)) {
            nationalities <- append(nationalities, "Swiss")
          } else {
            nationalities <- append(nationalities, nationality)
          }
        } else {
          nationalities <- append(nationalities, nationality)
        }
      }
    }
  }
  
  return(paste(nationalities, collapse = ", "))
}




#Applying the custom functions to the owner_info_cleaned column and select other information from the publication text (like for example the company name) and save it in a new variable.
##The crucial owner_info_cleaned section is also established in this section. This variable tries to extract only the part of the publication text where the founders are mentioned.
df <- shab22_comp %>%
  mutate(
    company_name = str_extract(publicationText, "^[^,]+"),
    location = ifelse(
      str_detect(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      str_extract(publicationText, "(?<=à\\s)\\b\\w+[\\s-]?\\w*\\b"), 
      ifelse(
        str_detect(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), 
        str_extract(publicationText, "(?<=in\\s)\\b\\w+[\\s-]?\\w*\\b"), NA
      )
    ), 
    
    
    is_ag_or_sa = as.integer(str_detect(company_name, "\\b(AG|SA|ag|s.a.|sa)\\b")),
    
    is_kollektivgesellschaft = as.integer(str_detect(publicationText, "\\b(Kollektivgesellschaft|KLG|SNC|société en nom collectif|snc|klg|kollektivgesellschaft|Société en nom collectif|società collettiva)\\b")),
    
    is_kommanditgesellschaft = as.integer(str_detect(publicationText, "\\b(Kommanditgesellschaft|KMG|SCM|société en commandite|scm|KmG|kommanditgesellschaft|Société en commandite|società in accomandita)\\b")),
    
    is_einzelunternehmen = as.integer(str_detect(publicationText, "\\b(Einzelunternehmen|entreprise individuelle|einzelunternehmen|impresa individuale)\\b")),
    
    is_gmbh = as.integer(str_detect(company_name, "\\b(GmbH|Sàrl|Srl|SAGL|Sagl|SARL|sàrl|SàRL|SÀRL)\\b")),
    
    is_gmbh2 = as.integer(str_detect(publicationText, "\\b(Gesellschaft mit beschränkter Haftung|società a garanzia limitata)\\b")),
    
    is_stiftung = as.integer(str_detect(publicationText, "\\b(Stiftung|Fondation|Fondazione)\\b")),
    
    is_verein = as.integer(str_detect(publicationText, "\\b(Verein|Association|association|Associazione|associazione)\\b")),
    
    is_genossenschat = as.integer(str_detect(publicationText, "\\b(Genossenschaft|société coopérative|Société Coopérative)\\b")),
    
    company_as_founder = as.integer(str_detect(publicationText, "\\b(Firma Hauptsitz|Société anonyme|Ditta della sede principale)\\b")),
    
   owner_info = str_extract(publicationText, "(Eingetragene Person(en)?|Eingetragenen Personen|Administration|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personnes inscrites|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*)(.*?)\\s*(?=\\sbut|\\sBut|$)"),
   
    owner_info_cleaned = str_trim(str_replace(owner_info, "(Eingetragene Person(en)?|Eingetragenen Personen|Administration|Conseil de fondation|Membres du conseil de fondation|Comité|Signature individuelle de|conseil de fondation|Conseil de fondation|Membres du conseil|Membres de la direction|Membres du comité avec signature collective à deux|Membres du comité|Personnes inscrites|Titulaire|Persone iscritte|Associés-gérants avec signature individuelle|Associés|Associé|Associés-gérants avec signature collective à deux|Associé-gérant avec signature individuelle|Associée-gérante|Associé-gérant|Personne inscrite|Personne\\(s\\)? inscrite\\(s\\)?)(\\s*[:;]?\\s*) ?", "")), 
   
    owner_nationality = sapply(owner_info_cleaned, extract_nationalities, countries$country.name.fr),
   
    owner_nationality_company = sapply(owner_info_cleaned, extract_nationalities22, countries$country.name.fr),
   
    ow_owc_identical = ifelse(owner_nationality == owner_nationality_company, TRUE, FALSE)
  )



#Code for evaluation of company code
##This code was used the evaluate the functions above.
df_sample <- df |>
  sample_n(size = 1000, replace = FALSE) |> select(senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company, ow_owc_identical)
df_test2 <- df |> filter(owner_nationality_company == "Company")
table(df_test2$senderOffice) #Most of the cases are produced by the "problem cantons". Manual correction for the other cases
df_test3 <- df |> filter(owner_nationality != owner_nationality_company)

df1 <- df %>% dplyr::filter(!is.na(owner_info))
df1$owner_nationality <- as.factor(df1$owner_nationality)
df_test <- df %>% dplyr::filter(is.na(owner_info))
# df_test <- Firmengründungen2022 %>% dplyr::filter(is.na(owner_info))
df_test2 <- df %>% dplyr::filter(company_as_founder == 1)
df_test3<- df %>% dplyr::filter(company_as_founder == 0) %>% dplyr::filter(is.na(owner_info))



###################################### Special treatment for problematic cantons
##These cantons have a very different approach for naming the founders, so a different approach for the extraction is necessary.
offices_to_exclude <- c("Registre du commerce du Canton de Genève", 
                        "Registre du commerce du Canton de Neuchâtel", 
                        "Registre du commerce du Canton de Vaud")

df_new <- df %>% 
  dplyr::filter((senderOffice %in% offices_to_exclude))

#Code that ensures that locations of companies that are founders are not wrongly picked up by the code.
df_new$owner_info_cleaned <- sub("\\(CHE-\\d+\\.\\d+\\.\\d+\\), à", "", df_new$owner_info_cleaned)

#Creation of a new variable to store the extracted nationalities
df_new$nationality <- NA

#For each row in the data frame
for (i in 1:nrow(df_new)) {
  
  #Skip if the value is NA
  if(is.na(df_new$owner_info_cleaned[i])){
    next
  }
  #Extract the string between "de" or "du" and "à" (it should be the nationality)
  nationalities <- str_extract_all(df_new$owner_info_cleaned[i], "(?<=, de |, du |, d'|, des ).*?(?=, à|, au)")
  #Count the number of "de et à" in the text and add that many "Swiss" to the nationalities
  swiss_count <- str_count(df_new$owner_info_cleaned[i], "de et à| de et au| du et au")
  if (swiss_count > 0) {
    nationalities[[1]] <- c(nationalities[[1]], rep("Swiss", swiss_count))
  }
  #Check if nationality is not null 
  if (length(nationalities[[1]]) > 0) {
    #Assign the extracted nationality to the nationality column
    df_new$nationality[i] <- paste(nationalities[[1]], collapse = "; ")
  }
}


df_newxy <- dplyr::filter(df_new, is.na(nationality))




#Create a new column to store the matching countries
df_new$match_country <- NA

#For each row in df_new
for (i in 1:nrow(df_new)) {
  #Skip if the value is NA
  if(is.na(df_new$nationality[i])){
    next
  }
  #Extract the nationalities
  nationalities <- strsplit(df_new$nationality[i], split = "; ")
  #Initialize a list to store the matching countries
  matches <- c()
  #For each nationality
  for (nat in nationalities[[1]]) {
    #Check if nationality exists in countries$country.name.fr
    if (nat %in% countries$country.name.fr) {
      matches <- c(matches, nat)
    } else {
      matches <- c(matches, "Swiss")
    }
  }
  #Save the matches, separated by a semicolon
  df_new$match_country[i] <- paste(matches, collapse = "; ")
}


#Evaluation to see if the code worked
set.seed(1234)
df_newsample2 <- df_new |>
  sample_n(size = 1000, replace = FALSE) |> select(id, senderOffice, publicationText, owner_info, owner_info_cleaned, owner_nationality, owner_nationality_company)



#Merging datasets 
##Merging the "older" data set with the newer one with the special approach for the three problematic cantons.
df <- left_join(df, df_new[c("id", "match_country")], by = "id") 

df2 <- df |> dplyr::mutate( 

  owner_nationality = coalesce(match_country, owner_nationality), 

  owner_nationality_company = coalesce(match_country, owner_nationality_company) 

) 

df2$owner_nationality_wcomp <- NA 

df2$owner_nationality_wcomp <- str_replace_all(df2$owner_nationality_company, "Company, |, Company|Company", "") #added company for the cases where it is mentioned without a comma, because only companies are named 

  
# Remove the match_country column 
df2$match_country <- NULL 
df <- df2 


######################################Correction for wrong "Administration" cases
##The word "Administration" is used in some names of German companies. However, it is also a keyword for the French cases. Therefore, a correction has the be made for the cases where the code wrongfully identified the names as keywords. The correction is done manually.


df[df$id == "92eebfbc-ca94-463e-b5be-a47e4a4616e6", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "29f12c0f-2103-4560-86da-6a0381e2bfc6", "owner_nationality_wcomp"] <- NA
df[df$id == "ecde52d7-98ff-406c-a726-601e2e16ca69", "owner_nationality_wcomp"] <- NA
df[df$id == "cf09f29e-044a-4fe1-b904-f014a090ae48", "owner_nationality_wcomp"] <- NA
df[df$id == "2fad12bd-df19-4327-abaf-afc73b5762b2", "owner_nationality_wcomp"] <- NA
df[df$id == "0da60f2a-e244-4c9d-a922-3c89e7ba35b0", "owner_nationality_wcomp"] <- "britischer Staatsangehörige, britischer Staatsangehörige, estnischer Staatsangehörige, britischer Staatsangehörige, britische Staatsangehörige, Swiss"
df[df$id == "09213b4a-ad2c-433f-924e-cf0ad9922c6b", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "67ee03eb-9dc3-4b71-af29-19e8b9ba2c56", "owner_nationality_wcomp"] <- NA
df[df$id == "0416961a-f4a2-42b4-95b1-d79929872ef8", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "05c2be2b-0522-4529-9331-5e76b3cf18e1", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "ddb810ac-66b0-4a53-8ae3-341401140c45", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "72a0b71c-895c-4a7b-a706-d952d972debf", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "41ec6486-3880-4e57-a4b2-00870e265980", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "38541521-8b7e-4868-aefb-e3cbbc749393", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "b0068444-ff1d-4662-9860-f20d372712f0", "owner_nationality_wcomp"] <- "niederländischer Staatsangehörige, österreichischer Staatsangehörige, Swiss"
df[df$id == "7e31bcc2-1940-45e8-8c86-c557cdde8862", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "1e4d3c56-6179-405c-9927-8538524b8291", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss, Swiss"
df[df$id == "d646245c-c80f-4762-828a-d40543d65427", "owner_nationality_wcomp"] <- "deutscher Staatsangehörige"
df[df$id == "3292b0ff-6b40-4356-800a-73bd801af80b", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss"
df[df$id == "0d6e758c-69b5-42db-a2e3-4d575368e97a", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "44ae7f62-dbe9-49aa-b3bb-b204048f6f29", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "abc520ae-2753-4f40-b754-b865e307deac", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "abc520ae-2753-4f40-b754-b865e307deac", "owner_nationality_wcomp"] <- "Swiss"
df[df$id == "920d0e22-8a27-44c5-be12-773a45365459", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "b94af007-570c-4678-b26f-b498754a8b75", "owner_nationality_wcomp"] <- "Swiss, Swiss"
df[df$id == "4df0042a-4d4c-42ff-ae05-b0340af4c611", "owner_nationality_wcomp"] <- "Swiss, Swiss, Swiss, Swiss"
df[df$id == "eeff1941-0773-42e7-89ae-d391deac29f1", "owner_nationality_wcomp"] <- "österreichische Staatsangehörige, österreichische Staatsangehörige, Swiss"


#Manual correction for some cases where the company code should have worked but where it didn't
id_values <- c("19985828-9025-499d-89ba-2fc690eb8308", "71f8f1f1-66a2-44ee-9d14-3bf54d8db5c7", 	
"8eb45f9d-fe59-4d84-819d-2fc4dbee5f39", "0624af7c-45a7-4952-948b-ee63b9a15bbd", "ae7102fc-0522-4764-a4af-2b670889ea11", "b275ddf5-1785-4b8a-a756-ac44b2acf8ec")
df$owner_nationality_wcomp[df$id %in% id_values] <- df$owner_nationality_wcomp[df$id %in% id_values]



###################################### Einzelunternehmen, delete second persons
##We focus only on the founder here and not any other "Zeichnungsberechtigte Personen".

#Function to extract the first nationality from the comma- or semicolon-separated string
extract_first_nationality <- function(nationalities) {
  nationality <- strsplit(nationalities, ",|;")[[1]][1]
  return(trimws(nationality))
}

 
#Delete additional persons for "Einzelunternehmen"
df <- df %>%
  mutate(owner_nationality_wcomp2 = ifelse(is_einzelunternehmen == "1",
                                    sapply(owner_nationality_wcomp, extract_first_nationality),
                                    owner_nationality_wcomp))


#Check how many NAs are left
df$owner_nationality_empty <- nzchar(df$owner_nationality_wcomp2)
df_warum <- df %>% dplyr::filter(owner_nationality_empty == FALSE)
table(df_warum$company_as_founder)


#Data inspection of NAs and see how many "Zweigniederlassungen" there are.
##A lot of the NAs are "Zweigniederlassungen" which we do not include in the final data, as they are not a "new" company in the sense as we use it on our study.
df_warum$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale de|succursale d')\\b"))
df_warum$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df_warum$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df_warum$ZweigniederlassungDE <- as.integer(str_detect(df_warum$publicationText, "\\b(Firma Hauptsitz)\\b"))
df_warum$Zweigniederlassung <- as.integer(df_warum$ZweigniederlassungFR == 1 | df_warum$ZweigniederlassungDE == 1 | df_warum$ZweigniederlassungIT == 1)
table(df_warum$Zweigniederlassung)


#Filter whole data of Zweigniederlassungen
df$ZweigniederlassungFR <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale de|succursale d')\\b"))
df$ZweigniederlassungIT <- as.integer(str_detect(str_to_lower(df$publicationText), "\\b(succursale di|succursale svizzera)\\b"))
df$ZweigniederlassungDE <- as.integer(str_detect(df$publicationText, "\\b(Firma Hauptsitz)\\b"))
df$Zweigniederlassung <- as.integer(df$ZweigniederlassungFR == 1 | df$ZweigniederlassungDE == 1 | df$ZweigniederlassungIT == 1)
table(df$Zweigniederlassung)
df <- df %>% dplyr::filter(Zweigniederlassung == 0)

######################################Saving the dataset
saveRDS(df, "Firmengründungen2022.Rds")



#####################################Additional cleaning
#Check for number of mentions of "tous deux" and therefore robustness of the data

Firmengründungen2022 <- readRDS("Firmengründungen2022.Rds")
shab22_comp <- readRDS("shab22_complete.Rds")

shab22_comp_überprüfung <- shab22_comp %>%
  mutate(tousdeux = as.integer(str_detect(publicationText, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)

Firmengründungen2022_überprüfung <- Firmengründungen2022 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>%
  filter(tousdeux == 1)


#Filter out the above specified cases and filter for empty owner_nationality_wcomp2
Firmengründungen2022 <- Firmengründungen2022 %>%
  mutate(tousdeux = as.integer(str_detect(owner_info_cleaned, "\\b(tous deux de|Tous deux de|Tous deux du|Tous deux du|Tous deux des|Tous deux des)\\b"))) %>% 
  dplyr::filter(tousdeux != 1) %>%
  dplyr::filter(!is.na(owner_nationality_wcomp2))


#Calculation of error rate for the text
221/50015

(1054-50+(48737-48224))/(50015)


######################################Saving the dataset
saveRDS(Firmengründungen2022, "Firmengründungen2022.Rds")
```


###Additional variables (2022)
Note: Additional variables for the other years are created in the chunk "Lineplot over time" later in the script
```{r}
#Load the necessary data
Firmengründungen2022 <- readRDS("Firmengründungen2022.Rds")

#Make one column with all "Rechtsformen"
#is.ag
Firmengründungen2022$is_ag_or_sa[Firmengründungen2022$is_ag_or_sa==1] <- "AG"
Firmengründungen2022$is_ag_or_sa[Firmengründungen2022$is_ag_or_sa==0] <- NA
#is.gmbh
Firmengründungen2022$is_gmbh[Firmengründungen2022$is_gmbh==1] <- "GmbH"
Firmengründungen2022$is_gmbh[Firmengründungen2022$is_gmbh==0] <- NA
#is.gmbh2
Firmengründungen2022$is_gmbh2[Firmengründungen2022$is_gmbh2==1] <- "GmbH"
Firmengründungen2022$is_gmbh2[Firmengründungen2022$is_gmbh2==0] <- NA
#is.kollektiv
Firmengründungen2022$is_kollektivgesellschaft[Firmengründungen2022$is_kollektivgesellschaft==1] <- "Kollektivgesellschaft"
Firmengründungen2022$is_kollektivgesellschaft[Firmengründungen2022$is_kollektivgesellschaft==0] <- NA
#is.kommandit
Firmengründungen2022$is_kommanditgesellschaft[Firmengründungen2022$is_kommanditgesellschaft==1] <- "Kommanditgesellschaft"
Firmengründungen2022$is_kommanditgesellschaft[Firmengründungen2022$is_kommanditgesellschaft==0] <- NA
#is.einzelunternehmen
Firmengründungen2022$is_einzelunternehmen[Firmengründungen2022$is_einzelunternehmen==1] <- "Einzelunternehmen"
Firmengründungen2022$is_einzelunternehmen[Firmengründungen2022$is_einzelunternehmen==0] <- NA
#is.stiftung
Firmengründungen2022$is_stiftung[Firmengründungen2022$is_stiftung==1] <- "Stiftung"
Firmengründungen2022$is_stiftung[Firmengründungen2022$is_stiftung==0] <- NA
#is.verein
Firmengründungen2022$is_verein[Firmengründungen2022$is_verein==1] <- "Verein"
Firmengründungen2022$is_verein[Firmengründungen2022$is_verein==0] <- NA
#is.genossenschaft
Firmengründungen2022$is_genossenschat[Firmengründungen2022$is_genossenschat==1] <- "Genossenschaft"
Firmengründungen2022$is_genossenschat[Firmengründungen2022$is_genossenschat==0] <- NA

#collapse all columns into one by getting rid of the NAs
Firmengründungen2022_2 = Firmengründungen2022 %>% mutate(Rechtsform = coalesce(is_ag_or_sa,is_gmbh, is_gmbh2, is_einzelunternehmen,
                                                 is_kollektivgesellschaft, is_kommanditgesellschaft, is_stiftung,
                                                 is_verein, is_genossenschat)) %>% select(Rechtsform)

#cbind the new column to the existing dataframe
Firmengründungen2022 = cbind(Firmengründungen2022, Firmengründungen2022_2)

#Remove NAs if necessary
na_rows <- is.na(rownames(Firmengründungen2022)) & apply(Firmengründungen2022, 1, function(x) all(is.na(x)))
df_no_na <- Firmengründungen2022[!na_rows, ]

#Investigating data quality
Firmengrundungen2022_NA <- Firmengründungen2022 %>% filter(is.na(owner_info)) %>% dplyr::select(publicationText, company_as_founder:owner_nationality_wcomp2)

Firmengründungen2022 <- Firmengründungen2022 %>% dplyr::filter(!is.na(owner_info)) %>% dplyr::filter(!is.na(owner_nationality_wcomp2))
saveRDS(Firmengründungen2022, "Firmengründungen2022.Rds")


###################################### Make new column for "Staatangehörigkeit nach Unternehmen"

#Add empty column
Firmengründungen2022 <- Firmengründungen2022 |>
  add_column(Staatsbürgerschaft = NA)
View(Firmengründungen2022)

#Function to categorize the nationalities.
get_nationalities <- function(owner_nationality_wcomp2) {
  unique_nationalities <- unique(strsplit(owner_nationality_wcomp2, ", |; ")[[1]])

  if (length(unique_nationalities) == 1 && unique_nationalities != "") {
    return(unique_nationalities)
  } else if ("Swiss" %in% unique_nationalities) {
    return("Schweizer und Ausländer")
  } else {
    return("untersch. ausländ. Staatsangehörigkeiten")
  }
}

#Apply the function to create the column 'Staatsbürgerschaft'
Firmengründungen2022$Staatsbürgerschaft <- sapply(Firmengründungen2022$owner_nationality_wcomp2, get_nationalities)

#Change "Swiss" to "Schweizer"
Firmengründungen2022$Staatsbürgerschaft <- ifelse(Firmengründungen2022$Staatsbürgerschaft == "Swiss", "Schweizer", Firmengründungen2022$Staatsbürgerschaft)

#Rename all values in the "Staatsbürgerschaft" column except for "Schweiz" & "Schweizer und Ausländer" to "Ausländer"
Firmengründungen2022$Staatsbürgerschaft2 <- ifelse(Firmengründungen2022$Staatsbürgerschaft != "Schweizer" &
                                                     Firmengründungen2022$Staatsbürgerschaft != "Schweizer und Ausländer",
                                                   "Ausländer",
                                                   Firmengründungen2022$Staatsbürgerschaft)


#Save the new data frame with new variables
saveRDS(Firmengründungen2022, "Firmengründungen2022.Rds")
```


#Plots on company-level
In the following chunk, we made all plots for the year 2022 on the company level (that means broken down by legal form, cantons and groups (swiss, foreigners and both together)). The graphics are not based on each other. This means that you don't have to run through the entire section, but can create the graphics independently of each other.
##Form and Cantons
```{r}
##Barplot "Neugründungen nach Staatsangehörigkeit der Gründer:innen" ##

barplot_neugründungen2022 <- ggplot(Firmengründungen2022, aes(x = Staatsbürgerschaft2, fill = Staatsbürgerschaft2)) +
  geom_bar() + theme_minimal() +
  geom_text(aes(label = paste0(round((..count..) / sum(..count..) * 100), "%")), stat = "count", vjust = -0.5, size = 7, color = "black", family = "Times New Roman") +  
  scale_fill_manual(values = c("#0028A5",  "#A5B5D9","#F1977A")) +
  labs(title = "Neugründungen 2022 nach Staatsangehörigkeit der Gründer:innen", x = "", y = "Anzahl") +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=0), 
        legend.title = element_text(size=20),
        legend.position = "none",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))+
  scale_x_discrete(labels = c("Ausländer:innen", "Schweizer:innen und Ausländer:innen", "Schweizer:innen"))

ggsave("barplot_neugründungen2022.jpg",  barplot_neugründungen2022, height= 8, width=12)

##  Barplot "Neugründungen 2022 nach Rechtsform der Unternehmen" ##

#Filter out NA values in the "Rechtsform" column
filtered_na_rechtsform <- Firmengründungen2022[complete.cases(Firmengründungen2022$Rechtsform), ]

#Reorder levels of the "Staatsbürgerschaft2" column for the barplot
filtered_na_rechtsform$Staatsbürgerschaft2 <- factor(filtered_na_rechtsform$Staatsbürgerschaft2,levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

#Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Define a custom order for the Rechtsform levels, i.e. order them by number of observations
custom_order <- c("GmbH", "Einzelunternehmen", "AG", "Kollektivgesellschaft", "Verein", "Stiftung", "Genossenschaft", "Kommanditgesellschaft")
filtered_na_rechtsform$Rechtsform <- factor(filtered_na_rechtsform$Rechtsform, levels = custom_order)

#Create barplot
barplot_rechtsform2022 <- ggplot(filtered_na_rechtsform, aes(x = Rechtsform, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "stack") +
  theme_minimal() +
  labs(title = "Neugründungen 2022 nach Rechtsform der Unternehmen",
       x = "",
       y = "Anzahl", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) +
  theme(text = element_text(family = "Times New Roman"),
        strip.text.x = element_text(size = 7),
        axis.text.x = element_text(size = 25, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 20),
        legend.text = element_text(size = 22),
        legend.title = element_text(size = 22),
        legend.position = "bottom",
        plot.title = element_text(size = 25, face = "bold"),
        plot.subtitle = element_text(size = 15),
        axis.title = element_text(size = 15))

ggsave("barplot_rechtsform2022.jpg",  barplot_rechtsform2022, height= 16, width=20)

## Stacked Barplot "Anteil Neugründungen 2022 nach Rechtsform" ##

#Filter out NA values in the "Rechtsform" column
filtered_na_rechtsform <- Firmengründungen2022[complete.cases(Firmengründungen2022$Rechtsform), ]

#Reorder levels of the "Staatsbürgerschaft2" column for the stacked barplot
filtered_na_rechtsform$Staatsbürgerschaft2 <- factor(filtered_na_rechtsform$Staatsbürgerschaft2,levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Create stacked barplot
stacked_barplot_staatsbürgerschaft2022 <- ggplot(filtered_na_rechtsform, aes(x = Rechtsform, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "fill") +
  theme_minimal() +
  labs(title = "Anteil Neugründungen 2022 nach Rechtsform",
       x = "",
       y = "", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + coord_flip() +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.text = element_text(size=13), 
        legend.title = element_text(size=13),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18))  + scale_y_continuous(labels = scales::percent)

ggsave("stacked_barplot_staatsbürgerschaft2022.jpg",  stacked_barplot_staatsbürgerschaft2022, height= 8, width=12)


## Stacked Barplot "Neugründungen 2022 nach Kantone" ##

Firmengründungen2022$Staatsbürgerschaft2 <- factor(Firmengründungen2022$Staatsbürgerschaft2,
                                                   levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Create stacked barplot
stacked_barplot_kantone2022 <- ggplot(Firmengründungen2022, aes(x = cantons, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "fill") + theme_minimal() + labs(title = "Anteil an Neugründungen 2022 nach Kantone", x = "", y = "", fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + coord_flip()+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=12.5),
        legend.title = element_text(size=12.5),
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15)) + scale_y_continuous(labels = scales::percent)

ggsave("stacked_barplot_kantone2022.jpg", stacked_barplot_kantone2022, height= 8, width=12)

#Calculations for numbers in text
perc_cantons <- Firmengründungen2022 |> group_by(cantons, Staatsbürgerschaft2) |> summarize(n = n()) |> group_by(cantons) |> mutate(cantonsum = sum(n)) |> ungroup() |> mutate(perc = (n/cantonsum)*100)


## Barplot "Neugründungen 2022 nach Kantone" ##

Firmengründungen2022$Staatsbürgerschaft2 <- factor(Firmengründungen2022$Staatsbürgerschaft2,
                                                   levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Create a summary table of counts for each cantons level
cantons_counts <- table(Firmengründungen2022$cantons)

#Order the cantons based on the count in descending order and create a corresponding factor
ordered_cantons <- names(sort(cantons_counts, decreasing = TRUE))
Firmengründungen2022$cantons <- factor(Firmengründungen2022$cantons, levels = ordered_cantons)

#Create barplot
barplot_kantone2022 <- ggplot(Firmengründungen2022, aes(x = cantons, fill = Staatsbürgerschaft2)) +
  geom_bar() + theme_minimal() + labs(title = "Neugründungen 2022 nach Kantone",
                                      x = "", y = "Anzahl", 
                                      fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels)+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=13),
        legend.title = element_text(size=13),
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))

ggsave("barplot_kantone2022.jpg", barplot_kantone2022, height= 8, width=12)



##Crosstab with the variables Staatsbürgerschaft2 and Rechtsform
#Create a summary table for the "Staatsbürgerschaft2" variable
tbl_cross2 <- Firmengründungen2022 %>%
  select(Staatsbürgerschaft2, Rechtsform) %>%
  tbl_summary(by = Staatsbürgerschaft2, missing = "ifany") %>%
  bold_labels() %>%
  italicize_levels() 

#Convert tbl_cross2 to a gt table object
crosstab <- as_gt(tbl_cross2)

#Save the gt table as an png-image
gtsave(crosstab, filename = "crosstab.png")
```


##Lineplot over time
In the following chunk, the variables Rechtsform and Staatsbürgerschaft2 are created for the years 2019, 2020 and 2021 (note that the same variables were already created for 2022 in the code chunk "additional variables (2022)". Then, the graphs for the time series are built (lineplot, areaplot).

```{r}
#### Lineplot over time ###
#create variables for 2019 (Rechtsform and Staatsbürgerschaft2)
Firmengründungen2019 <- readRDS("Firmengründungen2019.Rds")

#Make one column with all "Rechtsformen"
#is.ag
Firmengründungen2019$is_ag_or_sa[Firmengründungen2019$is_ag_or_sa==1] <- "AG"
Firmengründungen2019$is_ag_or_sa[Firmengründungen2019$is_ag_or_sa==0] <- NA
#is.gmbh
Firmengründungen2019$is_gmbh[Firmengründungen2019$is_gmbh==1] <- "GmbH"
Firmengründungen2019$is_gmbh[Firmengründungen2019$is_gmbh==0] <- NA
#is.gmbh2
Firmengründungen2019$is_gmbh2[Firmengründungen2019$is_gmbh2==1] <- "GmbH"
Firmengründungen2019$is_gmbh2[Firmengründungen2019$is_gmbh2==0] <- NA
#is.kollektiv
Firmengründungen2019$is_kollektivgesellschaft[Firmengründungen2019$is_kollektivgesellschaft==1] <- "Kollektivgesellschaft"
Firmengründungen2019$is_kollektivgesellschaft[Firmengründungen2019$is_kollektivgesellschaft==0] <- NA
#is.kommandit
Firmengründungen2019$is_kommanditgesellschaft[Firmengründungen2019$is_kommanditgesellschaft==1] <- "Kommanditgesellschaft"
Firmengründungen2019$is_kommanditgesellschaft[Firmengründungen2019$is_kommanditgesellschaft==0] <- NA
#is.einzelunternehmen
Firmengründungen2019$is_einzelunternehmen[Firmengründungen2019$is_einzelunternehmen==1] <- "Einzelunternehmen"
Firmengründungen2019$is_einzelunternehmen[Firmengründungen2019$is_einzelunternehmen==0] <- NA
#is.stiftung
Firmengründungen2019$is_stiftung[Firmengründungen2019$is_stiftung==1] <- "Stiftung"
Firmengründungen2019$is_stiftung[Firmengründungen2019$is_stiftung==0] <- NA
#is.verein
Firmengründungen2019$is_verein[Firmengründungen2019$is_verein==1] <- "Verein"
Firmengründungen2019$is_verein[Firmengründungen2019$is_verein==0] <- NA
#is.genossenschaft
Firmengründungen2019$is_genossenschat[Firmengründungen2019$is_genossenschat==1] <- "Genossenschaft"
Firmengründungen2019$is_genossenschat[Firmengründungen2019$is_genossenschat==0] <- NA

#collapse all columns into one by getting rid of the NAs
Firmengründungen2019_2 = Firmengründungen2019 %>% mutate(Rechtsform = coalesce(is_ag_or_sa,is_gmbh, is_gmbh2, is_einzelunternehmen,
                                                 is_kollektivgesellschaft, is_kommanditgesellschaft, is_stiftung,
                                                 is_verein, is_genossenschat)) %>% select(Rechtsform)

#cbind the new column to the existing dataframe
Firmengründungen2019 = cbind(Firmengründungen2019, Firmengründungen2019_2)

#Remove NAs if necessary
na_rows <- is.na(rownames(Firmengründungen2019)) & apply(Firmengründungen2019, 1, function(x) all(is.na(x)))
df_no_na <- Firmengründungen2019[!na_rows, ]

#Investigating data quality
Firmengrundungen2019_NA <- Firmengründungen2019 %>% filter(is.na(owner_info)) %>% dplyr::select(publicationText, company_as_founder:owner_nationality_wcomp2)

Firmengründungen2019 <- Firmengründungen2019 %>% dplyr::filter(!is.na(owner_info)) %>% dplyr::filter(!is.na(owner_nationality_wcomp2))

###################################### Make new column for "Staatangehörigkeit nach Unternehmen"

#Add empty column
Firmengründungen2019 <- Firmengründungen2019 |>
  add_column(Staatsbürgerschaft = NA)
View(Firmengründungen2019)

#Function to determine the value of column 'y' based on 'x'
get_nationalities <- function(owner_nationality_wcomp2) {
  # Split the input string on comma or semicolon followed by a space
  unique_nationalities <- unique(strsplit(owner_nationality_wcomp2, ", |; ")[[1]])

  if (length(unique_nationalities) == 1 && unique_nationalities != "") {
    return(unique_nationalities)
  } else if ("Swiss" %in% unique_nationalities) {
    return("Schweizer und Ausländer")
  } else {
    return("untersch. ausländ. Staatsangehörigkeiten")
  }
}

#Apply the function to create column 'Staatsbürgerschaft'
Firmengründungen2019$Staatsbürgerschaft <- sapply(Firmengründungen2019$owner_nationality_wcomp2, get_nationalities)

#Change "Swiss" to "Schweizer" in column 'Staatsbürgerschaft'
Firmengründungen2019$Staatsbürgerschaft <- ifelse(Firmengründungen2019$Staatsbürgerschaft == "Swiss", "Schweizer", Firmengründungen2019$Staatsbürgerschaft)

#Rename all values in the "Staatsbürgerschaft" column except for "Schweiz" & "Schweizer und Ausländer" to "Ausländer"
Firmengründungen2019$Staatsbürgerschaft2 <- ifelse(Firmengründungen2019$Staatsbürgerschaft != "Schweizer" &
                                                               Firmengründungen2019$Staatsbürgerschaft != "Schweizer und Ausländer",
                                                             "Ausländer",
                                                             Firmengründungen2019$Staatsbürgerschaft)
saveRDS(Firmengründungen2019, "Firmengründungen2019.Rds")

#create variables for 2020 (Rechtsform and Staatsbürgerschaft2)
Firmengründungen2020 <- readRDS("Firmengründungen2020.Rds")

#Make one column with all "Rechtsformen"
#is.ag
Firmengründungen2020$is_ag_or_sa[Firmengründungen2020$is_ag_or_sa==1] <- "AG"
Firmengründungen2020$is_ag_or_sa[Firmengründungen2020$is_ag_or_sa==0] <- NA
#is.gmbh
Firmengründungen2020$is_gmbh[Firmengründungen2020$is_gmbh==1] <- "GmbH"
Firmengründungen2020$is_gmbh[Firmengründungen2020$is_gmbh==0] <- NA
#is.gmbh2
Firmengründungen2020$is_gmbh2[Firmengründungen2020$is_gmbh2==1] <- "GmbH"
Firmengründungen2020$is_gmbh2[Firmengründungen2020$is_gmbh2==0] <- NA
#is.kollektiv
Firmengründungen2020$is_kollektivgesellschaft[Firmengründungen2020$is_kollektivgesellschaft==1] <- "Kollektivgesellschaft"
Firmengründungen2020$is_kollektivgesellschaft[Firmengründungen2020$is_kollektivgesellschaft==0] <- NA
#is.kommandit
Firmengründungen2020$is_kommanditgesellschaft[Firmengründungen2020$is_kommanditgesellschaft==1] <- "Kommanditgesellschaft"
Firmengründungen2020$is_kommanditgesellschaft[Firmengründungen2020$is_kommanditgesellschaft==0] <- NA
#is.einzelunternehmen
Firmengründungen2020$is_einzelunternehmen[Firmengründungen2020$is_einzelunternehmen==1] <- "Einzelunternehmen"
Firmengründungen2020$is_einzelunternehmen[Firmengründungen2020$is_einzelunternehmen==0] <- NA
#is.stiftung
Firmengründungen2020$is_stiftung[Firmengründungen2020$is_stiftung==1] <- "Stiftung"
Firmengründungen2020$is_stiftung[Firmengründungen2020$is_stiftung==0] <- NA
#is.verein
Firmengründungen2020$is_verein[Firmengründungen2020$is_verein==1] <- "Verein"
Firmengründungen2020$is_verein[Firmengründungen2020$is_verein==0] <- NA
#is.genossenschaft
Firmengründungen2020$is_genossenschat[Firmengründungen2020$is_genossenschat==1] <- "Genossenschaft"
Firmengründungen2020$is_genossenschat[Firmengründungen2020$is_genossenschat==0] <- NA

#collapse all columns into one by getting rid of the NAs
Firmengründungen2020_2 = Firmengründungen2020 %>% mutate(Rechtsform = coalesce(is_ag_or_sa,is_gmbh, is_gmbh2, is_einzelunternehmen,
                                                 is_kollektivgesellschaft, is_kommanditgesellschaft, is_stiftung,
                                                 is_verein, is_genossenschat)) %>% select(Rechtsform)

#cbind the new column to the existing dataframe
Firmengründungen2020 <- cbind(Firmengründungen2020, Firmengründungen2020_2)

#Remove NAs if necessary
na_rows <- is.na(rownames(Firmengründungen2020)) & apply(Firmengründungen2020, 1, function(x) all(is.na(x)))
df_no_na <- Firmengründungen2020[!na_rows, ]

#Investigating data quality
Firmengrundungen2020_NA <- Firmengründungen2020 %>% filter(is.na(owner_info)) %>% dplyr::select(publicationText, company_as_founder:owner_nationality_wcomp2)

Firmengründungen2020 <- Firmengründungen2020 %>% dplyr::filter(!is.na(owner_info)) %>% dplyr::filter(!is.na(owner_nationality_wcomp2))

###################################### Make new column for "Staatangehörigkeit nach Unternehmen"

#Add empty column
Firmengründungen2020 <- Firmengründungen2020 |>
  add_column(Staatsbürgerschaft = NA)
View(Firmengründungen2020)

#Apply the function to create column 'Staatsbürgerschaft'
Firmengründungen2020$Staatsbürgerschaft <- sapply(Firmengründungen2020$owner_nationality_wcomp2, get_nationalities)

#Change "Swiss" to "Schweizer" in column 'Staatsbürgerschaft'
Firmengründungen2020$Staatsbürgerschaft <- ifelse(Firmengründungen2020$Staatsbürgerschaft == "Swiss", "Schweizer", Firmengründungen2020$Staatsbürgerschaft)

#Rename all values in the "Staatsbürgerschaft" column except for "Schweiz" & "Schweizer und Ausländer" to "Ausländer"
Firmengründungen2020$Staatsbürgerschaft2 <- ifelse(Firmengründungen2020$Staatsbürgerschaft != "Schweizer" &
                                                          Firmengründungen2020$Staatsbürgerschaft != "Schweizer und Ausländer",
                                                        "Ausländer",
                                                        Firmengründungen2020$Staatsbürgerschaft)
saveRDS(Firmengründungen2020, "Firmengründungen2020.Rds")

#create variables for 2021 (Rechtsform and Staatsbürgerschaft2)
Firmengründungen2021 <- readRDS("Firmengründungen2021.Rds")

#Make one column with all "Rechtsformen"
#is.ag
Firmengründungen2021$is_ag_or_sa[Firmengründungen2021$is_ag_or_sa==1] <- "AG"
Firmengründungen2021$is_ag_or_sa[Firmengründungen2021$is_ag_or_sa==0] <- NA
#is.gmbh
Firmengründungen2021$is_gmbh[Firmengründungen2021$is_gmbh==1] <- "GmbH"
Firmengründungen2021$is_gmbh[Firmengründungen2021$is_gmbh==0] <- NA
#is.gmbh2
Firmengründungen2021$is_gmbh2[Firmengründungen2021$is_gmbh2==1] <- "GmbH"
Firmengründungen2021$is_gmbh2[Firmengründungen2021$is_gmbh2==0] <- NA
#is.kollektiv
Firmengründungen2021$is_kollektivgesellschaft[Firmengründungen2021$is_kollektivgesellschaft==1] <- "Kollektivgesellschaft"
Firmengründungen2021$is_kollektivgesellschaft[Firmengründungen2021$is_kollektivgesellschaft==0] <- NA
#is.kommandit
Firmengründungen2021$is_kommanditgesellschaft[Firmengründungen2021$is_kommanditgesellschaft==1] <- "Kommanditgesellschaft"
Firmengründungen2021$is_kommanditgesellschaft[Firmengründungen2021$is_kommanditgesellschaft==0] <- NA
#is.einzelunternehmen
Firmengründungen2021$is_einzelunternehmen[Firmengründungen2021$is_einzelunternehmen==1] <- "Einzelunternehmen"
Firmengründungen2021$is_einzelunternehmen[Firmengründungen2021$is_einzelunternehmen==0] <- NA
#is.stiftung
Firmengründungen2021$is_stiftung[Firmengründungen2021$is_stiftung==1] <- "Stiftung"
Firmengründungen2021$is_stiftung[Firmengründungen2021$is_stiftung==0] <- NA
#is.verein
Firmengründungen2021$is_verein[Firmengründungen2021$is_verein==1] <- "Verein"
Firmengründungen2021$is_verein[Firmengründungen2021$is_verein==0] <- NA
#is.genossenschaft
Firmengründungen2021$is_genossenschat[Firmengründungen2021$is_genossenschat==1] <- "Genossenschaft"
Firmengründungen2021$is_genossenschat[Firmengründungen2021$is_genossenschat==0] <- NA

#collapse all columns into one by getting rid of the NAs
Firmengründungen2021_2 = Firmengründungen2021 %>% mutate(Rechtsform = coalesce(is_ag_or_sa,is_gmbh, is_gmbh2, is_einzelunternehmen,
                                                 is_kollektivgesellschaft, is_kommanditgesellschaft, is_stiftung,
                                                 is_verein, is_genossenschat)) %>% select(Rechtsform)

#cbind the new column to the existing dataframe
Firmengründungen2021 = cbind(Firmengründungen2021, Firmengründungen2021_2)

#Remove NAs if necessary
na_rows <- is.na(rownames(Firmengründungen2021)) & apply(Firmengründungen2021, 1, function(x) all(is.na(x)))
df_no_na <- Firmengründungen2021[!na_rows, ]

#Investigating data quality
Firmengrundungen2021_NA <- Firmengründungen2021 %>% filter(is.na(owner_info)) %>% dplyr::select(publicationText, company_as_founder:owner_nationality_wcomp2)

Firmengründungen2021 <- Firmengründungen2021 %>% dplyr::filter(!is.na(owner_info)) %>% dplyr::filter(!is.na(owner_nationality_wcomp2))

###################################### Make new column for "Staatangehörigkeit nach Unternehmen"

#Add empty column
Firmengründungen2021 <- Firmengründungen2021 |>
  add_column(Staatsbürgerschaft = NA)
View(Firmengründungen2021)


#Apply the function to create column 'Staatsbürgerschaft'
Firmengründungen2021$Staatsbürgerschaft <- sapply(Firmengründungen2021$owner_nationality_wcomp2, get_nationalities)

#Change "Swiss" to "Schweizer" in column 'Staatsbürgerschaft'
Firmengründungen2021$Staatsbürgerschaft <- ifelse(Firmengründungen2021$Staatsbürgerschaft == "Swiss", "Schweizer", Firmengründungen2021$Staatsbürgerschaft)

#Rename all values in the "Staatsbürgerschaft" column except for "Schweiz" & "Schweizer und Ausländer" to "Ausländer"
Firmengründungen2021$Staatsbürgerschaft2 <- ifelse(Firmengründungen2021$Staatsbürgerschaft != "Schweizer" &
                                                          Firmengründungen2021$Staatsbürgerschaft != "Schweizer und Ausländer",
                                                        "Ausländer",
                                                        Firmengründungen2021$Staatsbürgerschaft)
saveRDS(Firmengründungen2021, "Firmengründungen2021.Rds")


#Read back in data from 2022 for which the necessary variables were already created
Firmengründungen2022 <- readRDS("Firmengründungen2022.Rds")


#Create a subset of a dataframe with relevant columns only
subset_2019 <- Firmengründungen2019[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2019$Year <- 2019
subset_2020 <- Firmengründungen2020[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2020$Year <- 2020
subset_2021 <- Firmengründungen2021[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2021$Year <- 2021
subset_2022 <- Firmengründungen2022[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2022$Year <- 2022

#Combine the dataframes by row
combined_df <- rbind(subset_2019, subset_2020, subset_2021, subset_2022)

#Lineplot Staatsbürgerschaft2
#Filter the dataframe for the desired years
df_filtered <- combined_df %>% filter(Year %in% c(2019, 2020, 2021, 2022))

#Group the data by Year and Staatsbürgerschaft2 and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Staatsbürgerschaft2) %>%
  tally() %>%
  pivot_wider(names_from = Staatsbürgerschaft2, values_from = n, values_fill = 0)

#Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Category", values_to = "Count")

#Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Plot the line chart
linechart_staatsbürgerschaft2 <- ggplot(df_long, aes(x = Year, y = Count, color = Category, group = Category)) +
  geom_line(size = 1) +
  geom_point(size = 3) +
  labs(x = "", y = "Anzahl", title = "Gründungen nach Staatsangehörigkeit 2019-2022", color = "Neugründung durch:") +
  scale_color_manual(values = c("#0028A5", "#F1977A", "#A5B5D9"), labels=custom_labels) +
  theme_minimal() +
  guides(color = guide_legend(title = "Neugründungen durch:")) +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=13),
        legend.title = element_text(size=13),
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))



ggsave("linechart_staatsbürgerschaft2.jpg", linechart_staatsbürgerschaft2, height= 8, width=12)

#Linechart nach Rechtsform
#Filter out NAs in the Rechtsform variable
data_filtered <- combined_df %>%
  filter(!is.na(Rechtsform))
df_filtered <- data_filtered %>% filter(Year %in% c(2019, 2020, 2021, 2022))

#Group the data by Year and Rechtsform and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Rechtsform) %>%
  tally() %>%
  pivot_wider(names_from = Rechtsform, values_from = n, values_fill = 0)

#Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Rechtsform", values_to = "Count")

#Plot the line chart
linechart_rechtsform <- ggplot(df_long, aes(x = Year, y = Count, color = Rechtsform, group = Rechtsform)) +
  geom_line(size = 1) +
  geom_point(size = 3) +
  labs(x = "", y = "Anzahl", title = "Gründung nach Rechtsformen über die Zeit", color = "Rechtsform") +
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange", "cyan", "magenta", "yellow")) +
  theme_minimal() +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=16),
        legend.title = element_text(size=16),
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15)) +
  guides(color = guide_legend(title = "Rechtsform"))

#Saving
ggsave("linechart_rechtsform.png", linechart_rechtsform, width = 12, height = 8)

#Areachart (Staatsbürgerschaft2)
#Filter the dataframe for the desired years
df_filtered <- combined_df %>% filter(Year %in% c(2019, 2020, 2021, 2022))

#Group the data by Year and Staatsbürgerschaft2 and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Staatsbürgerschaft2) %>%
  tally() %>%
  pivot_wider(names_from = Staatsbürgerschaft2, values_from = n, values_fill = 0)

#Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Staatsbürgerschaft2", values_to = "Count")

#Define the order of levels for Staatsbürgerschaft2
df_long$Staatsbürgerschaft2 <- factor(df_long$Staatsbürgerschaft2, levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Plot the area chart
arechart_staatsangehörigkeit2 <- ggplot(df_long, aes(x = Year, y = Count, fill = Staatsbürgerschaft2)) +
  geom_area(position = "stack", alpha = 0.7) +
  labs(x = "", y = "Anzahl", title = "Gründer:innen nach Herkunft über die Zeit", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("#0028A5", "#A5B5D9", "#F1977A"), labels=custom_labels) +
  theme_minimal()+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=13),
        legend.title = element_text(size=13),
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))

ggsave("areachart_staatsangehörigkeit2.png", arechart_staatsangehörigkeit2, width = 12, height = 8)

#Calculations for numbers in text
df_longperc <- df_long |> group_by(Year) |> mutate(sum = sum(Count)) |> ungroup() |> mutate(perc = (Count/sum)*100)

ausl <- sum(df_longperc[1,3], df_longperc[4,3], df_longperc[7,3], df_longperc[10,3])

all <- sum(df_longperc[1,4], df_longperc[4,4], df_longperc[7,4], df_longperc[10,4])

(ausl/all)*100

```

#Plots on individual level
##Counting nationalities
The following code counts the nationalities and summarizes them. Eventually, the new the data frame shows which nationalities the founders of the year 2022 had and which one where the most prominent.
```{r}
#Load the necessary libraries
library(dplyr)
library(tidyr)
library(ggplot2)

#Create a new data frame with a separate row for each person's nationality
nationality_data <- data.frame(owner_nationality_wcomp2 = Firmengründungen2022$owner_nationality_wcomp2,
                               id = seq_along(Firmengründungen2022$owner_nationality_wcomp2))

nationality_data <- nationality_data %>%
  separate_rows(owner_nationality_wcomp2, sep = "[,;]\\s*") %>%
  rename(nationality = owner_nationality_wcomp2)


#Count the occurrences of each nationality
nationality_counts <- nationality_data %>%
  group_by(nationality) %>%
  summarise(count = n()) %>%
  arrange(desc(count))


#Create a mapping of non-German expressions to German expressions.
##Since the individual names of the nationalities are present in different languages, we must simplify the data and translate them all to German. This is done manually.
mapping <- c(
  "Swiss" = "schweizer Staatsangehörige:r",
  "cittadina italiana" = "italienische:r Staatsangehörige:r",
  "cittadino italiano" = "italienische:r Staatsangehörige:r",
  "Italie" = "italienische:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "cittadina brasiliana" = "brasilianische:r Staatsangehörige:r",
  "cittadino brasiliano" = "brasilianische:r Staatsangehörige:r",
  "Brésil" = "brasilianische:r Staatsangehörige:r",
  "brasilianische Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "brasilianischer Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "France" = "französische:r Staatsangehörige:r",
  "französischer Staatsangehörige" = "französische:r Staatsangehörige:r",
  "französische Staatsangehörige" = "französische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutscher Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "Allemagne" = "deutsche:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutsche Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "cittadina germanica" = "deutsche:r Staatsangehörige:r",
  "cittadino germanico" = "deutsche:r Staatsangehörige:r",
  "kosovarischer Staatsangehörige" = "kosovarische:r Staatsangehörige:r",
  "kosovarische Staatsangehörige" = "kosovarische:r Staatsangehörige:r", 
  "Kosovo" = "kosovarische:r Staatsangehörige:r",
  "Portugal" = "portugisische:r Staatsangehörige:r",
  "portugiesischer Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "portugiesische Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "türkischer Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "türkische Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "Turquie" = "türkische:r Staatsangehörige:r",
  "nordmazedonischer Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "nordmazedonische Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "österreichischer Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "österreichische Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "serbischer Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "serbische Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "syrischer Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "syrische Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "spanischer Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "spanische Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "Espagne" = "spanische:r Staatsangehörige:r",
  "britischer Staatsangehörige" = "britische:r Staatsangehörige:r",
  "britische Staatsangehörige" = "britische:r Staatsangehörige:r",
  "cittadina britannica" = "britische:r Staatsangehörige:r",
  "cittadino britannico" = "britische:r Staatsangehörige:r",
  "niederländischer Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "niederländische Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "kroatischer Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "kroatische Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "ungarischer Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "ungarische Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "rumänischer Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "rumänische Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "Roumanie" = "rumänische:r Staatsangehörige:r",
  "polnischer Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "polnische Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "amerikanischer Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "amerikanische Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "herzegowinischer Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "Belgique" = "belgische:r Staatsangehörige:r",
  "belgische Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "belgischer Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "bulgarischer Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "bulgarische Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "Bulgarie" = "bulgarische:r Staatsangehörige:r",
  "cittadina bulgara" = "bulgarische:r Staatsangehörige:r",
  "cittadino bulgaro" = "bulgarische:r Staatsangehörige:r",
  "slowakischer Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "slowakische Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "Dominique" = "domenikanische:r Staatsangehörige:r",
  "domenikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "domenikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "République dominicaine" = "domenikanische:r Staatsangehörige:r",
  "Maurice" = "mauritische:r Staatsangehörige:r",
  "mauritische Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "mauritischer Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "lankischer Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "lankische Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "afghanischer Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "afghanische Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "Afghanistan" = "afghanische:r Staatsangehörige:r",
  "cittadina afghana" = "afghanische:r Staatsangehörige:r",
  "cittadino afghano" = "afghanische:r Staatsangehörige:r",
  "Malte" = "maltesische:r Staatsangehörige:r",
  "maltesischer Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "ukrainische Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "ukrainischer Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "Ukraine" = "ukrainische:r Staatsangehörige:r",
  "indischer Staatsangehörige" = "indische:r Staatsangehörige:r",
  "indische Staatsangehörige" = "indische:r Staatsangehörige:r",
  "thailändische Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "thailändischer Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "chinesischer Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "chinesische Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "cittadina cinese" = "chinesische:r Staatsangehörige:r",
  "cittadino cinese" = "chinesische:r Staatsangehörige:r",
  "Afrique du Sud" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanische Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanischer Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "ägyptische Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "ägyptischer Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "albanische Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "albanischer Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "Albanie" = "albanische:r Staatsangehörige:r",
  "cittadina albanese" = "albanische:r Staatsangehörige:r",
  "cittadino albanese" = "albanische:r Staatsangehörige:r",
  "algerische Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "algerischer Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "Algérie" = "albanische:r Staatsangehörige:r",
  "angolanischer Staatsangehörige" = "angolanische:r Staatsangehörige:r",
  "Angola" = "angolanische:r Staatsangehörige:r",
  "Arabie saoudite" = "saudi-arabische:r Staatsangehörige:r",
  "argentinische Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "argentinischer Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "Argentine" = "argentinische:r Staatsangehörige:r",
  "armenische Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "armenischer Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "Arménie" = "armenische:r Staatsangehörige:r",
  "aserbaidschanische Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "aserbaidschanischer Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "Azerbaïdjan" = "aserbaidschanische:r Staatsangehörige:r",
  "äthiopische Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "äthiopischer Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "Autriche" = "österreichische:r Staatsangehörige:r",
  "Australie" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "cittadina austriaca"  = "australische:r Staatsangehörige:r",
  "cittadina austriaco"  = "australische:r Staatsangehörige:r",
  "Bangladesh" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschischer Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschische Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "belarussische Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "belarussischer Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "bolivianische Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "bolivianischer Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "Bolivie" = "bolivianische:r Staatsangehörige:r",
  "bosnische Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "bosnischer Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "Bosnie-Herzégovine" = "bosnische:r Staatsangehörige:r",
  "cittadina bosniaca" = "bosnische:r Staatsangehörige:r",
  "cittadino bosniaco" = "bosnische:r Staatsangehörige:r",
  "burundischer Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "burundische Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "kamerunische Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "kamerunischer Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "Cameroun" = "kamerunische:r Staatsangehörige:r",
  "Canada" = "kanadische:r Staatsangehörige:r",
  "kanadischer Staatsangehörige" = "kanadische:r Staatsangehörige:r", 
  "kanadische Staatsangehörige" = "kanadische:r Staatsangehörige:r",
  "chilenische Staatsangehörige" = "chilenische:r Staatsangehörige:r", 
  "chilenischer Staatsangehörige" = "chilenische:r Staatsangehörige:r",
  "Chili" = "chilenische:r Staatsangehörige:r",
  "Chine" = "chinesische:r Staatsangehörige:r",
  "botsuanische Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "botsuanischer Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "Botswana" = "botsuanische:r Staatsangehörige:r",
  "Burundi" = "burundische:r Staatsangehörige:r",
  "beninischer Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "beninische Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "Bénin" = "beninische:r Staatsangehörige:r",
  "Biélorussie" = "weiss-russische:r Staatsangehörige:r",
  "cittadina bielorussa" = "weiss-russische:r Staatsangehörige:r",
  "Bermudes" = "bermudische:r Staatsangehörige:r",
  "Burkina Faso" = "burkinische:r Staatsangehörige:r",
  "Cambodge" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanische Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanischer Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "Kazakhstan" = "kasachische:r Staatsangehörige:r",
  "kasachische Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "kasachischer Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "zyprischer Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "zyprische Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "Chypre" = "zyprische:r Staatsangehörige:r",
  "cittadina ceca" = "tschechische:r Staatsangehörige:r",
  "cittadino ceco" = "tschechische:r Staatsangehörige:r",
  "tschechische Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "tschechischer Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "cittadina colombiana" = "kolumbianische:r Staatsangehörige:r",
  "cittadino colombiano" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianische Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianischer Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "vietnamesische Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "vietnamesischer Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "Vietnam" = "vietnamesische:r Staatsangehörige:r",
  "venezolanische Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "venezolanischer Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "Venezuela" = "venezolanische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "uruguayischer Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "uruguayische Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "ugandische Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "ugandischer Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "tunesische Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "tunesischer Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "Tunisie" = "tunesische:r Staatsangehörige:r",
  "togoische Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "togoischer Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "Togo" = "togoische:r Staatsangehörige:r",
  "Thaïlande" = "thailändische:r Staatsangehörige:r",
  "taiwanische Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "taiwanischer Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "Taïwan" = "taiwanische:r Staatsangehörige:r",
  "tadschikische Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "tadschikischer Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "Syrie" = "syrische:r Staatsangehörige:r",
  "Suède" = "schwedische:r Staatsangehörige:r",
  "schwedische Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "schwedischer Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "südkoreanische Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "südkoreanischer Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "Sri Lanka" = "srilankische:r Staatsangehörige:r",
  "somalische Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "somalischer Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "Somalie" = "somalische:r Staatsangehörige:r",
  "slowenische Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "slowenischer Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "Slovénie" = "slowenische:r Staatsangehörige:r",
  "Slovaquie" = "slowakische:r Staatsangehörige:r",
  "singapurische Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "singapurischer Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "Singapour" = "singapurische:r Staatsangehörige:r",
  "Serbie" = "serbische:r Staatsangehörige:r",
  "senegalesische Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "senegalesischer Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "Sénégal" = "senegalesische:r Staatsangehörige:r",
  "salvadorianische Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "salvadorianischer Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "Salvador" = "salvadorianische:r Staatsangehörige:r",
  "russische Staatsangehörige" = "russische:r Staatsangehörige:r",
  "russischer Staatsangehörige" = "russische:r Staatsangehörige:r",
  "Russie" = "russische:r Staatsangehörige:r",
  "Royaume-Uni" = "britische:r Staatsangehörige:r",
  "Pologne" = "polnische:r Staatsangehörige:r",
  "philippinische Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "philippinischer Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "Philippines" = "philippinische:r Staatsangehörige:r",
  "peruanische Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "peruanischer Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "Pérou" = "peruanische:r Staatsangehörige:r",
  "Pays-Bas" = "niederländische:r Staatsangehörige:r",
  "panamaische Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "panamaischer Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "Panama" = "panamaische:r Staatsangehörige:r",
  "pakistanische Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "pakistanischer Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "Pakistan" = "pakistanische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "Ouzbékistan" = "usbekische:r Staatsangehörige:r",
  "norwegische Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "norwegischer Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "Norvège" = "norwegische:r Staatsangehörige:r",
  "nigerianischer Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "nigerianische Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "Nigéria" = "nigerianische:r Staatsangehörige:r",
  "nicaraguanischer Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "nicaraguanische Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "neuseeländischer Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "neuseeländische Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "montenegrinischer Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "montenegrinische Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "Monténégro" = "montenegrinische:r Staatsangehörige:r",
  "mongolischer Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "mongolische Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "Mongolie" = "mongolische:r Staatsangehörige:r",
  "mexikanischer Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "mexikanische Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "Mexique" = "mexikanische:r Staatsangehörige:r",
  "mazedonische Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "mazedonischer Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "marokkanische Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "marokkanischer Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "Maroc" = "marokkanische:r Staatsangehörige:r",
  "malaysische Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "malaysischer Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "Malaisie" = "malaysische:r Staatsangehörige:r",
  "madagassische Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "madagassischer Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "Madagascar" = "malaysische:r Staatsangehörige:r",
  "luxemburgische Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "luxemburgischer Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "Luxembourg" = "luxemburgische:r Staatsangehörige:r",
  "litauische Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "litauischer Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "Lituanie" = "litauische:r Staatsangehörige:r",
  "liechtensteinische Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "liechtensteinischer Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "libanesische Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "libanesischer Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "Liban" = "libanesische:r Staatsangehörige:r",
  "libysche Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "libyscher Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "Libye" = "libysche:r Staatsangehörige:r",
  "lybischer Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lybische Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lettische Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "lettischer Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "Lettonie" = "lettische:r Staatsangehörige:r",
  "kubanische Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "kubanischer Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "jemenitische Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "jemenitischer Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "japanische Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "japanischer Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "Japon" = "japanische:r Staatsangehörige:r",
  "jamaikanische Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "jamaikanischer Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "Jamaïque" = "jamaikanische:r Staatsangehörige:r",
  "italianischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "ivorische Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "ivorischer Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "israelische Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "israelischer Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "Israël" = "israelische:r Staatsangehörige:r",
  "isländische Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "isländischer Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "irische Staatsangehörige" = "irische:r Staatsangehörige:r",
  "irischer Staatsangehörige" = "irische:r Staatsangehörige:r",
  "Irlande" = "irische:r Staatsangehörige:r",
  "iranische Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "iranischer Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "Iran" = "iranische:r Staatsangehörige:r",
  "irakische Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "irakischer Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "Irak" = "irakische:r Staatsangehörige:r",
  "indonesische Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "indonesischer Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "Indonésie" = "indonesische:r Staatsangehörige:r",
  "Inde" = "indische:r Staatsangehörige:r",
  "hongkonger Staatsangehörige" = "hongkonger:r Staatsangehörige:r",
  "Hongrie" = "ungarische:r Staatsangehörige:r",
  "honduranischer Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "honduranische Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "guineischer Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "guineische Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "Guinée" = "guineische:r Staatsangehörige:r",
  "grenadischer Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "grenadische Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "Grenade" = "grenadische:r Staatsangehörige:r",
  "Grèce" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "Ghana" = "ghanaische:r Staatsangehörige:r",
  "ghanaische Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "ghanaischer Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "georgische Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "georgischer Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "Géorgie" = "georgische:r Staatsangehörige:r",
  "gabunische Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gabunischer Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gambischer Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "gambische Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "finnische Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "finnischer Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "Finlande" = "finnische:r Staatsangehörige:r",
  "estnische Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "estnischer Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "eritreische Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "eritreischer Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "Érythrée" = "eritreische:r Staatsangehörige:r",
  "ecuadorianische Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "ecuadorianischer Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "Équateur" = "ecuadorianische:r Staatsangehörige:r",
  "dänische Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "dänischer Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "Danemark" = "dänische:r Staatsangehörige:r",
  "Cuba" = "kubanische:r Staatsangehörige:r", 
  "Croatie" = "kroatische:r Staatsangehörige:r", 
  "Costa Rica" = "costaricanische:r Staatsangehörige:r", 
  "Corée du Sud" = "südkoreanische:r Staatsangehörige:r", 
  "Colombie" = "kolumbianische:r Staatsangehörige:r", 
  "cittadino venezuelano" = "venezolanische:r Staatsangehörige:r",
  "cittadina venezuelana" = "venezolanische:r Staatsangehörige:r",
  "cittadino ungherese" = "ungarische:r Staatsangehörige:r",
  "cittadino ucraino" = "ukrainische:r Staatsangehörige:r",
  "cittadina ucraina" = "ukrainische:r Staatsangehörige:r",
  "cittadino turco" = "türkische:r Staatsangehörige:r", 
  "cittadina svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadina statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadino spagnolo" = "spanische:r Staatsangehörige:r", 
  "cittadina spagnola" = "spanische:r Staatsangehörige:r", 
  "cittadino sloveno" = "slowenische:r Staatsangehörige:r", 
  "cittadina slovena" = "slowenische:r Staatsangehörige:r", 
  "cittadino siriano" = "syrische:r Staatsangehörige:r",
  "cittadina slovacca" = "slowakische:r Staatsangehörige:r",
  "cittadina croata" = "kroatische:r Staatsangehörige:r",
  "cittadino croato" = "kroatische:r Staatsangehörige:r",
  "cittadina danese" = "dänische:r Staatsangehörige:r",
  "cittadino danese" = "dänische:r Staatsangehörige:r",
  "cittadina cubano" = "kubanische:r Staatsangehörige:r",
  "cittadina domenicana" = "domenikanische:r Staatsangehörige:r",
  "cittadina eritrea" = "eritreische:r Staatsangehörige:r",
  "cittadino russo" = "russische:r Staatsangehörige:r",
  "cittadina russa" = "russische:r Staatsangehörige:r",
  "Cap-Vert" = "kapverdische:r Staatsangehörige:r",
  "cittadina francese" = "französische:r Staatsangehörige:r",
  "cittadina giapponese" = "japanische:r Staatsangehörige:r",
  "cittadina greca" = "griechische:r Staatsangehörige:r",
  "cittadina iraniana" = "iranische:r Staatsangehörige:r",
  "cittadina kazaka" = "kasachische:r Staatsangehörige:r",
  "cittadina kosovara" = "kosovarische:r Staatsangehörige:r",
  "cittadina lettone" = "lettische:r Staatsangehörige:r",
  "cittadina libanese" = "libanesische:r Staatsangehörige:r",
  "cittadina lituana" = "litauische:r Staatsangehörige:r",
  "cittadina macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadina messicana" = "mexikanische:r Staatsangehörige:r",
  "cittadina moldova" = "moldavische:r Staatsangehörige:r",
  "cittadina norvegese" = "norwegische:r Staatsangehörige:r",
  "cittadina olandese" = "niederländische:r Staatsangehörige:r",
  "cittadina polacca" = "polnische:r Staatsangehörige:r",
  "cittadina portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadina romena" = "rumänische:r Staatsangehörige:r",
  "cittadina serba" = "serbische:r Staatsangehörige:r",
  "cittadino angolano" = "angolanische:r Staatsangehörige:r",
  "cittadino austriaco" = "österreichische:r Staatsangehörige:r",
  "cittadino belga" = "belgische:r Staatsangehörige:r",
  "cittadino boliviano" = "bolivianische:r Staatsangehörige:r",
  "cittadino cileno" = "chilenische:r Staatsangehörige:r",
  "cittadino cubano" = "kubanische:r Staatsangehörige:r",
  "cittadino ecuadoriano" = "ecuadorianische:r Staatsangehörige:r",
  "cittadino finlandese" = "finnische:r Staatsangehörige:r",
  "cittadino francese" = "französische:r Staatsangehörige:r",
  "cittadino greco" = "griechische:r Staatsangehörige:r",
  "cittadino iracheno" = "irakische:r Staatsangehörige:r",
  "cittadino irlandese" = "irische:r Staatsangehörige:r",
  "cittadino kosovaro" = "kosovarische:r Staatsangehörige:r",
  "cittadino lettone" = "lettische:r Staatsangehörige:r",
  "cittadino macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadino marocchino" = "marokkanische:r Staatsangehörige:r",
  "cittadino messicano" = "mexikanische:r Staatsangehörige:r",
  "cittadino montenegrino" = "montenegrinische:r Staatsangehörige:r",
  "cittadino olandese" = "niederländische:r Staatsangehörige:r",
  "cittadino polacco" = "polnische:r Staatsangehörige:r",
  "cittadino portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadino senegalese" = "senegalesische:r Staatsangehörige:r",
  "cittadino serbo" = "serbische:r Staatsangehörige:r",
  "cittadino tunisino" = "tunesische:r Staatsangehörige:r",
  "Curaçao" = "Curaçaoënarische:r Staatsangehörige:r",
  "Gibraltar" = "gibraltaische:r Staatsangehörige:r",
  "Honduras" = "honduranische:r Staatsangehörige:r",
  "jordanischer Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "jordanische Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "Jordanie" = "jordanische:r Staatsangehörige:r",
  "Koweït" = "kuweitische:r Staatsangehörige:r",
  "Macédoine du Nord" = "nordmazedonische:r Staatsangehörige:r",
  "Moldavie" = "moldavische:r Staatsangehörige:r",
  "Nicaragua" = "nicaraguanische:r Staatsangehörige:r",
  "Niger" = "nigeranische:r Staatsangehörige:r",
  "Nouvelle-Zélande" = "neuseeländische:r Staatsangehörige:r",
  "Ouganda" = "ugandische:r Staatsangehörige:r",
  "Paraguay" = "paraguayanische:r Staatsangehörige:r",
  "ruandischer Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ruandische Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ricanischer Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "ricanische Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "Tchéquie" = "tschechische:r Staatsangehörige:r",
  "Yémen" = "jemenitische:r Staatsangehörige:r",
  "cittadina di" = "unbekannte Staatsangehörigkeit",
  "cittadino di" = "unbekannte Staatsangehörigkeit",
  "cittadino romeno"  = "rumänische:r Staatsangehörige:r",
  "unbekannte Staatsangehörig" = "unbekannte Staatsangehörigkeit",
  "Mali" = "malische:r Staatsangehörige:r",
  "Monaco" = "monegassische:r Staatsangehörige:r",
  "République centrafricaine" = "zentralafrikanische:r Staatsangehörige:r",
  "andorrine Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "andorriner Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "arabische Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "arabischer Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "burkinischer Staatsangehörige" = "burkinische:r Staatsangehörige:r",
  "cittadino argentino" = "argentinische:r Staatsangehörige:r",
  "cittadino australiano" = "australische:r Staatsangehörige:r",
  "cittadino canadese" = "kanadische:r Staatsangehörige:r",
  "cittadino cipriota" = "zyprische:r Staatsangehörige:r",
  "cittadino indiano" = "indische:r Staatsangehörige:r",
  "cittadino lussemburghese" = "luxemburgische:r Staatsangehörige:r",
  "cittadino norvegese" = "norwegische:r Staatsangehörige:r",
  "guatemaltekischer Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "guatemaltekische Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "haitianischer Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "haitianische Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "Kirghizistan" = "krigisische:r Staatsangehörige:r",
  "krigisische Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "krigisischer Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "kiribatischer Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "kiribatische Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "moldauische Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "moldauischer Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "mosambikanische Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "mosambikanischer Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "myanmarische Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "myanmarischer Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "namibische Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "namibischer Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "nepalesische Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "nepalesischer Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "Soudan" = "sudanesische:r Staatsangehörige:r",
  "sudanesische Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "sudanesischer Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "kenianische Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "kenianischer Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "palästinischer Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "palästinische Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "paraguayische Staatsangehörige" = "paraguayanische:r Staatsangehörige:r",
  "antiguanischer Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "antiguanische Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "simbabwischer Staatsangehörige" = "simbabwische:r Staatsangehörige:r",
  "simbabwische Staatsangehörige" = "simbabwische:r Staatsangehörige:r", 
  "Jersey" = "jerseyische:r Staatsangehörige:r",
  "Émirats arabes unis" = "emiratische:r Staatsangehörige:r",
  "Estonie" = "estnische:r Staatsangehörige:r",
  "Fidji" = "fidschianische:r Staatsangehörige:r",
  "Qatar" = "katarische:r Staatsangehörige:r",
  "Montserrat" = "montserratische:r Staatsangehörige:r",
  "Liechtenstein" = "liechtensteinische:r Staatsangehörige:r",
  "Uruguay" = "uruguayische:r Staatsangehörige:r",
  "Éthiopie" = "ethiopische:r Staatsangehörige:r",
  "Kenya" = "kenianische:r Staatsangehörige:r",
  "Maldives" = "maledivische:r Staatsangehörige:r",
  "Mozambique" = "mosambikanische:r Staatsangehörige:r",
  "Rwanda" = "ruandische:r Staatsangehörige:r",
  "Trinité-et-Tobago" = "trinidadianische und tobagoische:r Staatsangehörige:r",
  "citoyen afghan" = "afghanische:r Staatsangehörige:r",
  "ressortissant afghan" = "afghanische:r Staatsangehörige:r",
  "citoyen algérien" = "algerische:r Staatsangehörige:r",
  "citoyen allemand" = "deutsche:r Staatsangehörige:r",
  "citoyen américain" = "amerikanische:r Staatsangehörige:r",
  "citoyen arménien" = "armenische:r Staatsangehörige:r",
  "citoyen australien" = "australische:r Staatsangehörige:r",
  "citoyen belge" = "belgische:r Staatsangehörige:r",
  "citoyen bosniaque" = "bosnische:r Staatsangehörige:r",
  "citoyen brésilien" = "brasilianische:r Staatsangehörige:r",
  "citoyen britannique" = "britische:r Staatsangehörige:r",
  "citoyen bulgare" = "bulgarische:r Staatsangehörige:r",
  "citoyen danois" = "dänische:r Staatsangehörige:r",
  "citoyen espagnol" = "spanische:r Staatsangehörige:r",
  "citoyen français" = "französische:r Staatsangehörige:r",
  "citoyen hongrois" = "ungarische:r Staatsangehörige:r",
  "citoyen indien" = "indische:r Staatsangehörige:r",
  "citoyen irlandais" = "irische:r Staatsangehörige:r",
  "citoyen italien" = "italienische:r Staatsangehörige:r",
  "citoyen kosovar" = "kosovarische:r Staatsangehörige:r",
  "citoyen letton" = "lettische:r Staatsangehörige:r",
  "citoyen macédonien" = "mazedonische:r Staatsangehörige:r",
  "citoyen moldave" = "moldavische:r Staatsangehörige:r",
  "citoyen néerlandais" = "niederländische:r Staatsangehörige:r",
  "citoyen péruvien" = "peruanische:r Staatsangehörige:r",
  "citoyen polonais" = "polnische:r Staatsangehörige:r",
  "citoyen portugais" = "portugisische:r Staatsangehörige:r",
  "citoyen roumain" = "rumänische:r Staatsangehörige:r",
  "citoyen sénégalais" = "senegalesische:r Staatsangehörige:r",
  "citoyen serbe" = "serbische:r Staatsangehörige:r",
  "citoyen slovaque" = "slowakische:r Staatsangehörige:r",
  "citoyen somalien" = "somalische:r Staatsangehörige:r",
  "citoyen sri" = "srilankische:r Staatsangehörige:r",
  "ressortissant sri" = "srilankische:r Staatsangehörige:r",
  "ressortissante sri" = "srilankische:r Staatsangehörige:r",
  "citoyen suédois" = "schwedische:r Staatsangehörige:r",
  "citoyen syrien" = "syrische:r Staatsangehörige:r",
  "citoyen tchèque" = "tschechische:r Staatsangehörige:r",
  "citoyen turc" = "türkische:r Staatsangehörige:r",
  "citoyen ukrainien" = "ukrainische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "österreichische:r Staatsangehörige:r",
  "citoyenne belge" = "belgische:r Staatsangehörige:r",
  "citoyenne brésilienne" = "brasilianische:r Staatsangehörige:r",
  "citoyenne britannique" = "britische:r Staatsangehörige:r",
  "citoyenne chinoise" = "chinesische:r Staatsangehörige:r",
  "citoyenne espagnole" = "spanische:r Staatsangehörige:r",
  "citoyenne française" = "französische:r Staatsangehörige:r",
  "citoyenne guineische" = "guineische:r Staatsangehörige:r",
  "citoyenne hongroise" = "ungarische:r Staatsangehörige:r",
  "citoyenne irlandaise" = "irische:r Staatsangehörige:r",
  "citoyenne italienne" = "italienische:r Staatsangehörige:r",
  "citoyenne kosovare" = "kosovarische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "mazedonische:r Staatsangehörige:r",
  "citoyenne marocaine" = "marokkanische:r Staatsangehörige:r",
  "citoyenne néo" = "neuseeländische:r Staatsangehörige:r",
  "citoyenne polonaise" = "polnische:r Staatsangehörige:r",
  "citoyenne portugaise" = "portugisische:r Staatsangehörige:r",
  "citoyenne roumaine" = "rumänische:r Staatsangehörige:r",
  "citoyenne russe" = "russische:r Staatsangehörige:r",
  "citoyenne rwandaise" = "ruandische:r Staatsangehörige:r",
  "citoyenne turque" = "türkische:r Staatsangehörige:r",
  "citoyenne ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "Grande-Bretagne" = "britische:r Staatsangehörige:r",
  "Mauritanie" = "mauretanische:r Staatsangehörige:r",
  "ressortissant albanais" = "albanische:r Staatsangehörige:r",
  "ressortissant algérien" = "algerische:r Staatsangehörige:r",
  "ressortissant allemand" = "deutsche:r Staatsangehörige:r",
  "ressortissant américain" = "amerikanische:r Staatsangehörige:r",
  "ressortissant autrichien" = "österreichische:r Staatsangehörige:r",
  "ressortissant belge" = "belgische:r Staatsangehörige:r",
  "ressortissant bosniaque" = "bosnische:r Staatsangehörige:r",
  "ressortissant brésilien" = "brasilianische:r Staatsangehörige:r",
  "ressortissant britannique" = "britische:r Staatsangehörige:r",
  "ressortissant bulgare" = "bulgarische:r Staatsangehörige:r",
  "ressortissant camerounais" = "kamerunische:r Staatsangehörige:r",
  "ressortissant canadien" = "kanadische:r Staatsangehörige:r",
  "ressortissant chinois" = "chinesische:r Staatsangehörige:r",
  "ressortissant croate" = "kroatische:r Staatsangehörige:r",
  "ressortissant érythréen" = "eritreische:r Staatsangehörige:r",
  "ressortissant espagnol" = "spanische:r Staatsangehörige:r",
  "ressortissant français" = "französische:r Staatsangehörige:r",
  "ressortissant hongrois" = "ungarische:r Staatsangehörige:r",
  "ressortissant indien" = "indische:r Staatsangehörige:r",
  "ressortissant iranien" = "iranische:r Staatsangehörige:r",
  "ressortissant iraquien" = "irakische:r Staatsangehörige:r",
  "ressortissant italien" = "italienische:r Staatsangehörige:r",
  "ressortissant ivoirien" = "ivorische:r Staatsangehörige:r",
  "ressortissant kosovar" = "kosovarische:r Staatsangehörige:r",
  "ressortissant libanais" = "libanesische:r Staatsangehörige:r",
  "ressortissant lituanien" = "lituanische:r Staatsangehörige:r",
  "ressortissant macédonien" = "mazedonische:r Staatsangehörige:r",
  "ressortissant malgache" = "madagassische:r Staatsangehörige:r",
  "ressortissant marocain" = "marokkanische:r Staatsangehörige:r",
  "ressortissant mauricien" = "mauritische:r Staatsangehörige:r",
  "ressortissant mexicain" = "mexikanische:r Staatsangehörige:r",
  "ressortissant monténégrin" = "montenegrinische:r Staatsangehörige:r",
  "ressortissant polonais" = "polnische:r Staatsangehörige:r",
  "ressortissant portugais" = "portugisische:r Staatsangehörige:r",
  "ressortissant roumain" = "rumänische:r Staatsangehörige:r",
  "ressortissant russe" = "russische:r Staatsangehörige:r",
  "ressortissant rwandais" = "ruandische:r Staatsangehörige:r",
  "ressortissant serbe" = "serbische:r Staatsangehörige:r",
  "ressortissant slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissant somalien" = "somalische:r Staatsangehörige:r",
  "ressortissant syrien" = "syrische:r Staatsangehörige:r",
  "ressortissant thaïlandais" = "thailändische:r Staatsangehörige:r",
  "ressortissant tunisien" = "tunesische:r Staatsangehörige:r",
  "ressortissant turc" = "türkische:r Staatsangehörige:r",
  "ressortissante algérienne" = "algerische:r Staatsangehörige:r",
  "ressortissante allemande" = "deutsche:r Staatsangehörige:r",
  "ressortissante américaine" = "amerikanische:r Staatsangehörige:r",
  "ressortissante belge" = "belgische:r Staatsangehörige:r",
  "ressortissante béninoise" = "beninische:r Staatsangehörige:r",
  "ressortissante brésilienne" = "brasilianische:r Staatsangehörige:r",
  "ressortissante britannique" = "britische:r Staatsangehörige:r",
  "ressortissante burkinabè" = "burkinische:r Staatsangehörige:r",
  "ressortissante chinoise" = "chinesische:r Staatsangehörige:r",
  "ressortissante coréenne" = "südkoreanische:r Staatsangehörige:r",
  "ressortissante croate" = "koratische:r Staatsangehörige:r",
  "ressortissante dominicaine" = "domenikanische:r Staatsangehörige:r",
  "ressortissante espagnole" = "spanische:r Staatsangehörige:r",
  "ressortissante française" = "französische:r Staatsangehörige:r",
  "ressortissante gabonaise" = "gabunische:r Staatsangehörige:r",
  "ressortissante indienne" = "indische:r Staatsangehörige:r",
  "ressortissante italienne" = "italienische:r Staatsangehörige:r",
  "ressortissante ivoirienne" = "ivorische:r Staatsangehörige:r",
  "ressortissante kosovare" = "kosovarische:r Staatsangehörige:r",
  "ressortissante lettone" = "lettische:r Staatsangehörige:r",
  "ressortissante libanaise" = "libanesische:r Staatsangehörige:r",
  "ressortissante marocaine" = "marokkanische:r Staatsangehörige:r",
  "ressortissante mauricienne" = "mauritische:r Staatsangehörige:r",
  "ressortissante paraguayenne" = "paraguayanische:r Staatsangehörige:r",
  "ressortissante polonaise" = "polnische:r Staatsangehörige:r",
  "ressortissante portugaise" = "portugisische:r Staatsangehörige:r",
  "ressortissante roumaine" = "rumänische:r Staatsangehörige:r",
  "ressortissante russe" = "russische:r Staatsangehörige:r",
  "ressortissante slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissante syrienne" = "syrische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante thaïlandaise" = "thailändische:r Staatsangehörige:r",
  "ressortissante tunisienne" = "tunesische:r Staatsangehörige:r",
  "ressortissante turque" = "türkische:r Staatsangehörige:r",
  "ressortissante ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "ressortissante vietnamienne" = "vietnamesische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "citoyenne guinéenne" = "guineische:r Staatsangehörige:r",
  "citoyenne macédonienne" = "mazedonische:r Staatsangehörige:r",
  "Guinée-Bissau" = "guinea-bissauische:r Staatsangehörige:r",
  "Mauritius" = "mauritische:r Staatsangehörige:r",
  "verdischer Staatsangehörige" = "verdische:r Staatsangehörige:r",
  "vanuatuischer Staatsangehörige"  = "vanuatuische:rr Staatsangehörige:r"


  
              # Add more mappings here as needed. For example if the analysis is done for another year, where different nationalities appear.
)


#The following code replaces the non-German expressions with their German counterparts.
nationality_counts <- nationality_counts %>%
  mutate(nationality = ifelse(nationality %in% names(mapping),
                              mapping[nationality],
                              nationality)) %>%
  mutate(nationality = as.character(nationality))  #Convert nationality to a character type. 


#Regroup and count the occurrences
nationality_counts <- nationality_counts %>%
  group_by(nationality) %>%
  summarise(count = sum(count))


#Create new dichotomous variable
nationality_counts2 <- nationality_counts %>% mutate(nat_dich = ifelse(nationality == "schweizer Staatsangehörige:r", "Schweizer", "Ausländer")) 


#Save new data frame
saveRDS(nationality_counts, "nationality_counts.Rds")
```



##Basic Plot
The following simple plots are done with the "nationality_counts" data frame to show in absolute and relative numbers who founds the companies in terms of nationality in the year 2022.
```{r}
#Plot the bar chart
ggplot(nationality_counts, aes(x = reorder(nationality, -count), y = count)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Nationality", y = "Frequency", title = "Frequency of Nationalities")


#Second bar chart
#Preprocess the data
processed_data <- nationality_counts2 %>%
  mutate(nationality_group = ifelse(nat_dich == "Ausländer", "Ausländer", "Schweizer")) %>%
  group_by(nationality_group) %>%
  summarise(count = sum(count)) %>%
  mutate(percentage = count / sum(count) * 100)


#Renaming the data
renamed_data <- processed_data %>%
  mutate(nationality_group = recode(nationality_group,
                                    "Schweizer" = "Schweizer Gründer:innen",
                                    "Ausländer" = "Ausländische Gründer:innen"))


#Define color mapping
color_mapping <- c("Schweizer Gründer:innen" = "#F1977A",
                   "Ausländische Gründer:innen" = "#0028A5")


## Basic Plot without comparison ##
# Preprocess the data
barplot_basic2022_wico <- ggplot(renamed_data, aes(x = nationality_group, y = count, fill = nationality_group)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text()) +
  labs(x = "Staatsangehörigkeit", y = "Anzahl", title = "Anzahl Gründer:innen nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage), "%")),
            position = position_stack(vjust = 0.5),
            color = "white", size = 7, fontface = "bold") +
  coord_cartesian(ylim = c(0, max(renamed_data$count) * 1.1)) + guides(fill=FALSE)+
  theme(legend.position = "bottom") +theme_minimal() +
  theme(plot.title = element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=18, family="Times New Roman"),
        axis.text.y=element_text(size=18, family="Times New Roman"),
        legend.text=element_text(size=18, family="Times New Roman"),
        legend.title=element_text(size=18, family="Times New Roman"))


ggsave("barplot_basic2022_wico.jpg",  barplot_basic2022_wico, height= 8, width=12)




## Basic Plot with comparison ##
#Plot to compare shares in founders to share in employable population (15-64)
#Activate package for brightening the colors later
library(colorspace)


#Define the total swiss population and get the percentages (numbers according to BFS 2022b)
swiss_population <-  5757830
total_swiss <- 4051905
total_foreigners <- 1705925
round((total_swiss/swiss_population), 2)
round((total_foreigners/swiss_population), 2)



#Create a data frame with the population distribution according to BFS data
population_distribution <- data.frame(
  nationality_group = c("Schweizer Wohnbevölkerung*", "Ausländische Wohnbevölkerung*"),
  count = c(total_swiss, total_foreigners),
  percentage = c(70, 30)
)


#Bind the data frames
new_data <- rbind(renamed_data, population_distribution)


#Create additional color mapping and make them brighter in second part
color_mapping <- c(color_mapping, "Schweizer Wohnbevölkerung*" = "#F1977A", "Ausländische Wohnbevölkerung*" = "#0028A5")

color_mapping["Schweizer Wohnbevölkerung*"] <- colorspace::lighten(color_mapping["Schweizer Wohnbevölkerung*"], amount = 0.5)
color_mapping["Ausländische Wohnbevölkerung*"] <- colorspace::lighten(color_mapping["Ausländische Wohnbevölkerung*"], amount = 0.5)


#Specify the order of bars
new_data$nationality_group <- factor(new_data$nationality_group, levels = c("Ausländische Gründer:innen", "Ausländische Wohnbevölkerung*", "Schweizer Gründer:innen", "Schweizer Wohnbevölkerung*"))


#Create the new bar plot and load additional package for the cosmetic changes
library(ggpattern)
barplot_basic2022 <- ggplot(new_data, aes(x = nationality_group, y = percentage, fill = nationality_group)) +
  geom_bar_pattern(stat = "identity",
                   pattern = ifelse(new_data$nationality_group %in% c("Ausländische Wohnbevölkerung*", "Schweizer Wohnbevölkerung*"), "stripe", "none"),
                   pattern_fill = "black",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.02,
                   pattern_key_scale_factor = 1) +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x = "Staatsangehörigkeit", y = "Prozent im Datensatz bzw. der Schweizer Wohnbevölkerung", title = "Prozentzahlen der Gründer:innen und der Wohnbevölkerung nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage, 0), "%")), 
            nudge_y = 3, 
            color = "black", 
            size = 6,
            family="Times New Roman") +
  coord_cartesian(ylim = c(0, max(new_data$percentage) * 1.1)) + guides(fill=FALSE) +
  theme(legend.position = "bottom") + theme_minimal() + 
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme(plot.title=element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=14, family="Times New Roman"),
        axis.text.y=element_text(size=14, family="Times New Roman"),
        legend.text=element_text(size=14, family="Times New Roman"),
        legend.title=element_text(size=14, family="Times New Roman"))


#Save the bar plot
ggsave("barplot_basic2022.jpg",  barplot_basic2022, height= 8, width=12)


#Percentage
total <- sum(nationality_counts2$count)
swiss <- nationality_counts2$count[nationality_counts2$nationality == "schweizer Staatsangehörige:r"]
swiss_perc <- swiss/total*100
foreigner_perc <- 100-swiss_perc



## Basic Plot with comparison 2 ##
#Same plot as above but for all of the population above 15
library(colorspace)


#Define the total swiss population and get the percentages (numbers according to BFS 2022b)
swiss_population <-  7419149
total_swiss <- 5529337
total_foreigners <- 1889812
round((total_swiss/swiss_population), 2)
round((total_foreigners/swiss_population), 2)






#Create a data frame with the population distribution according to BFS data
population_distribution <- data.frame(
  nationality_group = c("Schweizer Wohnbevölkerung*", "Ausländische Wohnbevölkerung*"),
  count = c(total_swiss, total_foreigners),
  percentage = c(75, 25)
)


#Bind the data frames
new_data <- rbind(renamed_data, population_distribution)




#Specify the order of bars
new_data$nationality_group <- factor(new_data$nationality_group, levels = c("Ausländische Gründer:innen", "Ausländische Wohnbevölkerung*", "Schweizer Gründer:innen", "Schweizer Wohnbevölkerung*"))


#Create the new bar plot and load additional package for the cosmetic changes
library(ggpattern)
barplot_basic2022_15plus <- ggplot(new_data, aes(x = nationality_group, y = percentage, fill = nationality_group)) +
  geom_bar_pattern(stat = "identity",
                   pattern = ifelse(new_data$nationality_group %in% c("Ausländische Wohnbevölkerung*", "Schweizer Wohnbevölkerung*"), "stripe", "none"),
                   pattern_fill = "black",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.02,
                   pattern_key_scale_factor = 1) +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x = "Staatsangehörigkeit", y = "Prozent im Datensatz bzw. der Schweizer Wohnbevölkerung", title = "Prozentzahlen der Gründer:innen und der Wohnbevölkerung nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage, 0), "%")), 
            nudge_y = 3, 
            color = "black", 
            size = 6,
            family="Times New Roman") +
  coord_cartesian(ylim = c(0, max(new_data$percentage) * 1.1)) + guides(fill=FALSE) +
  theme(legend.position = "bottom") + theme_minimal() + 
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme(plot.title=element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=14, family="Times New Roman"),
        axis.text.y=element_text(size=14, family="Times New Roman"),
        legend.text=element_text(size=14, family="Times New Roman"),
        legend.title=element_text(size=14, family="Times New Roman"))


#Save the bar plot
ggsave("barplot_basic2022_15plus.jpg",  barplot_basic2022_15plus, height= 8, width=12)



```



##World map
This code is needed to create a world map, showing where the founders are from, based on the "nationality_counts" data frame.
```{r}
#Activate some packages
library(ggplot2)
library(maps)
library(dplyr)
library(tidyr)
library(rworldmap)
library(countrycode)
library(stringr)


#Load in data (if necessary) and rename the data frame
nationality_counts <- readRDS("nationality_counts.Rds")
df <- nationality_counts


#Get the world map data
world_map <- getMap()


#Clean the nationality column to get country names in German
df$cleaned_country <- str_replace_all(df$nationality, c(":r Staatsangehörige"="", ":r Staatsangehörigkeit"="", "r Staatsangehörige"="", "r Staatsangehörigkeit"=""))


#Specific replacements for non-standard terms
##The renaming is done manually and necessary, so that the names of the nationalities align with the country names of the "rworldmap" package.
df$cleaned_country[df$cleaned_country == "Company"] <- NA
df$cleaned_country[df$cleaned_country == "unbekannte"] <- NA
df$cleaned_country[df$cleaned_country == "Grande-Bretagne"] <- "Großbritannien"
df$cleaned_country[df$cleaned_country == "Suisse"] <- NA
df$cleaned_country[df$cleaned_country == "verdischer Staatsangehörige"] <- "Kap Verde"
df$cleaned_country[df$cleaned_country == "schweizer Staatsangehörige:r"] <- "Schweiz"
df$cleaned_country[df$cleaned_country == "weiss-russische:r"] <- "Belarus"
df$cleaned_country[df$cleaned_country == "albanische:r"] <- "Albanien"
df$cleaned_country[df$cleaned_country == "algerische:r"] <- "Algerien"
df$cleaned_country[df$cleaned_country == "amerikanische:r"] <- "USA"
df$cleaned_country[df$cleaned_country == "andorrine:r"] <- "Andorra"
df$cleaned_country[df$cleaned_country == "arabische:r"] <- "Saudiarabien"
df$cleaned_country[df$cleaned_country == "armenische:r"] <- "Armenien"
df$cleaned_country[df$cleaned_country == "australische:r"] <- "Australien"
df$cleaned_country[df$cleaned_country == "belgische:r"] <- "Belgien"
df$cleaned_country[df$cleaned_country == "bermudische:r"] <- "Bermuda"
df$cleaned_country[df$cleaned_country == "bolivianische:r"] <- "Bolivien"
df$cleaned_country[df$cleaned_country == "bosnische:r"] <- "Bosnien"
df$cleaned_country[df$cleaned_country == "botsuanische:r"] <- "Botsuana"
df$cleaned_country[df$cleaned_country == "britische:r"] <- "Großbritannien"
df$cleaned_country[df$cleaned_country == "bulgarische:r"] <- "Bulgarien"
df$cleaned_country[df$cleaned_country == "burkinische:r"] <- "Burkinafaso"
df$cleaned_country[df$cleaned_country == "chinesische:r"] <- "China"
df$cleaned_country[df$cleaned_country == "deutsche:r"] <- "Deutschland"
df$cleaned_country[df$cleaned_country == "domenikanische:r"] <- "Dominikanische Republik"
df$cleaned_country[df$cleaned_country == "dänische:r"] <- "Dänemark"
df$cleaned_country[df$cleaned_country == "emiratische:r"] <- "Vereinigte arabische Emirate"
df$cleaned_country[df$cleaned_country == "eritreische:r"] <- "Eritrea"
df$cleaned_country[df$cleaned_country == "estnische:r"] <- "Estland"
df$cleaned_country[df$cleaned_country == "finnische:r"] <- "Finnland"
df$cleaned_country[df$cleaned_country == "französische:r"] <- "Frankreich"
df$cleaned_country[df$cleaned_country == "gambische:r"] <- "Gambia"
df$cleaned_country[df$cleaned_country == "georgische:r"] <- "Georgien"
df$cleaned_country[df$cleaned_country == "gibraltaische:r"] <- "Gibraltar"
df$cleaned_country[df$cleaned_country == "griechische:r"] <- "Griechenland"
df$cleaned_country[df$cleaned_country == "guatemaltekische:r"] <- "Guatemala"
df$cleaned_country[df$cleaned_country == "guineische:r"] <- "Guinea"
df$cleaned_country[df$cleaned_country == "herzegowinische:r"] <- "Herzegowina"
df$cleaned_country[df$cleaned_country == "honduranische:r"] <- "Honduras"
df$cleaned_country[df$cleaned_country == "indische:r"] <- "Indien"
df$cleaned_country[df$cleaned_country == "indonesische:r"] <- "Indonesien"
df$cleaned_country[df$cleaned_country == "irische:r"] <- "Irland"
df$cleaned_country[df$cleaned_country == "isländische:r"] <- "Island"
df$cleaned_country[df$cleaned_country == "kanadische:r"] <- "Kanada"
df$cleaned_country[df$cleaned_country == "kapverdische:r"] <- "Kapverden"
df$cleaned_country[df$cleaned_country == "kolumbianische:r"] <- "Kolumbien"
df$cleaned_country[df$cleaned_country == "kosovarische:r"] <- "Kosovo"
df$cleaned_country[df$cleaned_country == "kroatische:r"] <- "Kroatien"
df$cleaned_country[df$cleaned_country == "kuweitische:r"] <- "Kuwait"
df$cleaned_country[df$cleaned_country == "lettische:r"] <- "Lettland"
df$cleaned_country[df$cleaned_country == "libanesische:r"] <- "Libanon"
df$cleaned_country[df$cleaned_country == "libysche:r"] <- "Libyen"
df$cleaned_country[df$cleaned_country == "litauische:r"] <- "Litauen"
df$cleaned_country[df$cleaned_country == "madagassische:r"] <- "Madagaskar"
df$cleaned_country[df$cleaned_country == "malaysische:r"] <- "Malaysia"
df$cleaned_country[df$cleaned_country == "malische:r"] <- "Mali"
df$cleaned_country[df$cleaned_country == "maltesische:r"] <- "Malta"
df$cleaned_country[df$cleaned_country == "marokkanische:r"] <- "Marokko"
df$cleaned_country[df$cleaned_country == "mauritische:r"] <- "Mauretanien"
df$cleaned_country[df$cleaned_country == "mazedonische:r"] <- "Mazedonien"
df$cleaned_country[df$cleaned_country == "monegassische:r"] <- "Monaco"
df$cleaned_country[df$cleaned_country == "mongolische:r"] <- "Mongolei"
df$cleaned_country[df$cleaned_country == "montenegrinische:r"] <- "Montenegro"
df$cleaned_country[df$cleaned_country == "namibische:r"] <- "Namibia"
df$cleaned_country[df$cleaned_country == "neuseeländische:r"] <- "Neuseeland"
df$cleaned_country[df$cleaned_country == "niederländische:r"] <- "Niederlande"
df$cleaned_country[df$cleaned_country == "nordmazedonische:r"] <- "Nordmazedonien"
df$cleaned_country[df$cleaned_country == "norwegische:r"] <- "Norwegen"
df$cleaned_country[df$cleaned_country == "philippinische:r"] <- "Philippinen"
df$cleaned_country[df$cleaned_country == "polnische:r"] <- "Polen"
df$cleaned_country[df$cleaned_country == "portugisische:r"] <- "Portugal"
df$cleaned_country[df$cleaned_country == "puertoricanische:r"] <- "Puerto-Rico"
df$cleaned_country[df$cleaned_country == "ruandische:r"] <- "Ruanda"
df$cleaned_country[df$cleaned_country == "rumänische:r"] <- "Rumänien"
df$cleaned_country[df$cleaned_country == "salvadorianische:r"] <- "El Salvador"
df$cleaned_country[df$cleaned_country == "saudi-arabische:r"] <- "Saudi-Arabien"
df$cleaned_country[df$cleaned_country == "schwedische:r"] <- "Schweden"
df$cleaned_country[df$cleaned_country == "serbische:r"] <- "Serbien"
df$cleaned_country[df$cleaned_country == "simbabwische:r"] <- "Simbabwe"
df$cleaned_country[df$cleaned_country == "slowakische:r"] <- "Slowakei"
df$cleaned_country[df$cleaned_country == "slowenische:r"] <- "Slowenien"
df$cleaned_country[df$cleaned_country == "somalische:r"] <- "Somalia"
df$cleaned_country[df$cleaned_country == "spanische:r"] <- "Spanien"
df$cleaned_country[df$cleaned_country == "srilankische:r"] <- "Sri-Lanka"
df$cleaned_country[df$cleaned_country == "tadschikische:r"] <- "Tadschikistan"
df$cleaned_country[df$cleaned_country == "thailändische:r"] <- "Thailand"
df$cleaned_country[df$cleaned_country == "tunesische:r"] <- "Tunesien"
df$cleaned_country[df$cleaned_country == "türkische:r"] <- "Türkei"
df$cleaned_country[df$cleaned_country == "ugandische:r"] <- "Uganda"
df$cleaned_country[df$cleaned_country == "ungarische:r"] <- "Ungarn"
df$cleaned_country[df$cleaned_country == "venezolanische:r"] <- "Venezuela"
df$cleaned_country[df$cleaned_country == "verdische:r"] <- "Cap Verde"
df$cleaned_country[df$cleaned_country == "zypriotische:r"] <- "Zypern"
df$cleaned_country[df$cleaned_country == "zyprische:r"] <- "Zypern"
df$cleaned_country[df$cleaned_country == "ägyptische:r"] <- "Ägypten"
df$cleaned_country[df$cleaned_country == "äthiopische:r"] <- "Äthiopien"
df$cleaned_country[df$cleaned_country == "krigisische:r"] <- "Kirgisistan"
df$cleaned_country[df$cleaned_country == "zentralafrikanische:r"] <- "Kongo"
df$cleaned_country[df$cleaned_country == "russische:r"] <- "Russland"
df$cleaned_country[df$cleaned_country == "ethiopische:r"] <- "Ethiopien"


#Convert country names from German to English
df$english <- countrycode(df$cleaned_country, "country.name.de", "country.name.en")

df <- df %>% mutate(english = as.character(english))  #Convert nationality to a character type. 


#Regroup and count the occurrences
df <- df %>%
  group_by(english) %>%
  summarise(count = sum(count))



#Check for mismatches
##This cannot be done automatically. A function has to be written that analysis the problem manually.
library(rworldmap)

find_mismatched_codes <- function(df, map, joinCode, nameJoinColumn) {
  #Get the country names from the map
  map_codes <- as.character(rworldmap::getMap()@data[, joinCode])
  
  #Get the country names from the data
  data_codes <- df[[nameJoinColumn]]
  
  #Find which names from the data that are not in the map
  mismatched_codes <- setdiff(data_codes, map_codes)
  
  return(mismatched_codes)
}

mismatched_codes <- find_mismatched_codes(df, joinCountryData2Map, "NAME", "english")
print(mismatched_codes)


#Manual corrections
df$english[df$english == "Antigua & Barbuda"] <- "Antigua and Barbuda"
df$english[df$english == "Bosnia & Herzegovina"] <- "Bosnia and Herzegovina"
df$english[df$english == "Czechia"] <- "Czech Republic"
df$english[df$english == "Côte d’Ivoire"] <- "Ivory Coast"
df$english[df$english == "Dominican Republic"] <- "Dominica"
df$english[df$english == "Myanmar (Burma)"] <- "Myanmar"
df$english[df$english == "North Macedonia"] <- "Macedonia"
df$english[df$english == "Palestinian Territories"] <- "Palestine"
df$english[df$english == "Trinidad & Tobago"] <- "Trinidad and Tobago"


#Drop rows where 'english' is NA (these rows will not be able to be plotted)
df <- df %>%
  drop_na(english)


#Join with world map data
merged_df <- joinCountryData2Map(df, joinCode = "NAME", nameJoinColumn = "english")


#Plot the map
mapCountryData(merged_df, nameColumnToPlot="count", mapTitle = "Herkunftsländer der Firmengründer*innen", catMethod = "pretty", colourPalette = "heat", missingCountryCol = "lightgrey")

mapCountryData(merged_df, nameColumnToPlot="count", catMethod="jenks")


################Create a map with log-transformation since we have Switzerland as an extreme outlier.

#Load package
library(RColorBrewer)

#Create a color palette with a large number of colors
num_colors <- 100
palette <- colorRampPalette(brewer.pal(9, "Blues"))(num_colors)

#Apply a logarithmic transformation to the count variable
merged_df$log_count <- log(merged_df$count + 1)

#Plot the map with the new color palette and the transformed count variable
Karte_log <- mapCountryData(merged_df, nameColumnToPlot="log_count", catMethod="fixedWidth", colourPalette=palette, mapTitle = "Herkunftsländer der Firmengründer:innen", missingCountryCol = "lightgrey", addLegend = FALSE, 
               borderCol = "black")

#Display the plot
print(Karte_log)

#Save the plot using the dev.copy function
dev.copy(jpeg, filename = "Karte_log.jpeg", width = 1200, height = 800, units = "px", res = 100)
dev.off()
```


##Worldmap ohne AGs
This is mostly the same code as for the regular map, but all the "AGs" are removed from the data.
````{r}
#Read in data and filter for AGs
Firmengründungen2022 <- readRDS("Firmengründungen2022.Rds")
Firmengründungen2022ohneAG <- Firmengründungen2022 |> filter(Rechtsform != "AG" | is.na(Rechtsform))


##################In the following code lines we have to redo the steps from the "Counting nationalities" code chunk.

#Create a new data frame with a separate row for each person's nationality
nationality_data_ohneAG <- data.frame(owner_nationality_wcomp2 = Firmengründungen2022ohneAG$owner_nationality_wcomp2,
                               id = seq_along(Firmengründungen2022ohneAG$owner_nationality_wcomp2))

nationality_data_ohneAG <- nationality_data_ohneAG %>%
  separate_rows(owner_nationality_wcomp2, sep = "[,;]\\s*") %>%
  rename(nationality = owner_nationality_wcomp2)


#Count the occurrences of each nationality
nationality_counts_ohneAG <- nationality_data_ohneAG %>%
  group_by(nationality) %>%
  summarise(count = n()) %>%
  arrange(desc(count))


#Create a mapping of non-German expressions to German expressions.
mapping <- c(
  "Swiss" = "schweizer Staatsangehörige:r",
  "cittadina italiana" = "italienische:r Staatsangehörige:r",
  "cittadino italiano" = "italienische:r Staatsangehörige:r",
  "Italie" = "italienische:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "cittadina brasiliana" = "brasilianische:r Staatsangehörige:r",
  "cittadino brasiliano" = "brasilianische:r Staatsangehörige:r",
  "Brésil" = "brasilianische:r Staatsangehörige:r",
  "brasilianische Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "brasilianischer Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "France" = "französische:r Staatsangehörige:r",
  "französischer Staatsangehörige" = "französische:r Staatsangehörige:r",
  "französische Staatsangehörige" = "französische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutscher Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "Allemagne" = "deutsche:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutsche Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "cittadina germanica" = "deutsche:r Staatsangehörige:r",
  "cittadino germanico" = "deutsche:r Staatsangehörige:r",
  "kosovarischer Staatsangehörige" = "kosovarische:r Staatsangehörige:r",
  "kosovarische Staatsangehörige" = "kosovarische:r Staatsangehörige:r", 
  "Kosovo" = "kosovarische:r Staatsangehörige:r",
  "Portugal" = "portugisische:r Staatsangehörige:r",
  "portugiesischer Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "portugiesische Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "türkischer Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "türkische Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "Turquie" = "türkische:r Staatsangehörige:r",
  "nordmazedonischer Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "nordmazedonische Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "österreichischer Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "österreichische Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "serbischer Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "serbische Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "syrischer Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "syrische Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "spanischer Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "spanische Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "Espagne" = "spanische:r Staatsangehörige:r",
  "britischer Staatsangehörige" = "britische:r Staatsangehörige:r",
  "britische Staatsangehörige" = "britische:r Staatsangehörige:r",
  "cittadina britannica" = "britische:r Staatsangehörige:r",
  "cittadino britannico" = "britische:r Staatsangehörige:r",
  "niederländischer Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "niederländische Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "kroatischer Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "kroatische Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "ungarischer Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "ungarische Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "rumänischer Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "rumänische Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "Roumanie" = "rumänische:r Staatsangehörige:r",
  "polnischer Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "polnische Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "amerikanischer Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "amerikanische Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "herzegowinischer Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "Belgique" = "belgische:r Staatsangehörige:r",
  "belgische Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "belgischer Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "bulgarischer Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "bulgarische Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "Bulgarie" = "bulgarische:r Staatsangehörige:r",
  "cittadina bulgara" = "bulgarische:r Staatsangehörige:r",
  "cittadino bulgaro" = "bulgarische:r Staatsangehörige:r",
  "slowakischer Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "slowakische Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "Dominique" = "domenikanische:r Staatsangehörige:r",
  "domenikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "domenikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "République dominicaine" = "domenikanische:r Staatsangehörige:r",
  "Maurice" = "mauritische:r Staatsangehörige:r",
  "mauritische Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "mauritischer Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "lankischer Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "lankische Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "afghanischer Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "afghanische Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "Afghanistan" = "afghanische:r Staatsangehörige:r",
  "cittadina afghana" = "afghanische:r Staatsangehörige:r",
  "cittadino afghano" = "afghanische:r Staatsangehörige:r",
  "Malte" = "maltesische:r Staatsangehörige:r",
  "maltesischer Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "ukrainische Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "ukrainischer Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "Ukraine" = "ukrainische:r Staatsangehörige:r",
  "indischer Staatsangehörige" = "indische:r Staatsangehörige:r",
  "indische Staatsangehörige" = "indische:r Staatsangehörige:r",
  "thailändische Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "thailändischer Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "chinesischer Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "chinesische Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "cittadina cinese" = "chinesische:r Staatsangehörige:r",
  "cittadino cinese" = "chinesische:r Staatsangehörige:r",
  "Afrique du Sud" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanische Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanischer Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "ägyptische Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "ägyptischer Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "albanische Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "albanischer Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "Albanie" = "albanische:r Staatsangehörige:r",
  "cittadina albanese" = "albanische:r Staatsangehörige:r",
  "cittadino albanese" = "albanische:r Staatsangehörige:r",
  "algerische Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "algerischer Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "Algérie" = "albanische:r Staatsangehörige:r",
  "angolanischer Staatsangehörige" = "angolanische:r Staatsangehörige:r",
  "Angola" = "angolanische:r Staatsangehörige:r",
  "Arabie saoudite" = "saudi-arabische:r Staatsangehörige:r",
  "argentinische Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "argentinischer Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "Argentine" = "argentinische:r Staatsangehörige:r",
  "armenische Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "armenischer Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "Arménie" = "armenische:r Staatsangehörige:r",
  "aserbaidschanische Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "aserbaidschanischer Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "Azerbaïdjan" = "aserbaidschanische:r Staatsangehörige:r",
  "äthiopische Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "äthiopischer Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "Autriche" = "österreichische:r Staatsangehörige:r",
  "Australie" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "cittadina austriaca"  = "australische:r Staatsangehörige:r",
  "cittadina austriaco"  = "australische:r Staatsangehörige:r",
  "Bangladesh" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschischer Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschische Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "belarussische Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "belarussischer Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "bolivianische Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "bolivianischer Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "Bolivie" = "bolivianische:r Staatsangehörige:r",
  "bosnische Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "bosnischer Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "Bosnie-Herzégovine" = "bosnische:r Staatsangehörige:r",
  "cittadina bosniaca" = "bosnische:r Staatsangehörige:r",
  "cittadino bosniaco" = "bosnische:r Staatsangehörige:r",
  "burundischer Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "burundische Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "kamerunische Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "kamerunischer Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "Cameroun" = "kamerunische:r Staatsangehörige:r",
  "Canada" = "kanadische:r Staatsangehörige:r",
  "kanadischer Staatsangehörige" = "kanadische:r Staatsangehörige:r", 
  "kanadische Staatsangehörige" = "kanadische:r Staatsangehörige:r",
  "chilenische Staatsangehörige" = "chilenische:r Staatsangehörige:r", 
  "chilenischer Staatsangehörige" = "chilenische:r Staatsangehörige:r",
  "Chili" = "chilenische:r Staatsangehörige:r",
  "Chine" = "chinesische:r Staatsangehörige:r",
  "botsuanische Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "botsuanischer Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "Botswana" = "botsuanische:r Staatsangehörige:r",
  "Burundi" = "burundische:r Staatsangehörige:r",
  "beninischer Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "beninische Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "Bénin" = "beninische:r Staatsangehörige:r",
  "Biélorussie" = "weiss-russische:r Staatsangehörige:r",
  "cittadina bielorussa" = "weiss-russische:r Staatsangehörige:r",
  "Bermudes" = "bermudische:r Staatsangehörige:r",
  "Burkina Faso" = "burkinische:r Staatsangehörige:r",
  "Cambodge" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanische Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanischer Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "Kazakhstan" = "kasachische:r Staatsangehörige:r",
  "kasachische Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "kasachischer Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "zyprischer Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "zyprische Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "Chypre" = "zyprische:r Staatsangehörige:r",
  "cittadina ceca" = "tschechische:r Staatsangehörige:r",
  "cittadino ceco" = "tschechische:r Staatsangehörige:r",
  "tschechische Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "tschechischer Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "cittadina colombiana" = "kolumbianische:r Staatsangehörige:r",
  "cittadino colombiano" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianische Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianischer Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "vietnamesische Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "vietnamesischer Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "Vietnam" = "vietnamesische:r Staatsangehörige:r",
  "venezolanische Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "venezolanischer Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "Venezuela" = "venezolanische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "uruguayischer Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "uruguayische Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "ugandische Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "ugandischer Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "tunesische Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "tunesischer Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "Tunisie" = "tunesische:r Staatsangehörige:r",
  "togoische Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "togoischer Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "Togo" = "togoische:r Staatsangehörige:r",
  "Thaïlande" = "thailändische:r Staatsangehörige:r",
  "taiwanische Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "taiwanischer Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "Taïwan" = "taiwanische:r Staatsangehörige:r",
  "tadschikische Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "tadschikischer Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "Syrie" = "syrische:r Staatsangehörige:r",
  "Suède" = "schwedische:r Staatsangehörige:r",
  "schwedische Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "schwedischer Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "südkoreanische Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "südkoreanischer Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "Sri Lanka" = "srilankische:r Staatsangehörige:r",
  "somalische Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "somalischer Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "Somalie" = "somalische:r Staatsangehörige:r",
  "slowenische Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "slowenischer Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "Slovénie" = "slowenische:r Staatsangehörige:r",
  "Slovaquie" = "slowakische:r Staatsangehörige:r",
  "singapurische Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "singapurischer Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "Singapour" = "singapurische:r Staatsangehörige:r",
  "Serbie" = "serbische:r Staatsangehörige:r",
  "senegalesische Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "senegalesischer Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "Sénégal" = "senegalesische:r Staatsangehörige:r",
  "salvadorianische Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "salvadorianischer Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "Salvador" = "salvadorianische:r Staatsangehörige:r",
  "russische Staatsangehörige" = "russische:r Staatsangehörige:r",
  "russischer Staatsangehörige" = "russische:r Staatsangehörige:r",
  "Russie" = "russische:r Staatsangehörige:r",
  "Royaume-Uni" = "britische:r Staatsangehörige:r",
  "Pologne" = "polnische:r Staatsangehörige:r",
  "philippinische Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "philippinischer Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "Philippines" = "philippinische:r Staatsangehörige:r",
  "peruanische Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "peruanischer Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "Pérou" = "peruanische:r Staatsangehörige:r",
  "Pays-Bas" = "niederländische:r Staatsangehörige:r",
  "panamaische Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "panamaischer Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "Panama" = "panamaische:r Staatsangehörige:r",
  "pakistanische Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "pakistanischer Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "Pakistan" = "pakistanische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "Ouzbékistan" = "usbekische:r Staatsangehörige:r",
  "norwegische Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "norwegischer Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "Norvège" = "norwegische:r Staatsangehörige:r",
  "nigerianischer Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "nigerianische Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "Nigéria" = "nigerianische:r Staatsangehörige:r",
  "nicaraguanischer Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "nicaraguanische Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "neuseeländischer Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "neuseeländische Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "montenegrinischer Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "montenegrinische Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "Monténégro" = "montenegrinische:r Staatsangehörige:r",
  "mongolischer Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "mongolische Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "Mongolie" = "mongolische:r Staatsangehörige:r",
  "mexikanischer Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "mexikanische Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "Mexique" = "mexikanische:r Staatsangehörige:r",
  "mazedonische Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "mazedonischer Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "marokkanische Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "marokkanischer Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "Maroc" = "marokkanische:r Staatsangehörige:r",
  "malaysische Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "malaysischer Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "Malaisie" = "malaysische:r Staatsangehörige:r",
  "madagassische Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "madagassischer Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "Madagascar" = "malaysische:r Staatsangehörige:r",
  "luxemburgische Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "luxemburgischer Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "Luxembourg" = "luxemburgische:r Staatsangehörige:r",
  "litauische Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "litauischer Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "Lituanie" = "litauische:r Staatsangehörige:r",
  "liechtensteinische Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "liechtensteinischer Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "libanesische Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "libanesischer Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "Liban" = "libanesische:r Staatsangehörige:r",
  "libysche Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "libyscher Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "Libye" = "libysche:r Staatsangehörige:r",
  "lybischer Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lybische Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lettische Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "lettischer Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "Lettonie" = "lettische:r Staatsangehörige:r",
  "kubanische Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "kubanischer Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "jemenitische Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "jemenitischer Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "japanische Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "japanischer Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "Japon" = "japanische:r Staatsangehörige:r",
  "jamaikanische Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "jamaikanischer Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "Jamaïque" = "jamaikanische:r Staatsangehörige:r",
  "italianischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "ivorische Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "ivorischer Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "israelische Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "israelischer Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "Israël" = "israelische:r Staatsangehörige:r",
  "isländische Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "isländischer Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "irische Staatsangehörige" = "irische:r Staatsangehörige:r",
  "irischer Staatsangehörige" = "irische:r Staatsangehörige:r",
  "Irlande" = "irische:r Staatsangehörige:r",
  "iranische Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "iranischer Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "Iran" = "iranische:r Staatsangehörige:r",
  "irakische Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "irakischer Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "Irak" = "irakische:r Staatsangehörige:r",
  "indonesische Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "indonesischer Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "Indonésie" = "indonesische:r Staatsangehörige:r",
  "Inde" = "indische:r Staatsangehörige:r",
  "hongkonger Staatsangehörige" = "hongkonger:r Staatsangehörige:r",
  "Hongrie" = "ungarische:r Staatsangehörige:r",
  "honduranischer Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "honduranische Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "guineischer Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "guineische Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "Guinée" = "guineische:r Staatsangehörige:r",
  "grenadischer Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "grenadische Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "Grenade" = "grenadische:r Staatsangehörige:r",
  "Grèce" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "Ghana" = "ghanaische:r Staatsangehörige:r",
  "ghanaische Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "ghanaischer Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "georgische Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "georgischer Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "Géorgie" = "georgische:r Staatsangehörige:r",
  "gabunische Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gabunischer Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gambischer Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "gambische Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "finnische Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "finnischer Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "Finlande" = "finnische:r Staatsangehörige:r",
  "estnische Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "estnischer Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "eritreische Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "eritreischer Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "Érythrée" = "eritreische:r Staatsangehörige:r",
  "ecuadorianische Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "ecuadorianischer Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "Équateur" = "ecuadorianische:r Staatsangehörige:r",
  "dänische Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "dänischer Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "Danemark" = "dänische:r Staatsangehörige:r",
  "Cuba" = "kubanische:r Staatsangehörige:r", 
  "Croatie" = "kroatische:r Staatsangehörige:r", 
  "Costa Rica" = "costaricanische:r Staatsangehörige:r", 
  "Corée du Sud" = "südkoreanische:r Staatsangehörige:r", 
  "Colombie" = "kolumbianische:r Staatsangehörige:r", 
  "cittadino venezuelano" = "venezolanische:r Staatsangehörige:r",
  "cittadina venezuelana" = "venezolanische:r Staatsangehörige:r",
  "cittadino ungherese" = "ungarische:r Staatsangehörige:r",
  "cittadino ucraino" = "ukrainische:r Staatsangehörige:r",
  "cittadina ucraina" = "ukrainische:r Staatsangehörige:r",
  "cittadino turco" = "türkische:r Staatsangehörige:r", 
  "cittadina svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadina statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadino spagnolo" = "spanische:r Staatsangehörige:r", 
  "cittadina spagnola" = "spanische:r Staatsangehörige:r", 
  "cittadino sloveno" = "slowenische:r Staatsangehörige:r", 
  "cittadina slovena" = "slowenische:r Staatsangehörige:r", 
  "cittadino siriano" = "syrische:r Staatsangehörige:r",
  "cittadina slovacca" = "slowakische:r Staatsangehörige:r",
  "cittadina croata" = "kroatische:r Staatsangehörige:r",
  "cittadino croato" = "kroatische:r Staatsangehörige:r",
  "cittadina danese" = "dänische:r Staatsangehörige:r",
  "cittadino danese" = "dänische:r Staatsangehörige:r",
  "cittadina cubano" = "kubanische:r Staatsangehörige:r",
  "cittadina domenicana" = "domenikanische:r Staatsangehörige:r",
  "cittadina eritrea" = "eritreische:r Staatsangehörige:r",
  "cittadino russo" = "russische:r Staatsangehörige:r",
  "cittadina russa" = "russische:r Staatsangehörige:r",
  "Cap-Vert" = "kapverdische:r Staatsangehörige:r",
  "cittadina francese" = "französische:r Staatsangehörige:r",
  "cittadina giapponese" = "japanische:r Staatsangehörige:r",
  "cittadina greca" = "griechische:r Staatsangehörige:r",
  "cittadina iraniana" = "iranische:r Staatsangehörige:r",
  "cittadina kazaka" = "kasachische:r Staatsangehörige:r",
  "cittadina kosovara" = "kosovarische:r Staatsangehörige:r",
  "cittadina lettone" = "lettische:r Staatsangehörige:r",
  "cittadina libanese" = "libanesische:r Staatsangehörige:r",
  "cittadina lituana" = "litauische:r Staatsangehörige:r",
  "cittadina macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadina messicana" = "mexikanische:r Staatsangehörige:r",
  "cittadina moldova" = "moldavische:r Staatsangehörige:r",
  "cittadina norvegese" = "norwegische:r Staatsangehörige:r",
  "cittadina olandese" = "niederländische:r Staatsangehörige:r",
  "cittadina polacca" = "polnische:r Staatsangehörige:r",
  "cittadina portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadina romena" = "rumänische:r Staatsangehörige:r",
  "cittadina serba" = "serbische:r Staatsangehörige:r",
  "cittadino angolano" = "angolanische:r Staatsangehörige:r",
  "cittadino austriaco" = "österreichische:r Staatsangehörige:r",
  "cittadino belga" = "belgische:r Staatsangehörige:r",
  "cittadino boliviano" = "bolivianische:r Staatsangehörige:r",
  "cittadino cileno" = "chilenische:r Staatsangehörige:r",
  "cittadino cubano" = "kubanische:r Staatsangehörige:r",
  "cittadino ecuadoriano" = "ecuadorianische:r Staatsangehörige:r",
  "cittadino finlandese" = "finnische:r Staatsangehörige:r",
  "cittadino francese" = "französische:r Staatsangehörige:r",
  "cittadino greco" = "griechische:r Staatsangehörige:r",
  "cittadino iracheno" = "irakische:r Staatsangehörige:r",
  "cittadino irlandese" = "irische:r Staatsangehörige:r",
  "cittadino kosovaro" = "kosovarische:r Staatsangehörige:r",
  "cittadino lettone" = "lettische:r Staatsangehörige:r",
  "cittadino macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadino marocchino" = "marokkanische:r Staatsangehörige:r",
  "cittadino messicano" = "mexikanische:r Staatsangehörige:r",
  "cittadino montenegrino" = "montenegrinische:r Staatsangehörige:r",
  "cittadino olandese" = "niederländische:r Staatsangehörige:r",
  "cittadino polacco" = "polnische:r Staatsangehörige:r",
  "cittadino portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadino senegalese" = "senegalesische:r Staatsangehörige:r",
  "cittadino serbo" = "serbische:r Staatsangehörige:r",
  "cittadino tunisino" = "tunesische:r Staatsangehörige:r",
  "Curaçao" = "Curaçaoënarische:r Staatsangehörige:r",
  "Gibraltar" = "gibraltaische:r Staatsangehörige:r",
  "Honduras" = "honduranische:r Staatsangehörige:r",
  "jordanischer Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "jordanische Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "Jordanie" = "jordanische:r Staatsangehörige:r",
  "Koweït" = "kuweitische:r Staatsangehörige:r",
  "Macédoine du Nord" = "nordmazedonische:r Staatsangehörige:r",
  "Moldavie" = "moldavische:r Staatsangehörige:r",
  "Nicaragua" = "nicaraguanische:r Staatsangehörige:r",
  "Niger" = "nigeranische:r Staatsangehörige:r",
  "Nouvelle-Zélande" = "neuseeländische:r Staatsangehörige:r",
  "Ouganda" = "ugandische:r Staatsangehörige:r",
  "Paraguay" = "paraguayanische:r Staatsangehörige:r",
  "ruandischer Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ruandische Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ricanischer Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "ricanische Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "Tchéquie" = "tschechische:r Staatsangehörige:r",
  "Yémen" = "jemenitische:r Staatsangehörige:r",
  "cittadina di" = "unbekannte Staatsangehörigkeit",
  "cittadino di" = "unbekannte Staatsangehörigkeit",
  "cittadino romeno"  = "rumänische:r Staatsangehörige:r",
  "unbekannte Staatsangehörig" = "unbekannte Staatsangehörigkeit",
  "Mali" = "malische:r Staatsangehörige:r",
  "Monaco" = "monegassische:r Staatsangehörige:r",
  "République centrafricaine" = "zentralafrikanische:r Staatsangehörige:r",
  "andorrine Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "andorriner Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "arabische Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "arabischer Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "burkinischer Staatsangehörige" = "burkinische:r Staatsangehörige:r",
  "cittadino argentino" = "argentinische:r Staatsangehörige:r",
  "cittadino australiano" = "australische:r Staatsangehörige:r",
  "cittadino canadese" = "kanadische:r Staatsangehörige:r",
  "cittadino cipriota" = "zyprische:r Staatsangehörige:r",
  "cittadino indiano" = "indische:r Staatsangehörige:r",
  "cittadino lussemburghese" = "luxemburgische:r Staatsangehörige:r",
  "cittadino norvegese" = "norwegische:r Staatsangehörige:r",
  "guatemaltekischer Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "guatemaltekische Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "haitianischer Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "haitianische Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "Kirghizistan" = "krigisische:r Staatsangehörige:r",
  "krigisische Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "krigisischer Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "kiribatischer Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "kiribatische Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "moldauische Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "moldauischer Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "mosambikanische Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "mosambikanischer Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "myanmarische Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "myanmarischer Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "namibische Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "namibischer Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "nepalesische Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "nepalesischer Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "Soudan" = "sudanesische:r Staatsangehörige:r",
  "sudanesische Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "sudanesischer Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "kenianische Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "kenianischer Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "palästinischer Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "palästinische Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "paraguayische Staatsangehörige" = "paraguayanische:r Staatsangehörige:r",
  "antiguanischer Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "antiguanische Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "simbabwischer Staatsangehörige" = "simbabwische:r Staatsangehörige:r",
  "simbabwische Staatsangehörige" = "simbabwische:r Staatsangehörige:r", 
  "Jersey" = "jerseyische:r Staatsangehörige:r",
  "Émirats arabes unis" = "emiratische:r Staatsangehörige:r",
  "Estonie" = "estnische:r Staatsangehörige:r",
  "Fidji" = "fidschianische:r Staatsangehörige:r",
  "Qatar" = "katarische:r Staatsangehörige:r",
  "Montserrat" = "montserratische:r Staatsangehörige:r",
  "Liechtenstein" = "liechtensteinische:r Staatsangehörige:r",
  "Uruguay" = "uruguayische:r Staatsangehörige:r",
  "Éthiopie" = "ethiopische:r Staatsangehörige:r",
  "Kenya" = "kenianische:r Staatsangehörige:r",
  "Maldives" = "maledivische:r Staatsangehörige:r",
  "Mozambique" = "mosambikanische:r Staatsangehörige:r",
  "Rwanda" = "ruandische:r Staatsangehörige:r",
  "Trinité-et-Tobago" = "trinidadianische und tobagoische:r Staatsangehörige:r",
  "citoyen afghan" = "afghanische:r Staatsangehörige:r",
  "ressortissant afghan" = "afghanische:r Staatsangehörige:r",
  "citoyen algérien" = "algerische:r Staatsangehörige:r",
  "citoyen allemand" = "deutsche:r Staatsangehörige:r",
  "citoyen américain" = "amerikanische:r Staatsangehörige:r",
  "citoyen arménien" = "armenische:r Staatsangehörige:r",
  "citoyen australien" = "australische:r Staatsangehörige:r",
  "citoyen belge" = "belgische:r Staatsangehörige:r",
  "citoyen bosniaque" = "bosnische:r Staatsangehörige:r",
  "citoyen brésilien" = "brasilianische:r Staatsangehörige:r",
  "citoyen britannique" = "britische:r Staatsangehörige:r",
  "citoyen bulgare" = "bulgarische:r Staatsangehörige:r",
  "citoyen danois" = "dänische:r Staatsangehörige:r",
  "citoyen espagnol" = "spanische:r Staatsangehörige:r",
  "citoyen français" = "französische:r Staatsangehörige:r",
  "citoyen hongrois" = "ungarische:r Staatsangehörige:r",
  "citoyen indien" = "indische:r Staatsangehörige:r",
  "citoyen irlandais" = "irische:r Staatsangehörige:r",
  "citoyen italien" = "italienische:r Staatsangehörige:r",
  "citoyen kosovar" = "kosovarische:r Staatsangehörige:r",
  "citoyen letton" = "lettische:r Staatsangehörige:r",
  "citoyen macédonien" = "mazedonische:r Staatsangehörige:r",
  "citoyen moldave" = "moldavische:r Staatsangehörige:r",
  "citoyen néerlandais" = "niederländische:r Staatsangehörige:r",
  "citoyen péruvien" = "peruanische:r Staatsangehörige:r",
  "citoyen polonais" = "polnische:r Staatsangehörige:r",
  "citoyen portugais" = "portugisische:r Staatsangehörige:r",
  "citoyen roumain" = "rumänische:r Staatsangehörige:r",
  "citoyen sénégalais" = "senegalesische:r Staatsangehörige:r",
  "citoyen serbe" = "serbische:r Staatsangehörige:r",
  "citoyen slovaque" = "slowakische:r Staatsangehörige:r",
  "citoyen somalien" = "somalische:r Staatsangehörige:r",
  "citoyen sri" = "srilankische:r Staatsangehörige:r",
  "ressortissant sri" = "srilankische:r Staatsangehörige:r",
  "ressortissante sri" = "srilankische:r Staatsangehörige:r",
  "citoyen suédois" = "schwedische:r Staatsangehörige:r",
  "citoyen syrien" = "syrische:r Staatsangehörige:r",
  "citoyen tchèque" = "tschechische:r Staatsangehörige:r",
  "citoyen turc" = "türkische:r Staatsangehörige:r",
  "citoyen ukrainien" = "ukrainische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "österreichische:r Staatsangehörige:r",
  "citoyenne belge" = "belgische:r Staatsangehörige:r",
  "citoyenne brésilienne" = "brasilianische:r Staatsangehörige:r",
  "citoyenne britannique" = "britische:r Staatsangehörige:r",
  "citoyenne chinoise" = "chinesische:r Staatsangehörige:r",
  "citoyenne espagnole" = "spanische:r Staatsangehörige:r",
  "citoyenne française" = "französische:r Staatsangehörige:r",
  "citoyenne guineische" = "guineische:r Staatsangehörige:r",
  "citoyenne hongroise" = "ungarische:r Staatsangehörige:r",
  "citoyenne irlandaise" = "irische:r Staatsangehörige:r",
  "citoyenne italienne" = "italienische:r Staatsangehörige:r",
  "citoyenne kosovare" = "kosovarische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "mazedonische:r Staatsangehörige:r",
  "citoyenne marocaine" = "marokkanische:r Staatsangehörige:r",
  "citoyenne néo" = "neuseeländische:r Staatsangehörige:r",
  "citoyenne polonaise" = "polnische:r Staatsangehörige:r",
  "citoyenne portugaise" = "portugisische:r Staatsangehörige:r",
  "citoyenne roumaine" = "rumänische:r Staatsangehörige:r",
  "citoyenne russe" = "russische:r Staatsangehörige:r",
  "citoyenne rwandaise" = "ruandische:r Staatsangehörige:r",
  "citoyenne turque" = "türkische:r Staatsangehörige:r",
  "citoyenne ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "Grande-Bretagne" = "britische:r Staatsangehörige:r",
  "Mauritanie" = "mauretanische:r Staatsangehörige:r",
  "ressortissant albanais" = "albanische:r Staatsangehörige:r",
  "ressortissant algérien" = "algerische:r Staatsangehörige:r",
  "ressortissant allemand" = "deutsche:r Staatsangehörige:r",
  "ressortissant américain" = "amerikanische:r Staatsangehörige:r",
  "ressortissant autrichien" = "österreichische:r Staatsangehörige:r",
  "ressortissant belge" = "belgische:r Staatsangehörige:r",
  "ressortissant bosniaque" = "bosnische:r Staatsangehörige:r",
  "ressortissant brésilien" = "brasilianische:r Staatsangehörige:r",
  "ressortissant britannique" = "britische:r Staatsangehörige:r",
  "ressortissant bulgare" = "bulgarische:r Staatsangehörige:r",
  "ressortissant camerounais" = "kamerunische:r Staatsangehörige:r",
  "ressortissant canadien" = "kanadische:r Staatsangehörige:r",
  "ressortissant chinois" = "chinesische:r Staatsangehörige:r",
  "ressortissant croate" = "kroatische:r Staatsangehörige:r",
  "ressortissant érythréen" = "eritreische:r Staatsangehörige:r",
  "ressortissant espagnol" = "spanische:r Staatsangehörige:r",
  "ressortissant français" = "französische:r Staatsangehörige:r",
  "ressortissant hongrois" = "ungarische:r Staatsangehörige:r",
  "ressortissant indien" = "indische:r Staatsangehörige:r",
  "ressortissant iranien" = "iranische:r Staatsangehörige:r",
  "ressortissant iraquien" = "irakische:r Staatsangehörige:r",
  "ressortissant italien" = "italienische:r Staatsangehörige:r",
  "ressortissant ivoirien" = "ivorische:r Staatsangehörige:r",
  "ressortissant kosovar" = "kosovarische:r Staatsangehörige:r",
  "ressortissant libanais" = "libanesische:r Staatsangehörige:r",
  "ressortissant lituanien" = "lituanische:r Staatsangehörige:r",
  "ressortissant macédonien" = "mazedonische:r Staatsangehörige:r",
  "ressortissant malgache" = "madagassische:r Staatsangehörige:r",
  "ressortissant marocain" = "marokkanische:r Staatsangehörige:r",
  "ressortissant mauricien" = "mauritische:r Staatsangehörige:r",
  "ressortissant mexicain" = "mexikanische:r Staatsangehörige:r",
  "ressortissant monténégrin" = "montenegrinische:r Staatsangehörige:r",
  "ressortissant polonais" = "polnische:r Staatsangehörige:r",
  "ressortissant portugais" = "portugisische:r Staatsangehörige:r",
  "ressortissant roumain" = "rumänische:r Staatsangehörige:r",
  "ressortissant russe" = "russische:r Staatsangehörige:r",
  "ressortissant rwandais" = "ruandische:r Staatsangehörige:r",
  "ressortissant serbe" = "serbische:r Staatsangehörige:r",
  "ressortissant slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissant somalien" = "somalische:r Staatsangehörige:r",
  "ressortissant syrien" = "syrische:r Staatsangehörige:r",
  "ressortissant thaïlandais" = "thailändische:r Staatsangehörige:r",
  "ressortissant tunisien" = "tunesische:r Staatsangehörige:r",
  "ressortissant turc" = "türkische:r Staatsangehörige:r",
  "ressortissante algérienne" = "algerische:r Staatsangehörige:r",
  "ressortissante allemande" = "deutsche:r Staatsangehörige:r",
  "ressortissante américaine" = "amerikanische:r Staatsangehörige:r",
  "ressortissante belge" = "belgische:r Staatsangehörige:r",
  "ressortissante béninoise" = "beninische:r Staatsangehörige:r",
  "ressortissante brésilienne" = "brasilianische:r Staatsangehörige:r",
  "ressortissante britannique" = "britische:r Staatsangehörige:r",
  "ressortissante burkinabè" = "burkinische:r Staatsangehörige:r",
  "ressortissante chinoise" = "chinesische:r Staatsangehörige:r",
  "ressortissante coréenne" = "südkoreanische:r Staatsangehörige:r",
  "ressortissante croate" = "koratische:r Staatsangehörige:r",
  "ressortissante dominicaine" = "domenikanische:r Staatsangehörige:r",
  "ressortissante espagnole" = "spanische:r Staatsangehörige:r",
  "ressortissante française" = "französische:r Staatsangehörige:r",
  "ressortissante gabonaise" = "gabunische:r Staatsangehörige:r",
  "ressortissante indienne" = "indische:r Staatsangehörige:r",
  "ressortissante italienne" = "italienische:r Staatsangehörige:r",
  "ressortissante ivoirienne" = "ivorische:r Staatsangehörige:r",
  "ressortissante kosovare" = "kosovarische:r Staatsangehörige:r",
  "ressortissante lettone" = "lettische:r Staatsangehörige:r",
  "ressortissante libanaise" = "libanesische:r Staatsangehörige:r",
  "ressortissante marocaine" = "marokkanische:r Staatsangehörige:r",
  "ressortissante mauricienne" = "mauritische:r Staatsangehörige:r",
  "ressortissante paraguayenne" = "paraguayanische:r Staatsangehörige:r",
  "ressortissante polonaise" = "polnische:r Staatsangehörige:r",
  "ressortissante portugaise" = "portugisische:r Staatsangehörige:r",
  "ressortissante roumaine" = "rumänische:r Staatsangehörige:r",
  "ressortissante russe" = "russische:r Staatsangehörige:r",
  "ressortissante slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissante syrienne" = "syrische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante thaïlandaise" = "thailändische:r Staatsangehörige:r",
  "ressortissante tunisienne" = "tunesische:r Staatsangehörige:r",
  "ressortissante turque" = "türkische:r Staatsangehörige:r",
  "ressortissante ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "ressortissante vietnamienne" = "vietnamesische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "citoyenne guinéenne" = "guineische:r Staatsangehörige:r",
  "citoyenne macédonienne" = "mazedonische:r Staatsangehörige:r",
  "Guinée-Bissau" = "guinea-bissauische:r Staatsangehörige:r",
  "Mauritius" = "mauritische:r Staatsangehörige:r",
  "verdischer Staatsangehörige" = "verdische:r Staatsangehörige:r",
  "vanuatuischer Staatsangehörige"  = "vanuatuische:rr Staatsangehörige:r"


  
              # Add more mappings here as needed. For example if the analysis is done for another year, where different names appear.
)


#Replace non-German expressions with their German counterparts
nationality_counts_ohneAG <- nationality_counts_ohneAG %>%
  mutate(nationality = ifelse(nationality %in% names(mapping),
                              mapping[nationality],
                              nationality)) %>%
  mutate(nationality = as.character(nationality))


#Regroup and count the occurrences
nationality_counts_ohneAG <- nationality_counts_ohneAG %>%
  group_by(nationality) %>%
  summarise(count = sum(count))


#Save the data
saveRDS(nationality_counts_ohneAG, "nationality_counts_ohneAG.Rds")


################# Create the actual map without AGs
##This is again much of the same code as it has been used for the map *with* the AGs.

#Activate packages
library(ggplot2)
library(maps)
library(dplyr)
library(tidyr)
library(rworldmap)
library(countrycode)
library(stringr)

#Load data and rename
nationality_counts_ohneAG <- readRDS("nationality_counts_ohneAG.Rds")
df <- nationality_counts_ohneAG


#Get the world map data
world_map <- getMap()


#Clean nationality column to get country names in German
df$cleaned_country <- str_replace_all(df$nationality, c(":r Staatsangehörige"="", ":r Staatsangehörigkeit"="", "r Staatsangehörige"="", "r Staatsangehörigkeit"=""))


#Specific replacements for non-standard terms
##The renaming is done manually and necessary, so that the names of the nationalities align with the country names of the "rworldmap" package.
df$cleaned_country[df$cleaned_country == "Company"] <- NA
df$cleaned_country[df$cleaned_country == "unbekannte"] <- NA
df$cleaned_country[df$cleaned_country == "Grande-Bretagne"] <- "Großbritannien"
df$cleaned_country[df$cleaned_country == "Suisse"] <- NA
df$cleaned_country[df$cleaned_country == "verdischer Staatsangehörige"] <- "Kap Verde"
df$cleaned_country[df$cleaned_country == "schweizer Staatsangehörige:r"] <- "Schweiz"
df$cleaned_country[df$cleaned_country == "weiss-russische:r"] <- "Belarus"
df$cleaned_country[df$cleaned_country == "albanische:r"] <- "Albanien"
df$cleaned_country[df$cleaned_country == "algerische:r"] <- "Algerien"
df$cleaned_country[df$cleaned_country == "amerikanische:r"] <- "USA"
df$cleaned_country[df$cleaned_country == "andorrine:r"] <- "Andorra"
df$cleaned_country[df$cleaned_country == "arabische:r"] <- "Saudiarabien"
df$cleaned_country[df$cleaned_country == "armenische:r"] <- "Armenien"
df$cleaned_country[df$cleaned_country == "australische:r"] <- "Australien"
df$cleaned_country[df$cleaned_country == "belgische:r"] <- "Belgien"
df$cleaned_country[df$cleaned_country == "bermudische:r"] <- "Bermuda"
df$cleaned_country[df$cleaned_country == "bolivianische:r"] <- "Bolivien"
df$cleaned_country[df$cleaned_country == "bosnische:r"] <- "Bosnien"
df$cleaned_country[df$cleaned_country == "botsuanische:r"] <- "Botsuana"
df$cleaned_country[df$cleaned_country == "britische:r"] <- "Großbritannien"
df$cleaned_country[df$cleaned_country == "bulgarische:r"] <- "Bulgarien"
df$cleaned_country[df$cleaned_country == "burkinische:r"] <- "Burkinafaso"
df$cleaned_country[df$cleaned_country == "chinesische:r"] <- "China"
df$cleaned_country[df$cleaned_country == "deutsche:r"] <- "Deutschland"
df$cleaned_country[df$cleaned_country == "domenikanische:r"] <- "Dominikanische Republik"
df$cleaned_country[df$cleaned_country == "dänische:r"] <- "Dänemark"
df$cleaned_country[df$cleaned_country == "emiratische:r"] <- "Vereinigte arabische Emirate"
df$cleaned_country[df$cleaned_country == "eritreische:r"] <- "Eritrea"
df$cleaned_country[df$cleaned_country == "estnische:r"] <- "Estland"
df$cleaned_country[df$cleaned_country == "finnische:r"] <- "Finnland"
df$cleaned_country[df$cleaned_country == "französische:r"] <- "Frankreich"
df$cleaned_country[df$cleaned_country == "gambische:r"] <- "Gambia"
df$cleaned_country[df$cleaned_country == "georgische:r"] <- "Georgien"
df$cleaned_country[df$cleaned_country == "gibraltaische:r"] <- "Gibraltar"
df$cleaned_country[df$cleaned_country == "griechische:r"] <- "Griechenland"
df$cleaned_country[df$cleaned_country == "guatemaltekische:r"] <- "Guatemala"
df$cleaned_country[df$cleaned_country == "guineische:r"] <- "Guinea"
df$cleaned_country[df$cleaned_country == "herzegowinische:r"] <- "Herzegowina"
df$cleaned_country[df$cleaned_country == "honduranische:r"] <- "Honduras"
df$cleaned_country[df$cleaned_country == "indische:r"] <- "Indien"
df$cleaned_country[df$cleaned_country == "indonesische:r"] <- "Indonesien"
df$cleaned_country[df$cleaned_country == "irische:r"] <- "Irland"
df$cleaned_country[df$cleaned_country == "isländische:r"] <- "Island"
df$cleaned_country[df$cleaned_country == "kanadische:r"] <- "Kanada"
df$cleaned_country[df$cleaned_country == "kapverdische:r"] <- "Kapverden"
df$cleaned_country[df$cleaned_country == "kolumbianische:r"] <- "Kolumbien"
df$cleaned_country[df$cleaned_country == "kosovarische:r"] <- "Kosovo"
df$cleaned_country[df$cleaned_country == "kroatische:r"] <- "Kroatien"
df$cleaned_country[df$cleaned_country == "kuweitische:r"] <- "Kuwait"
df$cleaned_country[df$cleaned_country == "lettische:r"] <- "Lettland"
df$cleaned_country[df$cleaned_country == "libanesische:r"] <- "Libanon"
df$cleaned_country[df$cleaned_country == "libysche:r"] <- "Libyen"
df$cleaned_country[df$cleaned_country == "litauische:r"] <- "Litauen"
df$cleaned_country[df$cleaned_country == "madagassische:r"] <- "Madagaskar"
df$cleaned_country[df$cleaned_country == "malaysische:r"] <- "Malaysia"
df$cleaned_country[df$cleaned_country == "malische:r"] <- "Mali"
df$cleaned_country[df$cleaned_country == "maltesische:r"] <- "Malta"
df$cleaned_country[df$cleaned_country == "marokkanische:r"] <- "Marokko"
df$cleaned_country[df$cleaned_country == "mauritische:r"] <- "Mauretanien"
df$cleaned_country[df$cleaned_country == "mazedonische:r"] <- "Mazedonien"
df$cleaned_country[df$cleaned_country == "monegassische:r"] <- "Monaco"
df$cleaned_country[df$cleaned_country == "mongolische:r"] <- "Mongolei"
df$cleaned_country[df$cleaned_country == "montenegrinische:r"] <- "Montenegro"
df$cleaned_country[df$cleaned_country == "namibische:r"] <- "Namibia"
df$cleaned_country[df$cleaned_country == "neuseeländische:r"] <- "Neuseeland"
df$cleaned_country[df$cleaned_country == "niederländische:r"] <- "Niederlande"
df$cleaned_country[df$cleaned_country == "nordmazedonische:r"] <- "Nordmazedonien"
df$cleaned_country[df$cleaned_country == "norwegische:r"] <- "Norwegen"
df$cleaned_country[df$cleaned_country == "philippinische:r"] <- "Philippinen"
df$cleaned_country[df$cleaned_country == "polnische:r"] <- "Polen"
df$cleaned_country[df$cleaned_country == "portugisische:r"] <- "Portugal"
df$cleaned_country[df$cleaned_country == "puertoricanische:r"] <- "Puerto-Rico"
df$cleaned_country[df$cleaned_country == "ruandische:r"] <- "Ruanda"
df$cleaned_country[df$cleaned_country == "rumänische:r"] <- "Rumänien"
df$cleaned_country[df$cleaned_country == "salvadorianische:r"] <- "El Salvador"
df$cleaned_country[df$cleaned_country == "saudi-arabische:r"] <- "Saudi-Arabien"
df$cleaned_country[df$cleaned_country == "schwedische:r"] <- "Schweden"
df$cleaned_country[df$cleaned_country == "serbische:r"] <- "Serbien"
df$cleaned_country[df$cleaned_country == "simbabwische:r"] <- "Simbabwe"
df$cleaned_country[df$cleaned_country == "slowakische:r"] <- "Slowakei"
df$cleaned_country[df$cleaned_country == "slowenische:r"] <- "Slowenien"
df$cleaned_country[df$cleaned_country == "somalische:r"] <- "Somalia"
df$cleaned_country[df$cleaned_country == "spanische:r"] <- "Spanien"
df$cleaned_country[df$cleaned_country == "srilankische:r"] <- "Sri-Lanka"
df$cleaned_country[df$cleaned_country == "tadschikische:r"] <- "Tadschikistan"
df$cleaned_country[df$cleaned_country == "thailändische:r"] <- "Thailand"
df$cleaned_country[df$cleaned_country == "tunesische:r"] <- "Tunesien"
df$cleaned_country[df$cleaned_country == "türkische:r"] <- "Türkei"
df$cleaned_country[df$cleaned_country == "ugandische:r"] <- "Uganda"
df$cleaned_country[df$cleaned_country == "ungarische:r"] <- "Ungarn"
df$cleaned_country[df$cleaned_country == "venezolanische:r"] <- "Venezuela"
df$cleaned_country[df$cleaned_country == "verdische:r"] <- "Cap Verde"
df$cleaned_country[df$cleaned_country == "zypriotische:r"] <- "Zypern"
df$cleaned_country[df$cleaned_country == "zyprische:r"] <- "Zypern"
df$cleaned_country[df$cleaned_country == "ägyptische:r"] <- "Ägypten"
df$cleaned_country[df$cleaned_country == "äthiopische:r"] <- "Äthiopien"
df$cleaned_country[df$cleaned_country == "krigisische:r"] <- "Kirgisistan"
df$cleaned_country[df$cleaned_country == "zentralafrikanische:r"] <- "Kongo"
df$cleaned_country[df$cleaned_country == "russische:r"] <- "Russland"


#Convert country names from German to English
df$english <- countrycode(df$cleaned_country, "country.name.de", "country.name.en")

df <- df %>% mutate(english = as.character(english))


#Regroup and count the occurrences
df <- df %>%
  group_by(english) %>%
  summarise(count = sum(count))


#Check for mismatches
library(rworldmap)

find_mismatched_codes <- function(df, map, joinCode, nameJoinColumn) {
  # Get the country codes/names from the map
  map_codes <- as.character(rworldmap::getMap()@data[, joinCode])
  
  # Get the country codes/names from the data
  data_codes <- df[[nameJoinColumn]]
  
  # Find which codes/names from the data are not in the map
  mismatched_codes <- setdiff(data_codes, map_codes)
  
  return(mismatched_codes)
}

mismatched_codes <- find_mismatched_codes(df, joinCountryData2Map, "NAME", "english")
print(mismatched_codes)

#Corrections done manually
df$english[df$english == "Antigua & Barbuda"] <- "Antigua and Barbuda"
df$english[df$english == "Bosnia & Herzegovina"] <- "Bosnia and Herzegovina"
df$english[df$english == "Czechia"] <- "Czech Republic"
df$english[df$english == "Côte d’Ivoire"] <- "Ivory Coast"
df$english[df$english == "Dominican Republic"] <- "Dominica"
df$english[df$english == "Myanmar (Burma)"] <- "Myanmar"
df$english[df$english == "North Macedonia"] <- "Macedonia"
df$english[df$english == "Palestinian Territories"] <- "Palestine"
df$english[df$english == "Trinidad & Tobago"] <- "Trinidad and Tobago"

#Drop rows where 'english' is NA
df <- df %>%
  drop_na(english)

merged_df <- joinCountryData2Map(df, joinCode = "NAME", nameJoinColumn = "english")


################Create the map with the log-transformation because of Switzerland as an outlier.

#Load package
library(RColorBrewer)


#Create a color palette with a large number of colors
num_colors <- 100
palette <- colorRampPalette(brewer.pal(9, "Blues"))(num_colors)


#Apply a logarithmic transformation to the count variable
merged_df$log_count <- log(merged_df$count + 1)


#Plot the map with the new color palette and the transformed count variable
Karte_log_ohneAG <- mapCountryData(merged_df, nameColumnToPlot="log_count", catMethod="fixedWidth", colourPalette=palette, mapTitle = "Herkunftsländer der Firmengründer:innen", missingCountryCol = "lightgrey", addLegend = FALSE, 
               borderCol = "black")


#Display the plot
print(Karte_log_ohneAG)


#Now save the plot using the dev.copy function
dev.copy(jpeg, filename = "Karte_log_ohneAG.jpeg", width = 1200, height = 800, units = "px", res = 100)
dev.off()
````


#Plots ohne AGs
Now, all graphs on the company level are recreated after AGs are excluded.
##Company-Level Plots ohne AG's
In the following chunk, we made all plots of the year 2022 on the company level without AGs (that means broken down by legal form, cantons and groups (swiss, foreigners and both together)). The graphics are not based on each other. This means that you don't have to run through the entire section, but can create the graphics independently of each other.
```{r}
#Create a subset of the dataframes excluding AG from Rechtsform column
Firmengründungen2022_ohneAG <- Firmengründungen2022 |> filter(Rechtsform != "AG" | is.na(Rechtsform))

## Barplot "Neugründungen 2022 nach Staatsangehörigkeit der Gründer:innen" ##

barplot_neugründungen2022_ohneAG <- ggplot(Firmengründungen2022_ohneAG, aes(x = Staatsbürgerschaft2)) +
  geom_bar(fill = c("#0028A5", "#A5B5D9", "#F1977A"))  +
  geom_text(aes(label = paste0(round((..count..) / sum(..count..) * 100), "%")), stat = "count", vjust = -0.5, size = 7, color = "black", family = "Times New Roman")+ theme_minimal() + labs(title = "Neugründungen 2022 nach Staatsangehörigkeit der Gründer:innen", x = "", y = "Anzahl")  +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=0), 
        legend.title = element_text(size=20),
        legend.position = "none",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))+
  scale_x_discrete(labels = c("Ausländer:innen", "Schweizer:innen und Ausländer:innen",
                              "Schweizer:innen"))

ggsave("barplot_neugründungen2022_ohneAG.jpg",  barplot_neugründungen2022_ohneAG, height= 8, width=12)

## Barplot "Neugründungen 2022 nach Rechtsform der Unternehmen" ##

#Filter out NA values in the "Rechtsform" column
filtered_na_rechtsform_ohneAG <- Firmengründungen2022_ohneAG[complete.cases(Firmengründungen2022_ohneAG$Rechtsform), ]

#Reorder levels of the "Staatsbürgerschaft2" column for the stacked barplot
filtered_na_rechtsform_ohneAG$Staatsbürgerschaft2 <- factor(filtered_na_rechtsform_ohneAG$Staatsbürgerschaft2,
                                                     levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Define a custom order for the Rechtsform levels (desired sequence of bars)
custom_order <- c("GmbH", "Einzelunternehmen", "Kollektivgesellschaft", "Verein", "Stiftung", "Genossenschaft", "Kommanditgesellschaft")

#Convert Rechtsform to a factor with the custom order
filtered_na_rechtsform_ohneAG$Rechtsform <- factor(filtered_na_rechtsform_ohneAG$Rechtsform, levels = custom_order)
barplot_rechtsform2022_ohneAG <- ggplot(filtered_na_rechtsform_ohneAG, aes(x = Rechtsform, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "stack") +
  theme_minimal() +
  labs(title = "Neugründungen 2022 nach Rechtsform der Unternehmen",
       x = "",
       y = "Anzahl", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) +
  theme(text = element_text(family = "Times New Roman"),
        strip.text.x = element_text(size = 7),
        axis.text.x = element_text(size = 25, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 20),
        legend.text = element_text(size = 22),
        legend.title = element_text(size = 22),
        legend.position = "bottom",
        plot.title = element_text(size = 25, face = "bold"),
        plot.subtitle = element_text(size = 15),
        axis.title = element_text(size = 15))


ggsave("barplot_rechtsform2022_ohneAG.jpg",  barplot_rechtsform2022_ohneAG, height= 16, width=20)

## Stacked Barplot "Anteil Neugründungen 2022 nach Rechtsform" ##

#Filter out NA values in the "Rechtsform" column
filtered_na_rechtsform_ohneAG <- Firmengründungen2022_ohneAG[complete.cases(Firmengründungen2022_ohneAG$Rechtsform), ]

filtered_na_rechtsform_ohneAG$Staatsbürgerschaft2 <- factor(filtered_na_rechtsform_ohneAG$Staatsbürgerschaft2,
                                                     levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

#Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innn zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#create plot
stacked_barplot_staatsbürgerschaft2022_ohneAG <- ggplot(filtered_na_rechtsform_ohneAG, aes(x = Rechtsform, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "fill") +
  theme_minimal() +
  labs(title = "Anteil Neugründungen 2022 nach Rechtsform",
       x = "",
       y = "", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + coord_flip() +
  theme(legend.position = "bottom") +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.text = element_text(size=13), 
        legend.title = element_text(size=13),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18))  + scale_y_continuous(labels = scales::percent)

ggsave("stacked_barplot_staatsbürgerschaft2022_ohneAG.jpg",  stacked_barplot_staatsbürgerschaft2022_ohneAG, height= 8, width=12)

## Barplot "Neugründungen 2022 nach Kantone" ##


#Reorder levels of the "Staatsbürgerschaft2" column for the stacked barplot
Firmengründungen2022_ohneAG$Staatsbürgerschaft2 <- factor(Firmengründungen2022_ohneAG$Staatsbürgerschaft2,
                                                         levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))


## Stacked Barplot "Anteil an Neugründungen 2022 nach Kantone" ##

#Reorder levels of the "Staatsbürgerschaft2" column for the stacked barplot
Firmengründungen2022_ohneAG$Staatsbürgerschaft2 <- factor(Firmengründungen2022_ohneAG$Staatsbürgerschaft2,
                                                   levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

stacked_barplot_kantone2022_ohneAG <- ggplot(Firmengründungen2022_ohneAG, aes(x = cantons, fill = Staatsbürgerschaft2)) +
  geom_bar(position = "fill") + theme_minimal() + labs(title = "Anteil an Neugründungen 2022 nach Kantone",x = "", y = "", fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + coord_flip()+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=12.5),
        legend.title = element_text(size=12.5),
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15)) + scale_y_continuous(labels = scales::percent)

ggsave("stacked_barplot_kantone2022_ohneAG.jpg", stacked_barplot_kantone2022_ohneAG, height= 8, width=12)


#Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

#Create a summary table of counts for each cantons level
cantons_counts <- table(Firmengründungen2022_ohneAG$cantons)

#Order the cantons based on the count in descending order
ordered_cantons <- names(sort(cantons_counts, decreasing = TRUE))

#Convert 'cantons' to a factor with the custom order
Firmengründungen2022_ohneAG$cantons <- factor(Firmengründungen2022_ohneAG$cantons, levels = ordered_cantons)

#create the plot
barplot_kantone2022_ohneAG <- ggplot(Firmengründungen2022_ohneAG, aes(x = cantons, fill = Staatsbürgerschaft2)) +
  geom_bar() + theme_minimal() + labs(title = "Neugründungen 2022 nach Kantone",
                                      x = "", y = "Anzahl", 
                                      fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=13),
        legend.title = element_text(size=13),
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))

ggsave("barplot_kantone2022_ohneAG.jpg", barplot_kantone2022_ohneAG, height= 8, width=12)


```

##Lineplot ohne AG 
In the following chunk, the graphs for the time series without AGs are built (lineplot, areaplot).The graphics are not based on each other. This means that you don't have to run through the entire section, but can create the graphics independently of each other.
```{r}
#Create a subset of the dataframes excluding AG from Rechtsform column
Firmengründungen2019_ohneAG <- subset(Firmengründungen2019, Rechtsform != "AG" | is.na(Rechtsform))
Firmengründungen2020_ohneAG <- subset(Firmengründungen2020, Rechtsform != "AG" | is.na(Rechtsform))
Firmengründungen2021_ohneAG <- subset(Firmengründungen2021, Rechtsform != "AG" | is.na(Rechtsform))

#Create a subset of a dataframe with selected columns
subset_2019_ohneAG <- Firmengründungen2019_ohneAG[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2019_ohneAG$Year <- 2019
subset_2020_ohneAG <- Firmengründungen2020_ohneAG[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2020_ohneAG$Year <- 2020
subset_2021_ohneAG <- Firmengründungen2021_ohneAG[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2021_ohneAG$Year <- 2021
subset_2022_ohneAG <- Firmengründungen2022_ohneAG[, c("Rechtsform", "Staatsbürgerschaft", "Staatsbürgerschaft2")]
subset_2022_ohneAG$Year <- 2022

# Combine the dataframes by row
combined_df_ohneAG <- rbind(subset_2019_ohneAG, subset_2020_ohneAG, subset_2021_ohneAG, subset_2022_ohneAG)

#Lineplot Staatsbürgerschaft2
# Filter the dataframe for the desired years
df_filtered <- combined_df_ohneAG %>% filter(Year %in% c(2019, 2020, 2021, 2022))

# Group the data by Year and Staatsbürgerschaft2 and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Staatsbürgerschaft2) %>%
  tally() %>%
  pivot_wider(names_from = Staatsbürgerschaft2, values_from = n, values_fill = 0)

# Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Category", values_to = "Count")

# Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

# Plot the line chart
linechart_staatsbürgerschaft2_ohneAG <- ggplot(df_long, aes(x = Year, y = Count, color = Category, group = Category)) +
  geom_line(size = 1) +
  geom_point(size = 3) +
  labs(x = "", y = "Anzahl", title = "Gründungen nach Staatsangehörigkeit 2019-2022", color = "Neugründung durch:") +
  scale_color_manual(values = c("#0028A5", "#F1977A", "#A5B5D9"), labels=custom_labels) +
  theme_minimal() +
  theme(legend.title = element_blank(),
        legend.position = "top") +
  guides(color = guide_legend(title = "Category"))+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))

ggsave("linechart_staatsbürgerschaft2_ohneAG.jpg", linechart_staatsbürgerschaft2_ohneAG, height= 8, width=12)

#Linechart nach Rechtsform
# Filter out NAs in the Rechtsform variable
data_filtered <- combined_df_ohneAG %>%
  filter(!is.na(Rechtsform))

# Filter the dataframe for the 4 years
df_filtered <- data_filtered %>% filter(Year %in% c(2019, 2020, 2021, 2022))

# Group the data by Year and Rechtsform and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Rechtsform) %>%
  tally() %>%
  pivot_wider(names_from = Rechtsform, values_from = n, values_fill = 0)

# Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Rechtsform", values_to = "Count")

# Plot the line chart
linechart_rechtsform_ohneAG <- ggplot(df_long, aes(x = Year, y = Count, color = Rechtsform, group = Rechtsform)) +
  geom_line(size = 1) +
  geom_point(size = 3) +
  labs(x = "", y = "Anzahl", title = "Gründung nach Rechtsformen über die Zeit", color = "Rechtsform") +
  scale_color_manual(values = c("red", "blue", "green", "purple", "orange", "cyan", "magenta", "yellow")) +
  theme_minimal() +
  theme(legend.title = element_blank(),
        legend.position = "bottom") +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))+
  guides(color = guide_legend(title = "Rechtsform"))

ggsave("linechart_rechtsform_ohneAG.jpg", linechart_rechtsform_ohneAG, width = 12, height = 8)

#Areachart
# Filter the dataframe for the 4 years
df_filtered <- combined_df_ohneAG %>% filter(Year %in% c(2019, 2020, 2021, 2022))

# Group the data by Year and Staatsbürgerschaft2 and count the occurrences
grouped_df <- df_filtered %>%
  group_by(Year, Staatsbürgerschaft2) %>%
  tally() %>%
  pivot_wider(names_from = Staatsbürgerschaft2, values_from = n, values_fill = 0)

# Reshape the dataframe to a longer format for plotting
df_long <- grouped_df %>%
  pivot_longer(cols = -Year, names_to = "Staatsbürgerschaft2", values_to = "Count")

# Define the order of levels for Staatsbürgerschaft2
df_long$Staatsbürgerschaft2 <- factor(df_long$Staatsbürgerschaft2, levels = c("Ausländer", "Schweizer und Ausländer", "Schweizer"))

# Define custom category labels
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer:innen",
                   "Schweizer und Ausländer" = "Schweizer:innen & Ausländer:innen zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer:innen")

# Plot the area chart
areachart_staatsangehörigkeit2_ohneAG <- ggplot(df_long, aes(x = Year, y = Count, fill = Staatsbürgerschaft2)) +
  geom_area(position = "stack", alpha = 0.7) +
  labs(x = "", y = "Anzahl", title = "Gründer:innen nach Herkunft über die Zeit", fill = "Neugründung durch:") +
  scale_fill_manual(values = c("#0028A5", "#A5B5D9", "#F1977A"), labels=custom_labels) +
  theme_minimal()+
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16),
        legend.position = "bottom",
        legend.text = element_text(size=13),
        legend.title = element_text(size=13),
        legend.justification = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=15))


ggsave("areachart_staatsangehörigkeit2_ohneAG.jpg", areachart_staatsangehörigkeit2_ohneAG, width = 12, height = 8)
```



##Plots on individual level ohne AG
Redoing the plots on individual level but excluding AG's. Thus the nationality counting has to be done again
```{r}
# Load the necessary libraries
library(dplyr)
library(tidyr)
library(ggplot2)

# Create a new data frame with a separate row for each person's nationality
nationality_data <- data.frame(owner_nationality_wcomp2 = Firmengründungen2022_ohneAG$owner_nationality_wcomp2,
                               id = seq_along(Firmengründungen2022_ohneAG$owner_nationality_wcomp2))

nationality_data <- nationality_data %>%
  separate_rows(owner_nationality_wcomp2, sep = "[,;]\\s*") %>%
  rename(nationality = owner_nationality_wcomp2)

# Count the occurrences of each nationality
nationality_counts <- nationality_data %>%
  group_by(nationality) %>%
  summarise(count = n()) %>%
  arrange(desc(count))


# Create a mapping of non-German expressions to German expressions
mapping <- c(
  "Swiss" = "schweizer Staatsangehörige:r",
  "cittadina italiana" = "italienische:r Staatsangehörige:r",
  "cittadino italiano" = "italienische:r Staatsangehörige:r",
  "Italie" = "italienische:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "cittadina brasiliana" = "brasilianische:r Staatsangehörige:r",
  "cittadino brasiliano" = "brasilianische:r Staatsangehörige:r",
  "Brésil" = "brasilianische:r Staatsangehörige:r",
  "brasilianische Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "brasilianischer Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "France" = "französische:r Staatsangehörige:r",
  "französischer Staatsangehörige" = "französische:r Staatsangehörige:r",
  "französische Staatsangehörige" = "französische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutscher Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "Allemagne" = "deutsche:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutsche Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "cittadina germanica" = "deutsche:r Staatsangehörige:r",
  "cittadino germanico" = "deutsche:r Staatsangehörige:r",
  "kosovarischer Staatsangehörige" = "kosovarische:r Staatsangehörige:r",
  "kosovarische Staatsangehörige" = "kosovarische:r Staatsangehörige:r", 
  "Kosovo" = "kosovarische:r Staatsangehörige:r",
  "Portugal" = "portugisische:r Staatsangehörige:r",
  "portugiesischer Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "portugiesische Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "türkischer Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "türkische Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "Turquie" = "türkische:r Staatsangehörige:r",
  "nordmazedonischer Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "nordmazedonische Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "österreichischer Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "österreichische Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "serbischer Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "serbische Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "syrischer Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "syrische Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "spanischer Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "spanische Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "Espagne" = "spanische:r Staatsangehörige:r",
  "britischer Staatsangehörige" = "britische:r Staatsangehörige:r",
  "britische Staatsangehörige" = "britische:r Staatsangehörige:r",
  "cittadina britannica" = "britische:r Staatsangehörige:r",
  "cittadino britannico" = "britische:r Staatsangehörige:r",
  "niederländischer Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "niederländische Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "kroatischer Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "kroatische Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "ungarischer Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "ungarische Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "rumänischer Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "rumänische Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "Roumanie" = "rumänische:r Staatsangehörige:r",
  "polnischer Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "polnische Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "amerikanischer Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "amerikanische Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "herzegowinischer Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "Belgique" = "belgische:r Staatsangehörige:r",
  "belgische Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "belgischer Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "bulgarischer Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "bulgarische Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "Bulgarie" = "bulgarische:r Staatsangehörige:r",
  "cittadina bulgara" = "bulgarische:r Staatsangehörige:r",
  "cittadino bulgaro" = "bulgarische:r Staatsangehörige:r",
  "slowakischer Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "slowakische Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "Dominique" = "domenikanische:r Staatsangehörige:r",
  "domenikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "domenikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "République dominicaine" = "domenikanische:r Staatsangehörige:r",
  "Maurice" = "mauritische:r Staatsangehörige:r",
  "mauritische Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "mauritischer Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "lankischer Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "lankische Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "afghanischer Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "afghanische Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "Afghanistan" = "afghanische:r Staatsangehörige:r",
  "cittadina afghana" = "afghanische:r Staatsangehörige:r",
  "cittadino afghano" = "afghanische:r Staatsangehörige:r",
  "Malte" = "maltesische:r Staatsangehörige:r",
  "maltesischer Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "ukrainische Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "ukrainischer Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "Ukraine" = "ukrainische:r Staatsangehörige:r",
  "indischer Staatsangehörige" = "indische:r Staatsangehörige:r",
  "indische Staatsangehörige" = "indische:r Staatsangehörige:r",
  "thailändische Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "thailändischer Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "chinesischer Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "chinesische Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "cittadina cinese" = "chinesische:r Staatsangehörige:r",
  "cittadino cinese" = "chinesische:r Staatsangehörige:r",
  "Afrique du Sud" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanische Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanischer Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "ägyptische Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "ägyptischer Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "albanische Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "albanischer Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "Albanie" = "albanische:r Staatsangehörige:r",
  "cittadina albanese" = "albanische:r Staatsangehörige:r",
  "cittadino albanese" = "albanische:r Staatsangehörige:r",
  "algerische Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "algerischer Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "Algérie" = "albanische:r Staatsangehörige:r",
  "angolanischer Staatsangehörige" = "angolanische:r Staatsangehörige:r",
  "Angola" = "angolanische:r Staatsangehörige:r",
  "Arabie saoudite" = "saudi-arabische:r Staatsangehörige:r",
  "argentinische Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "argentinischer Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "Argentine" = "argentinische:r Staatsangehörige:r",
  "armenische Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "armenischer Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "Arménie" = "armenische:r Staatsangehörige:r",
  "aserbaidschanische Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "aserbaidschanischer Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "Azerbaïdjan" = "aserbaidschanische:r Staatsangehörige:r",
  "äthiopische Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "äthiopischer Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "Autriche" = "österreichische:r Staatsangehörige:r",
  "Australie" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "cittadina austriaca"  = "australische:r Staatsangehörige:r",
  "cittadina austriaco"  = "australische:r Staatsangehörige:r",
  "Bangladesh" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschischer Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschische Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "belarussische Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "belarussischer Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "bolivianische Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "bolivianischer Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "Bolivie" = "bolivianische:r Staatsangehörige:r",
  "bosnische Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "bosnischer Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "Bosnie-Herzégovine" = "bosnische:r Staatsangehörige:r",
  "cittadina bosniaca" = "bosnische:r Staatsangehörige:r",
  "cittadino bosniaco" = "bosnische:r Staatsangehörige:r",
  "burundischer Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "burundische Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "kamerunische Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "kamerunischer Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "Cameroun" = "kamerunische:r Staatsangehörige:r",
  "Canada" = "kanadische:r Staatsangehörige:r",
  "kanadischer Staatsangehörige" = "kanadische:r Staatsangehörige:r", 
  "kanadische Staatsangehörige" = "kanadische:r Staatsangehörige:r",
  "chilenische Staatsangehörige" = "chilenische:r Staatsangehörige:r", 
  "chilenischer Staatsangehörige" = "chilenische:r Staatsangehörige:r",
  "Chili" = "chilenische:r Staatsangehörige:r",
  "Chine" = "chinesische:r Staatsangehörige:r",
  "botsuanische Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "botsuanischer Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "Botswana" = "botsuanische:r Staatsangehörige:r",
  "Burundi" = "burundische:r Staatsangehörige:r",
  "beninischer Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "beninische Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "Bénin" = "beninische:r Staatsangehörige:r",
  "Biélorussie" = "weiss-russische:r Staatsangehörige:r",
  "cittadina bielorussa" = "weiss-russische:r Staatsangehörige:r",
  "Bermudes" = "bermudische:r Staatsangehörige:r",
  "Burkina Faso" = "burkinische:r Staatsangehörige:r",
  "Cambodge" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanische Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanischer Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "Kazakhstan" = "kasachische:r Staatsangehörige:r",
  "kasachische Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "kasachischer Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "zyprischer Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "zyprische Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "Chypre" = "zyprische:r Staatsangehörige:r",
  "cittadina ceca" = "tschechische:r Staatsangehörige:r",
  "cittadino ceco" = "tschechische:r Staatsangehörige:r",
  "tschechische Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "tschechischer Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "cittadina colombiana" = "kolumbianische:r Staatsangehörige:r",
  "cittadino colombiano" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianische Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianischer Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "vietnamesische Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "vietnamesischer Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "Vietnam" = "vietnamesische:r Staatsangehörige:r",
  "venezolanische Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "venezolanischer Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "Venezuela" = "venezolanische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "uruguayischer Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "uruguayische Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "ugandische Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "ugandischer Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "tunesische Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "tunesischer Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "Tunisie" = "tunesische:r Staatsangehörige:r",
  "togoische Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "togoischer Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "Togo" = "togoische:r Staatsangehörige:r",
  "Thaïlande" = "thailändische:r Staatsangehörige:r",
  "taiwanische Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "taiwanischer Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "Taïwan" = "taiwanische:r Staatsangehörige:r",
  "tadschikische Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "tadschikischer Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "Syrie" = "syrische:r Staatsangehörige:r",
  "Suède" = "schwedische:r Staatsangehörige:r",
  "schwedische Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "schwedischer Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "südkoreanische Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "südkoreanischer Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "Sri Lanka" = "srilankische:r Staatsangehörige:r",
  "somalische Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "somalischer Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "Somalie" = "somalische:r Staatsangehörige:r",
  "slowenische Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "slowenischer Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "Slovénie" = "slowenische:r Staatsangehörige:r",
  "Slovaquie" = "slowakische:r Staatsangehörige:r",
  "singapurische Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "singapurischer Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "Singapour" = "singapurische:r Staatsangehörige:r",
  "Serbie" = "serbische:r Staatsangehörige:r",
  "senegalesische Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "senegalesischer Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "Sénégal" = "senegalesische:r Staatsangehörige:r",
  "salvadorianische Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "salvadorianischer Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "Salvador" = "salvadorianische:r Staatsangehörige:r",
  "russische Staatsangehörige" = "russische:r Staatsangehörige:r",
  "russischer Staatsangehörige" = "russische:r Staatsangehörige:r",
  "Russie" = "russische:r Staatsangehörige:r",
  "Royaume-Uni" = "britische:r Staatsangehörige:r",
  "Pologne" = "polnische:r Staatsangehörige:r",
  "philippinische Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "philippinischer Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "Philippines" = "philippinische:r Staatsangehörige:r",
  "peruanische Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "peruanischer Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "Pérou" = "peruanische:r Staatsangehörige:r",
  "Pays-Bas" = "niederländische:r Staatsangehörige:r",
  "panamaische Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "panamaischer Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "Panama" = "panamaische:r Staatsangehörige:r",
  "pakistanische Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "pakistanischer Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "Pakistan" = "pakistanische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "Ouzbékistan" = "usbekische:r Staatsangehörige:r",
  "norwegische Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "norwegischer Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "Norvège" = "norwegische:r Staatsangehörige:r",
  "nigerianischer Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "nigerianische Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "Nigéria" = "nigerianische:r Staatsangehörige:r",
  "nicaraguanischer Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "nicaraguanische Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "neuseeländischer Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "neuseeländische Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "montenegrinischer Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "montenegrinische Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "Monténégro" = "montenegrinische:r Staatsangehörige:r",
  "mongolischer Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "mongolische Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "Mongolie" = "mongolische:r Staatsangehörige:r",
  "mexikanischer Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "mexikanische Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "Mexique" = "mexikanische:r Staatsangehörige:r",
  "mazedonische Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "mazedonischer Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "marokkanische Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "marokkanischer Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "Maroc" = "marokkanische:r Staatsangehörige:r",
  "malaysische Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "malaysischer Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "Malaisie" = "malaysische:r Staatsangehörige:r",
  "madagassische Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "madagassischer Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "Madagascar" = "malaysische:r Staatsangehörige:r",
  "luxemburgische Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "luxemburgischer Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "Luxembourg" = "luxemburgische:r Staatsangehörige:r",
  "litauische Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "litauischer Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "Lituanie" = "litauische:r Staatsangehörige:r",
  "liechtensteinische Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "liechtensteinischer Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "libanesische Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "libanesischer Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "Liban" = "libanesische:r Staatsangehörige:r",
  "libysche Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "libyscher Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "Libye" = "libysche:r Staatsangehörige:r",
  "lybischer Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lybische Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lettische Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "lettischer Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "Lettonie" = "lettische:r Staatsangehörige:r",
  "kubanische Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "kubanischer Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "jemenitische Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "jemenitischer Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "japanische Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "japanischer Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "Japon" = "japanische:r Staatsangehörige:r",
  "jamaikanische Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "jamaikanischer Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "Jamaïque" = "jamaikanische:r Staatsangehörige:r",
  "italianischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "ivorische Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "ivorischer Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "israelische Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "israelischer Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "Israël" = "israelische:r Staatsangehörige:r",
  "isländische Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "isländischer Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "irische Staatsangehörige" = "irische:r Staatsangehörige:r",
  "irischer Staatsangehörige" = "irische:r Staatsangehörige:r",
  "Irlande" = "irische:r Staatsangehörige:r",
  "iranische Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "iranischer Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "Iran" = "iranische:r Staatsangehörige:r",
  "irakische Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "irakischer Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "Irak" = "irakische:r Staatsangehörige:r",
  "indonesische Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "indonesischer Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "Indonésie" = "indonesische:r Staatsangehörige:r",
  "Inde" = "indische:r Staatsangehörige:r",
  "hongkonger Staatsangehörige" = "hongkonger:r Staatsangehörige:r",
  "Hongrie" = "ungarische:r Staatsangehörige:r",
  "honduranischer Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "honduranische Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "guineischer Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "guineische Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "Guinée" = "guineische:r Staatsangehörige:r",
  "grenadischer Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "grenadische Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "Grenade" = "grenadische:r Staatsangehörige:r",
  "Grèce" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "Ghana" = "ghanaische:r Staatsangehörige:r",
  "ghanaische Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "ghanaischer Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "georgische Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "georgischer Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "Géorgie" = "georgische:r Staatsangehörige:r",
  "gabunische Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gabunischer Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gambischer Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "gambische Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "finnische Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "finnischer Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "Finlande" = "finnische:r Staatsangehörige:r",
  "estnische Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "estnischer Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "eritreische Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "eritreischer Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "Érythrée" = "eritreische:r Staatsangehörige:r",
  "ecuadorianische Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "ecuadorianischer Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "Équateur" = "ecuadorianische:r Staatsangehörige:r",
  "dänische Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "dänischer Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "Danemark" = "dänische:r Staatsangehörige:r",
  "Cuba" = "kubanische:r Staatsangehörige:r", 
  "Croatie" = "kroatische:r Staatsangehörige:r", 
  "Costa Rica" = "costaricanische:r Staatsangehörige:r", 
  "Corée du Sud" = "südkoreanische:r Staatsangehörige:r", 
  "Colombie" = "kolumbianische:r Staatsangehörige:r", 
  "cittadino venezuelano" = "venezolanische:r Staatsangehörige:r",
  "cittadina venezuelana" = "venezolanische:r Staatsangehörige:r",
  "cittadino ungherese" = "ungarische:r Staatsangehörige:r",
  "cittadino ucraino" = "ukrainische:r Staatsangehörige:r",
  "cittadina ucraina" = "ukrainische:r Staatsangehörige:r",
  "cittadino turco" = "türkische:r Staatsangehörige:r", 
  "cittadina svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadina statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadino spagnolo" = "spanische:r Staatsangehörige:r", 
  "cittadina spagnola" = "spanische:r Staatsangehörige:r", 
  "cittadino sloveno" = "slowenische:r Staatsangehörige:r", 
  "cittadina slovena" = "slowenische:r Staatsangehörige:r", 
  "cittadino siriano" = "syrische:r Staatsangehörige:r",
  "cittadina slovacca" = "slowakische:r Staatsangehörige:r",
  "cittadina croata" = "kroatische:r Staatsangehörige:r",
  "cittadino croato" = "kroatische:r Staatsangehörige:r",
  "cittadina danese" = "dänische:r Staatsangehörige:r",
  "cittadino danese" = "dänische:r Staatsangehörige:r",
  "cittadina cubano" = "kubanische:r Staatsangehörige:r",
  "cittadina domenicana" = "domenikanische:r Staatsangehörige:r",
  "cittadina eritrea" = "eritreische:r Staatsangehörige:r",
  "cittadino russo" = "russische:r Staatsangehörige:r",
  "cittadina russa" = "russische:r Staatsangehörige:r",
  "Cap-Vert" = "kapverdische:r Staatsangehörige:r",
  "cittadina francese" = "französische:r Staatsangehörige:r",
  "cittadina giapponese" = "japanische:r Staatsangehörige:r",
  "cittadina greca" = "griechische:r Staatsangehörige:r",
  "cittadina iraniana" = "iranische:r Staatsangehörige:r",
  "cittadina kazaka" = "kasachische:r Staatsangehörige:r",
  "cittadina kosovara" = "kosovarische:r Staatsangehörige:r",
  "cittadina lettone" = "lettische:r Staatsangehörige:r",
  "cittadina libanese" = "libanesische:r Staatsangehörige:r",
  "cittadina lituana" = "litauische:r Staatsangehörige:r",
  "cittadina macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadina messicana" = "mexikanische:r Staatsangehörige:r",
  "cittadina moldova" = "moldavische:r Staatsangehörige:r",
  "cittadina norvegese" = "norwegische:r Staatsangehörige:r",
  "cittadina olandese" = "niederländische:r Staatsangehörige:r",
  "cittadina polacca" = "polnische:r Staatsangehörige:r",
  "cittadina portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadina romena" = "rumänische:r Staatsangehörige:r",
  "cittadina serba" = "serbische:r Staatsangehörige:r",
  "cittadino angolano" = "angolanische:r Staatsangehörige:r",
  "cittadino austriaco" = "österreichische:r Staatsangehörige:r",
  "cittadino belga" = "belgische:r Staatsangehörige:r",
  "cittadino boliviano" = "bolivianische:r Staatsangehörige:r",
  "cittadino cileno" = "chilenische:r Staatsangehörige:r",
  "cittadino cubano" = "kubanische:r Staatsangehörige:r",
  "cittadino ecuadoriano" = "ecuadorianische:r Staatsangehörige:r",
  "cittadino finlandese" = "finnische:r Staatsangehörige:r",
  "cittadino francese" = "französische:r Staatsangehörige:r",
  "cittadino greco" = "griechische:r Staatsangehörige:r",
  "cittadino iracheno" = "irakische:r Staatsangehörige:r",
  "cittadino irlandese" = "irische:r Staatsangehörige:r",
  "cittadino kosovaro" = "kosovarische:r Staatsangehörige:r",
  "cittadino lettone" = "lettische:r Staatsangehörige:r",
  "cittadino macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadino marocchino" = "marokkanische:r Staatsangehörige:r",
  "cittadino messicano" = "mexikanische:r Staatsangehörige:r",
  "cittadino montenegrino" = "montenegrinische:r Staatsangehörige:r",
  "cittadino olandese" = "niederländische:r Staatsangehörige:r",
  "cittadino polacco" = "polnische:r Staatsangehörige:r",
  "cittadino portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadino senegalese" = "senegalesische:r Staatsangehörige:r",
  "cittadino serbo" = "serbische:r Staatsangehörige:r",
  "cittadino tunisino" = "tunesische:r Staatsangehörige:r",
  "Curaçao" = "Curaçaoënarische:r Staatsangehörige:r",
  "Gibraltar" = "gibraltaische:r Staatsangehörige:r",
  "Honduras" = "honduranische:r Staatsangehörige:r",
  "jordanischer Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "jordanische Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "Jordanie" = "jordanische:r Staatsangehörige:r",
  "Koweït" = "kuweitische:r Staatsangehörige:r",
  "Macédoine du Nord" = "nordmazedonische:r Staatsangehörige:r",
  "Moldavie" = "moldavische:r Staatsangehörige:r",
  "Nicaragua" = "nicaraguanische:r Staatsangehörige:r",
  "Niger" = "nigeranische:r Staatsangehörige:r",
  "Nouvelle-Zélande" = "neuseeländische:r Staatsangehörige:r",
  "Ouganda" = "ugandische:r Staatsangehörige:r",
  "Paraguay" = "paraguayanische:r Staatsangehörige:r",
  "ruandischer Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ruandische Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ricanischer Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "ricanische Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "Tchéquie" = "tschechische:r Staatsangehörige:r",
  "Yémen" = "jemenitische:r Staatsangehörige:r",
  "cittadina di" = "unbekannte Staatsangehörigkeit",
  "cittadino di" = "unbekannte Staatsangehörigkeit",
  "cittadino romeno"  = "rumänische:r Staatsangehörige:r",
  "unbekannte Staatsangehörig" = "unbekannte Staatsangehörigkeit",
  "Mali" = "malische:r Staatsangehörige:r",
  "Monaco" = "monegassische:r Staatsangehörige:r",
  "République centrafricaine" = "zentralafrikanische:r Staatsangehörige:r",
  "andorrine Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "andorriner Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "arabische Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "arabischer Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "burkinischer Staatsangehörige" = "burkinische:r Staatsangehörige:r",
  "cittadino argentino" = "argentinische:r Staatsangehörige:r",
  "cittadino australiano" = "australische:r Staatsangehörige:r",
  "cittadino canadese" = "kanadische:r Staatsangehörige:r",
  "cittadino cipriota" = "zyprische:r Staatsangehörige:r",
  "cittadino indiano" = "indische:r Staatsangehörige:r",
  "cittadino lussemburghese" = "luxemburgische:r Staatsangehörige:r",
  "cittadino norvegese" = "norwegische:r Staatsangehörige:r",
  "guatemaltekischer Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "guatemaltekische Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "haitianischer Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "haitianische Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "Kirghizistan" = "krigisische:r Staatsangehörige:r",
  "krigisische Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "krigisischer Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "kiribatischer Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "kiribatische Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "moldauische Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "moldauischer Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "mosambikanische Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "mosambikanischer Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "myanmarische Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "myanmarischer Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "namibische Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "namibischer Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "nepalesische Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "nepalesischer Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "Soudan" = "sudanesische:r Staatsangehörige:r",
  "sudanesische Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "sudanesischer Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "kenianische Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "kenianischer Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "palästinischer Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "palästinische Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "paraguayische Staatsangehörige" = "paraguayanische:r Staatsangehörige:r",
  "antiguanischer Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "antiguanische Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "simbabwischer Staatsangehörige" = "simbabwische:r Staatsangehörige:r",
  "simbabwische Staatsangehörige" = "simbabwische:r Staatsangehörige:r", 
  "Jersey" = "jerseyische:r Staatsangehörige:r",
  "Émirats arabes unis" = "emiratische:r Staatsangehörige:r",
  "Estonie" = "estnische:r Staatsangehörige:r",
  "Fidji" = "fidschianische:r Staatsangehörige:r",
  "Qatar" = "katarische:r Staatsangehörige:r",
  "Montserrat" = "montserratische:r Staatsangehörige:r",
  "Liechtenstein" = "liechtensteinische:r Staatsangehörige:r",
  "Uruguay" = "uruguayische:r Staatsangehörige:r",
  "Éthiopie" = "ethiopische:r Staatsangehörige:r",
  "Kenya" = "kenianische:r Staatsangehörige:r",
  "Maldives" = "maledivische:r Staatsangehörige:r",
  "Mozambique" = "mosambikanische:r Staatsangehörige:r",
  "Rwanda" = "ruandische:r Staatsangehörige:r",
  "Trinité-et-Tobago" = "trinidadianische und tobagoische:r Staatsangehörige:r",
  "citoyen afghan" = "afghanische:r Staatsangehörige:r",
  "ressortissant afghan" = "afghanische:r Staatsangehörige:r",
  "citoyen algérien" = "algerische:r Staatsangehörige:r",
  "citoyen allemand" = "deutsche:r Staatsangehörige:r",
  "citoyen américain" = "amerikanische:r Staatsangehörige:r",
  "citoyen arménien" = "armenische:r Staatsangehörige:r",
  "citoyen australien" = "australische:r Staatsangehörige:r",
  "citoyen belge" = "belgische:r Staatsangehörige:r",
  "citoyen bosniaque" = "bosnische:r Staatsangehörige:r",
  "citoyen brésilien" = "brasilianische:r Staatsangehörige:r",
  "citoyen britannique" = "britische:r Staatsangehörige:r",
  "citoyen bulgare" = "bulgarische:r Staatsangehörige:r",
  "citoyen danois" = "dänische:r Staatsangehörige:r",
  "citoyen espagnol" = "spanische:r Staatsangehörige:r",
  "citoyen français" = "französische:r Staatsangehörige:r",
  "citoyen hongrois" = "ungarische:r Staatsangehörige:r",
  "citoyen indien" = "indische:r Staatsangehörige:r",
  "citoyen irlandais" = "irische:r Staatsangehörige:r",
  "citoyen italien" = "italienische:r Staatsangehörige:r",
  "citoyen kosovar" = "kosovarische:r Staatsangehörige:r",
  "citoyen letton" = "lettische:r Staatsangehörige:r",
  "citoyen macédonien" = "mazedonische:r Staatsangehörige:r",
  "citoyen moldave" = "moldavische:r Staatsangehörige:r",
  "citoyen néerlandais" = "niederländische:r Staatsangehörige:r",
  "citoyen péruvien" = "peruanische:r Staatsangehörige:r",
  "citoyen polonais" = "polnische:r Staatsangehörige:r",
  "citoyen portugais" = "portugisische:r Staatsangehörige:r",
  "citoyen roumain" = "rumänische:r Staatsangehörige:r",
  "citoyen sénégalais" = "senegalesische:r Staatsangehörige:r",
  "citoyen serbe" = "serbische:r Staatsangehörige:r",
  "citoyen slovaque" = "slowakische:r Staatsangehörige:r",
  "citoyen somalien" = "somalische:r Staatsangehörige:r",
  "citoyen sri" = "srilankische:r Staatsangehörige:r",
  "ressortissant sri" = "srilankische:r Staatsangehörige:r",
  "ressortissante sri" = "srilankische:r Staatsangehörige:r",
  "citoyen suédois" = "schwedische:r Staatsangehörige:r",
  "citoyen syrien" = "syrische:r Staatsangehörige:r",
  "citoyen tchèque" = "tschechische:r Staatsangehörige:r",
  "citoyen turc" = "türkische:r Staatsangehörige:r",
  "citoyen ukrainien" = "ukrainische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "österreichische:r Staatsangehörige:r",
  "citoyenne belge" = "belgische:r Staatsangehörige:r",
  "citoyenne brésilienne" = "brasilianische:r Staatsangehörige:r",
  "citoyenne britannique" = "britische:r Staatsangehörige:r",
  "citoyenne chinoise" = "chinesische:r Staatsangehörige:r",
  "citoyenne espagnole" = "spanische:r Staatsangehörige:r",
  "citoyenne française" = "französische:r Staatsangehörige:r",
  "citoyenne guineische" = "guineische:r Staatsangehörige:r",
  "citoyenne hongroise" = "ungarische:r Staatsangehörige:r",
  "citoyenne irlandaise" = "irische:r Staatsangehörige:r",
  "citoyenne italienne" = "italienische:r Staatsangehörige:r",
  "citoyenne kosovare" = "kosovarische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "mazedonische:r Staatsangehörige:r",
  "citoyenne marocaine" = "marokkanische:r Staatsangehörige:r",
  "citoyenne néo" = "neuseeländische:r Staatsangehörige:r",
  "citoyenne polonaise" = "polnische:r Staatsangehörige:r",
  "citoyenne portugaise" = "portugisische:r Staatsangehörige:r",
  "citoyenne roumaine" = "rumänische:r Staatsangehörige:r",
  "citoyenne russe" = "russische:r Staatsangehörige:r",
  "citoyenne rwandaise" = "ruandische:r Staatsangehörige:r",
  "citoyenne turque" = "türkische:r Staatsangehörige:r",
  "citoyenne ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "Grande-Bretagne" = "britische:r Staatsangehörige:r",
  "Mauritanie" = "mauretanische:r Staatsangehörige:r",
  "ressortissant albanais" = "albanische:r Staatsangehörige:r",
  "ressortissant algérien" = "algerische:r Staatsangehörige:r",
  "ressortissant allemand" = "deutsche:r Staatsangehörige:r",
  "ressortissant américain" = "amerikanische:r Staatsangehörige:r",
  "ressortissant autrichien" = "österreichische:r Staatsangehörige:r",
  "ressortissant belge" = "belgische:r Staatsangehörige:r",
  "ressortissant bosniaque" = "bosnische:r Staatsangehörige:r",
  "ressortissant brésilien" = "brasilianische:r Staatsangehörige:r",
  "ressortissant britannique" = "britische:r Staatsangehörige:r",
  "ressortissant bulgare" = "bulgarische:r Staatsangehörige:r",
  "ressortissant camerounais" = "kamerunische:r Staatsangehörige:r",
  "ressortissant canadien" = "kanadische:r Staatsangehörige:r",
  "ressortissant chinois" = "chinesische:r Staatsangehörige:r",
  "ressortissant croate" = "kroatische:r Staatsangehörige:r",
  "ressortissant érythréen" = "eritreische:r Staatsangehörige:r",
  "ressortissant espagnol" = "spanische:r Staatsangehörige:r",
  "ressortissant français" = "französische:r Staatsangehörige:r",
  "ressortissant hongrois" = "ungarische:r Staatsangehörige:r",
  "ressortissant indien" = "indische:r Staatsangehörige:r",
  "ressortissant iranien" = "iranische:r Staatsangehörige:r",
  "ressortissant iraquien" = "irakische:r Staatsangehörige:r",
  "ressortissant italien" = "italienische:r Staatsangehörige:r",
  "ressortissant ivoirien" = "ivorische:r Staatsangehörige:r",
  "ressortissant kosovar" = "kosovarische:r Staatsangehörige:r",
  "ressortissant libanais" = "libanesische:r Staatsangehörige:r",
  "ressortissant lituanien" = "lituanische:r Staatsangehörige:r",
  "ressortissant macédonien" = "mazedonische:r Staatsangehörige:r",
  "ressortissant malgache" = "madagassische:r Staatsangehörige:r",
  "ressortissant marocain" = "marokkanische:r Staatsangehörige:r",
  "ressortissant mauricien" = "mauritische:r Staatsangehörige:r",
  "ressortissant mexicain" = "mexikanische:r Staatsangehörige:r",
  "ressortissant monténégrin" = "montenegrinische:r Staatsangehörige:r",
  "ressortissant polonais" = "polnische:r Staatsangehörige:r",
  "ressortissant portugais" = "portugisische:r Staatsangehörige:r",
  "ressortissant roumain" = "rumänische:r Staatsangehörige:r",
  "ressortissant russe" = "russische:r Staatsangehörige:r",
  "ressortissant rwandais" = "ruandische:r Staatsangehörige:r",
  "ressortissant serbe" = "serbische:r Staatsangehörige:r",
  "ressortissant slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissant somalien" = "somalische:r Staatsangehörige:r",
  "ressortissant syrien" = "syrische:r Staatsangehörige:r",
  "ressortissant thaïlandais" = "thailändische:r Staatsangehörige:r",
  "ressortissant tunisien" = "tunesische:r Staatsangehörige:r",
  "ressortissant turc" = "türkische:r Staatsangehörige:r",
  "ressortissante algérienne" = "algerische:r Staatsangehörige:r",
  "ressortissante allemande" = "deutsche:r Staatsangehörige:r",
  "ressortissante américaine" = "amerikanische:r Staatsangehörige:r",
  "ressortissante belge" = "belgische:r Staatsangehörige:r",
  "ressortissante béninoise" = "beninische:r Staatsangehörige:r",
  "ressortissante brésilienne" = "brasilianische:r Staatsangehörige:r",
  "ressortissante britannique" = "britische:r Staatsangehörige:r",
  "ressortissante burkinabè" = "burkinische:r Staatsangehörige:r",
  "ressortissante chinoise" = "chinesische:r Staatsangehörige:r",
  "ressortissante coréenne" = "südkoreanische:r Staatsangehörige:r",
  "ressortissante croate" = "koratische:r Staatsangehörige:r",
  "ressortissante dominicaine" = "domenikanische:r Staatsangehörige:r",
  "ressortissante espagnole" = "spanische:r Staatsangehörige:r",
  "ressortissante française" = "französische:r Staatsangehörige:r",
  "ressortissante gabonaise" = "gabunische:r Staatsangehörige:r",
  "ressortissante indienne" = "indische:r Staatsangehörige:r",
  "ressortissante italienne" = "italienische:r Staatsangehörige:r",
  "ressortissante ivoirienne" = "ivorische:r Staatsangehörige:r",
  "ressortissante kosovare" = "kosovarische:r Staatsangehörige:r",
  "ressortissante lettone" = "lettische:r Staatsangehörige:r",
  "ressortissante libanaise" = "libanesische:r Staatsangehörige:r",
  "ressortissante marocaine" = "marokkanische:r Staatsangehörige:r",
  "ressortissante mauricienne" = "mauritische:r Staatsangehörige:r",
  "ressortissante paraguayenne" = "paraguayanische:r Staatsangehörige:r",
  "ressortissante polonaise" = "polnische:r Staatsangehörige:r",
  "ressortissante portugaise" = "portugisische:r Staatsangehörige:r",
  "ressortissante roumaine" = "rumänische:r Staatsangehörige:r",
  "ressortissante russe" = "russische:r Staatsangehörige:r",
  "ressortissante slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissante syrienne" = "syrische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante thaïlandaise" = "thailändische:r Staatsangehörige:r",
  "ressortissante tunisienne" = "tunesische:r Staatsangehörige:r",
  "ressortissante turque" = "türkische:r Staatsangehörige:r",
  "ressortissante ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "ressortissante vietnamienne" = "vietnamesische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "citoyenne guinéenne" = "guineische:r Staatsangehörige:r",
  "citoyenne macédonienne" = "mazedonische:r Staatsangehörige:r",
  "Guinée-Bissau" = "guinea-bissauische:r Staatsangehörige:r",
  "Mauritius" = "mauritische:r Staatsangehörige:r",
  "verdischer Staatsangehörige" = "verdische:r Staatsangehörige:r",
  "vanuatuischer Staatsangehörige"  = "vanuatuische:rr Staatsangehörige:r"


  
              # Add more mappings here as needed. For example if the analysis is done for another year, where different names appear.
)

#The following code replaces the non-German expressions with their German counterparts.
nationality_counts <- nationality_counts %>%
  mutate(nationality = ifelse(nationality %in% names(mapping),
                              mapping[nationality],
                              nationality)) %>%
  mutate(nationality = as.character(nationality))  #Convert nationality to a character type.


#Regroup and count the occurrences
nationality_counts <- nationality_counts %>%
  group_by(nationality) %>%
  summarise(count = sum(count))


#Create new dichotomous variable
nationality_counts <- nationality_counts %>% mutate(nat_dich = ifelse(nationality == "schweizer Staatsangehörige:r", "Schweizer", "Ausländer")) 


#Save new data frame
saveRDS(nationality_counts, "nationality_counts_ohneAG.Rds")
```


##Basic Plot ohne AGs
Same code as before for the basic plot but different data is used ("nationality_counts_**ohneAG**.Rds").
```{r}
nationality_counts_ohneAG <- read_rds("nationality_counts_ohneAG.Rds")

#Plot the bar chart
ggplot(nationality_counts_ohneAG, aes(x = reorder(nationality, -count), y = count)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Nationality", y = "Frequency", title = "Frequency of Nationalities")


#Second bar chart
#Preprocess the data
processed_data <- nationality_counts_ohneAG %>%
  mutate(nationality_group = ifelse(nat_dich == "Ausländer", "Ausländer", "Schweizer")) %>%
  group_by(nationality_group) %>%
  summarise(count = sum(count)) %>%
  mutate(percentage = count / sum(count) * 100)


#Renaming the data
renamed_data <- processed_data %>%
  mutate(nationality_group = recode(nationality_group,
                                    "Schweizer" = "Schweizer Gründer:innen",
                                    "Ausländer" = "Ausländische Gründer:innen"))


#Define color mapping
color_mapping <- c("Schweizer Gründer:innen" = "#F1977A",
                   "Ausländische Gründer:innen" = "#0028A5")


## Basic Plot without comparison ##
# Preprocess the data
barplot_basic2022_wico_ohneAG <- ggplot(renamed_data, aes(x = nationality_group, y = count, fill = nationality_group)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text()) +
  labs(x = "Staatsangehörigkeit", y = "Anzahl", title = "Anzahl Gründer:innen nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage), "%")),
            position = position_stack(vjust = 0.5),
            color = "white", size = 7, fontface = "bold") +
  coord_cartesian(ylim = c(0, max(renamed_data$count) * 1.1)) + guides(fill=FALSE)+
  theme(legend.position = "bottom") + theme_minimal() + 
  theme(plot.title = element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=18, family="Times New Roman"),
        axis.text.y=element_text(size=18, family="Times New Roman"),
        legend.text=element_text(size=18, family="Times New Roman"),
        legend.title=element_text(size=18, family="Times New Roman"))

ggsave("barplot_basic2022_wico_ohneAG.jpg",  barplot_basic2022_wico_ohneAG, height= 8, width=12)


## Basic Plot ##
#Plot to compare shares in founders to share in employable population (15-64)
#Activate package for brightening the colors later
library(colorspace)


#Define the total swiss population and get the percentages (numbers according to BFS 2022b)
swiss_population <-  5757830
total_swiss <- 4051905
total_foreigners <- 1705925
round((total_swiss/swiss_population), 2)
round((total_foreigners/swiss_population), 2)



#Create a data frame with the population distribution according to BFS data
population_distribution <- data.frame(
  nationality_group = c("Schweizer Wohnbevölkerung*", "Ausländische Wohnbevölkerung*"),
  count = c(total_swiss, total_foreigners),
  percentage = c(70, 30)
)


#Bind the data frames
new_data <- rbind(renamed_data, population_distribution)


#Create additional color mapping and make them brighter in second part
color_mapping <- c(color_mapping, "Schweizer Wohnbevölkerung*" = "#F1977A", "Ausländische Wohnbevölkerung*" = "#0028A5")

color_mapping["Schweizer Wohnbevölkerung*"] <- colorspace::lighten(color_mapping["Schweizer Wohnbevölkerung*"], amount = 0.5)
color_mapping["Ausländische Wohnbevölkerung*"] <- colorspace::lighten(color_mapping["Ausländische Wohnbevölkerung*"], amount = 0.5)


#Specify the order of bars
new_data$nationality_group <- factor(new_data$nationality_group, levels = c("Ausländische Gründer:innen", "Ausländische Wohnbevölkerung*", "Schweizer Gründer:innen", "Schweizer Wohnbevölkerung*"))


#Create the new bar plot and load additional package for the cosmetic changes
library(ggpattern)
barplot_basic2022 <- ggplot(new_data, aes(x = nationality_group, y = percentage, fill = nationality_group)) +
  geom_bar_pattern(stat = "identity",
                   pattern = ifelse(new_data$nationality_group %in% c("Ausländische Wohnbevölkerung*", "Schweizer Wohnbevölkerung*"), "stripe", "none"),
                   pattern_fill = "black",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.02,
                   pattern_key_scale_factor = 1) +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x = "Staatsangehörigkeit", y = "Prozent im Datensatz bzw. der Schweizer Wohnbevölkerung", title = "Prozentzahlen der Gründer:innen und der Wohnbevölkerung nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage, 0), "%")), 
            nudge_y = 3, 
            color = "black", 
            size = 6,
            family="Times New Roman") +
  coord_cartesian(ylim = c(0, max(new_data$percentage) * 1.1)) + guides(fill=FALSE) +
  theme(legend.position = "bottom") + theme_minimal() + 
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme(plot.title=element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=14, family="Times New Roman"),
        axis.text.y=element_text(size=14, family="Times New Roman"),
        legend.text=element_text(size=14, family="Times New Roman"),
        legend.title=element_text(size=14, family="Times New Roman"))


#Save the bar plot
ggsave("barplot_basic2022_ohneAG.jpg",  barplot_basic2022, height= 8, width=12)


#Percentage
total <- sum(nationality_counts2$count)
swiss <- nationality_counts2$count[nationality_counts2$nationality == "schweizer Staatsangehörige:r"]
swiss_perc <- swiss/total*100
foreigner_perc <- 100-swiss_perc



## Basic Plot 2 ##
#Same plot as above but for all of the population above 14
library(colorspace)


#Define the total swiss population and get the percentages (numbers according to BFS 2022b)
swiss_population <-  7419149
total_swiss <- 5529337
total_foreigners <- 1889812
round((total_swiss/swiss_population), 2)
round((total_foreigners/swiss_population), 2)






#Create a data frame with the population distribution according to BFS data
population_distribution <- data.frame(
  nationality_group = c("Schweizer Wohnbevölkerung*", "Ausländische Wohnbevölkerung*"),
  count = c(total_swiss, total_foreigners),
  percentage = c(75, 25)
)


#Bind the data frames
new_data <- rbind(renamed_data, population_distribution)




#Specify the order of bars
new_data$nationality_group <- factor(new_data$nationality_group, levels = c("Ausländische Gründer:innen", "Ausländische Wohnbevölkerung*", "Schweizer Gründer:innen", "Schweizer Wohnbevölkerung*"))


#Create the new bar plot and load additional package for the cosmetic changes
library(ggpattern)
barplot_basic2022_15plus <- ggplot(new_data, aes(x = nationality_group, y = percentage, fill = nationality_group)) +
  geom_bar_pattern(stat = "identity",
                   pattern = ifelse(new_data$nationality_group %in% c("Ausländische Wohnbevölkerung*", "Schweizer Wohnbevölkerung*"), "stripe", "none"),
                   pattern_fill = "black",
                   pattern_angle = 45,
                   pattern_density = 0.1,
                   pattern_spacing = 0.02,
                   pattern_key_scale_factor = 1) +
  scale_fill_manual(values = color_mapping) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x = "Staatsangehörigkeit", y = "Prozent im Datensatz bzw. der Schweizer Wohnbevölkerung", title = "Prozentzahlen der Gründer:innen und der Wohnbevölkerung nach Staatsangehörigkeit 2022") +
  geom_text(aes(label = paste0(round(percentage, 0), "%")), 
            nudge_y = 3, 
            color = "black", 
            size = 6,
            family="Times New Roman") +
  coord_cartesian(ylim = c(0, max(new_data$percentage) * 1.1)) + guides(fill=FALSE) +
  theme(legend.position = "bottom") + theme_minimal() + 
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme(plot.title=element_text(face="bold", size=20, vjust=2, family="Times New Roman"),  
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x=element_text(size=14, family="Times New Roman"),
        axis.text.y=element_text(size=14, family="Times New Roman"),
        legend.text=element_text(size=14, family="Times New Roman"),
        legend.title=element_text(size=14, family="Times New Roman"))


#Save the bar plot
ggsave("barplot_basic2022_15plus_ohneAG.jpg",  barplot_basic2022_15plus, height= 8, width=12)

```





#Robustness test for "Gesellschafter:innen"
The following code aims at providing a robustness test for the GmbHs. Since we cannot filter all the data for "Gesellschafter:innen", we only do it for the cantons where it is possible and observe if there is any difference between the bar plot only focusing on "Gesellschafter:innen" and the one with all the "eingetragene Personen".
````{r}
#Load some necessary libraries
library(dplyr)
library(tidyr)
library(ggplot2)


#Load the necessary data
Firmengründungen2022 <- read_rds("Firmengründungen2022.Rds")


#Filter for the cantons where it is possible to only analyze "Geselschafter:innen" 
Firmengründungen2022_Gesellschafter <- Firmengründungen2022 %>% 
  filter(Rechtsform == "GmbH") %>% 
  filter(senderOffice %in% c("Amt für Handelsregister und Notariate Kanton SG", "SG Grundbuchinspektorat und Handelsregister (GIHA)", "Handelsregister des Kantons Glarus", "Handelsregister- und Konkursamt des Kantons Zug", "Handelsregisteramt des Kantons Aargau", "Handelsregisteramt des Kantons Appenzell A.Rh.", "Handelsregisteramt des Kantons Appenzell I. Rh.", "Handelsregisteramt des Kantons Basel-Landschaft", "Handelsregisteramt des Kantons Basel-Stadt", "Handelsregisteramt des Kantons Luzern", "Handelsregisteramt des Kantons Nidwalden", "Handelsregisteramt des Kantons Obwalden", "Handelsregisteramt des Kantons Schaffhausen", "Handelsregisteramt des Kantons Schwyz", "Handelsregisteramt des Kantons Solothurn", " Handelsregisteramt des Kantons Thurgau", "Handelsregisteramt des Kantons Uri", "Handelsregisteramt des Kantons Zürich", "Handelsregisteramt Oberwallis", "Registro di commercio del Cantone Ticino")) %>% 
  mutate(count_gesellschafter = as.numeric(str_count(owner_info, "\\b(Gesellschafter|Gesellschafterin|socio|socia)\\b")))


#Define a function to get the first N nationalities
get_nationalities <- function(nationalities, count) {
  split_nationalities <- strsplit(nationalities, split = "[,;]")[[1]]
  split_nationalities <- trimws(split_nationalities)
  output <- split_nationalities[1:count]
  return(paste(output, collapse = ", "))
}

#Apply the function to the entire data frame
Firmengründungen2022_Gesellschafter$only_gesellschafter <- mapply(get_nationalities, 
                                          Firmengründungen2022_Gesellschafter$owner_nationality_wcomp2, 
                                          Firmengründungen2022_Gesellschafter$count_gesellschafter)


#Creating a new data frame and redo much of the "counting nationalities" code in order to break down the data to an individual level.
##Create a new data frame with a separate row for each person's nationality
Gesellschafter_data <- data.frame(owner_nationality_wcomp2 = Firmengründungen2022_Gesellschafter$owner_nationality_wcomp2,
                               id = seq_along(Firmengründungen2022_Gesellschafter$owner_nationality_wcomp2))

Gesellschafter_data <- Gesellschafter_data %>%
  separate_rows(owner_nationality_wcomp2, sep = "[,;]\\s*") %>%
  rename(nationality = owner_nationality_wcomp2)


#Count the occurrences of each nationality
Gesellschafter_counts_normal <- Gesellschafter_data %>%
  group_by(nationality) %>%
  summarise(count = n()) %>%
  arrange(desc(count))



#Only Gesellschafter
Gesellschafter_data2 <- data.frame(only_gesellschafter = Firmengründungen2022_Gesellschafter$only_gesellschafter,
                               id = seq_along(Firmengründungen2022_Gesellschafter$only_gesellschafter))

Gesellschafter_data2 <- Gesellschafter_data2 %>%
  separate_rows(only_gesellschafter, sep = "[,;]\\s*") %>%
  rename(nationality = only_gesellschafter)


#Count the occurrences of each nationality
Gesellschafter_counts_spezial <- Gesellschafter_data2 %>%
  group_by(nationality) %>%
  summarise(count = n()) %>%
  arrange(desc(count))


#Create a mapping of non-German expressions to German expressions.
mapping <- c(
  "Swiss" = "schweizer Staatsangehörige:r",
  "cittadina italiana" = "italienische:r Staatsangehörige:r",
  "cittadino italiano" = "italienische:r Staatsangehörige:r",
  "Italie" = "italienische:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "cittadina brasiliana" = "brasilianische:r Staatsangehörige:r",
  "cittadino brasiliano" = "brasilianische:r Staatsangehörige:r",
  "Brésil" = "brasilianische:r Staatsangehörige:r",
  "brasilianische Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "brasilianischer Staatsangehörige" = "brasilianische:r Staatsangehörige:r",
  "France" = "französische:r Staatsangehörige:r",
  "französischer Staatsangehörige" = "französische:r Staatsangehörige:r",
  "französische Staatsangehörige" = "französische:r Staatsangehörige:r",
  "italienischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutscher Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "Allemagne" = "deutsche:r Staatsangehörige:r",
  "italienische Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "deutsche Staatsangehörige" = "deutsche:r Staatsangehörige:r",
  "cittadina germanica" = "deutsche:r Staatsangehörige:r",
  "cittadino germanico" = "deutsche:r Staatsangehörige:r",
  "kosovarischer Staatsangehörige" = "kosovarische:r Staatsangehörige:r",
  "kosovarische Staatsangehörige" = "kosovarische:r Staatsangehörige:r", 
  "Kosovo" = "kosovarische:r Staatsangehörige:r",
  "Portugal" = "portugisische:r Staatsangehörige:r",
  "portugiesischer Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "portugiesische Staatsangehörige" = "portugisische:r Staatsangehörige:r",
  "türkischer Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "türkische Staatsangehörige" = "türkische:r Staatsangehörige:r",
  "Turquie" = "türkische:r Staatsangehörige:r",
  "nordmazedonischer Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "nordmazedonische Staatsangehörige" = "nordmazedonische:r Staatsangehörige:r",
  "österreichischer Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "österreichische Staatsangehörige" = "österreichische:r Staatsangehörige:r", 
  "serbischer Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "serbische Staatsangehörige" = "serbische:r Staatsangehörige:r",
  "syrischer Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "syrische Staatsangehörige" = "syrische:r Staatsangehörige:r",
  "spanischer Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "spanische Staatsangehörige" = "spanische:r Staatsangehörige:r",
  "Espagne" = "spanische:r Staatsangehörige:r",
  "britischer Staatsangehörige" = "britische:r Staatsangehörige:r",
  "britische Staatsangehörige" = "britische:r Staatsangehörige:r",
  "cittadina britannica" = "britische:r Staatsangehörige:r",
  "cittadino britannico" = "britische:r Staatsangehörige:r",
  "niederländischer Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "niederländische Staatsangehörige" = "niederländische:r Staatsangehörige:r",
  "kroatischer Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "kroatische Staatsangehörige" = "kroatische:r Staatsangehörige:r",
  "ungarischer Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "ungarische Staatsangehörige" = "ungarische:r Staatsangehörige:r",
  "rumänischer Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "rumänische Staatsangehörige" = "rumänische:r Staatsangehörige:r",
  "Roumanie" = "rumänische:r Staatsangehörige:r",
  "polnischer Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "polnische Staatsangehörige" = "polnische:r Staatsangehörige:r",
  "amerikanischer Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "amerikanische Staatsangehörige" = "amerikanische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "herzegowinischer Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "Belgique" = "belgische:r Staatsangehörige:r",
  "belgische Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "belgischer Staatsangehörige" = "belgische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "herzegowinische Staatsangehörige" = "herzegowinische:r Staatsangehörige:r",
  "bulgarischer Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "bulgarische Staatsangehörige" = "bulgarische:r Staatsangehörige:r",
  "Bulgarie" = "bulgarische:r Staatsangehörige:r",
  "cittadina bulgara" = "bulgarische:r Staatsangehörige:r",
  "cittadino bulgaro" = "bulgarische:r Staatsangehörige:r",
  "slowakischer Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "slowakische Staatsangehörige" = "slowakische:r Staatsangehörige:r",
  "Dominique" = "domenikanische:r Staatsangehörige:r",
  "domenikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "domenikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominicanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanische Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "dominikanischer Staatsangehörige" = "domenikanische:r Staatsangehörige:r",
  "République dominicaine" = "domenikanische:r Staatsangehörige:r",
  "Maurice" = "mauritische:r Staatsangehörige:r",
  "mauritische Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "mauritischer Staatsangehörige" = "mauritische:r Staatsangehörige:r",
  "lankischer Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "lankische Staatsangehörige" = "srilankische:r Staatsangehörige:r",
  "afghanischer Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "afghanische Staatsangehörige" = "afghanische:r Staatsangehörige:r",
  "Afghanistan" = "afghanische:r Staatsangehörige:r",
  "cittadina afghana" = "afghanische:r Staatsangehörige:r",
  "cittadino afghano" = "afghanische:r Staatsangehörige:r",
  "Malte" = "maltesische:r Staatsangehörige:r",
  "maltesischer Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "maltesische Staatsangehörige" = "maltesische:r Staatsangehörige:r",
  "ukrainische Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "ukrainischer Staatsangehörige" = "ukrainische:r Staatsangehörige:r",
  "Ukraine" = "ukrainische:r Staatsangehörige:r",
  "indischer Staatsangehörige" = "indische:r Staatsangehörige:r",
  "indische Staatsangehörige" = "indische:r Staatsangehörige:r",
  "thailändische Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "thailändischer Staatsangehörige" = "thailändische:r Staatsangehörige:r",
  "chinesischer Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "chinesische Staatsangehörige" = "chinesische:r Staatsangehörige:r",
  "cittadina cinese" = "chinesische:r Staatsangehörige:r",
  "cittadino cinese" = "chinesische:r Staatsangehörige:r",
  "Afrique du Sud" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanische Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "südafrikanischer Staatsangehörige" = "südafrikanische:r Staatsangehörige:r",
  "ägyptische Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "ägyptischer Staatsangehörige" = "ägyptische:r Staatsangehörige:r",
  "albanische Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "albanischer Staatsangehörige" = "albanische:r Staatsangehörige:r",
  "Albanie" = "albanische:r Staatsangehörige:r",
  "cittadina albanese" = "albanische:r Staatsangehörige:r",
  "cittadino albanese" = "albanische:r Staatsangehörige:r",
  "algerische Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "algerischer Staatsangehörige" = "algerische:r Staatsangehörige:r",
  "Algérie" = "albanische:r Staatsangehörige:r",
  "angolanischer Staatsangehörige" = "angolanische:r Staatsangehörige:r",
  "Angola" = "angolanische:r Staatsangehörige:r",
  "Arabie saoudite" = "saudi-arabische:r Staatsangehörige:r",
  "argentinische Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "argentinischer Staatsangehörige" = "argentinische:r Staatsangehörige:r",
  "Argentine" = "argentinische:r Staatsangehörige:r",
  "armenische Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "armenischer Staatsangehörige" = "armenische:r Staatsangehörige:r",
  "Arménie" = "armenische:r Staatsangehörige:r",
  "aserbaidschanische Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "aserbaidschanischer Staatsangehörige" = "aserbaidschanische:r Staatsangehörige:r",
  "Azerbaïdjan" = "aserbaidschanische:r Staatsangehörige:r",
  "äthiopische Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "äthiopischer Staatsangehörige" = "äthiopische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "Autriche" = "österreichische:r Staatsangehörige:r",
  "Australie" = "australische:r Staatsangehörige:r",
  "australischer Staatsangehörige" = "australische:r Staatsangehörige:r",
  "australische Staatsangehörige" = "australische:r Staatsangehörige:r",
  "cittadina austriaca"  = "australische:r Staatsangehörige:r",
  "cittadina austriaco"  = "australische:r Staatsangehörige:r",
  "Bangladesh" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschischer Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "bangladeschische Staatsangehörige" = "bangladeschische:r Staatsangehörige:r",
  "belarussische Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "belarussischer Staatsangehörige" = "belarussische:r Staatsangehörige:r",
  "bolivianische Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "bolivianischer Staatsangehörige" = "bolivianische:r Staatsangehörige:r",
  "Bolivie" = "bolivianische:r Staatsangehörige:r",
  "bosnische Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "bosnischer Staatsangehörige" = "bosnische:r Staatsangehörige:r",
  "Bosnie-Herzégovine" = "bosnische:r Staatsangehörige:r",
  "cittadina bosniaca" = "bosnische:r Staatsangehörige:r",
  "cittadino bosniaco" = "bosnische:r Staatsangehörige:r",
  "burundischer Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "burundische Staatsangehörige" = "burundische:r Staatsangehörige:r",
  "kamerunische Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "kamerunischer Staatsangehörige" = "kamerunische:r Staatsangehörige:r",
  "Cameroun" = "kamerunische:r Staatsangehörige:r",
  "Canada" = "kanadische:r Staatsangehörige:r",
  "kanadischer Staatsangehörige" = "kanadische:r Staatsangehörige:r", 
  "kanadische Staatsangehörige" = "kanadische:r Staatsangehörige:r",
  "chilenische Staatsangehörige" = "chilenische:r Staatsangehörige:r", 
  "chilenischer Staatsangehörige" = "chilenische:r Staatsangehörige:r",
  "Chili" = "chilenische:r Staatsangehörige:r",
  "Chine" = "chinesische:r Staatsangehörige:r",
  "botsuanische Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "botsuanischer Staatsangehörige" = "botsuanische:r Staatsangehörige:r",
  "Botswana" = "botsuanische:r Staatsangehörige:r",
  "Burundi" = "burundische:r Staatsangehörige:r",
  "beninischer Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "beninische Staatsangehörige" = "beninische:r Staatsangehörige:r",
  "Bénin" = "beninische:r Staatsangehörige:r",
  "Biélorussie" = "weiss-russische:r Staatsangehörige:r",
  "cittadina bielorussa" = "weiss-russische:r Staatsangehörige:r",
  "Bermudes" = "bermudische:r Staatsangehörige:r",
  "Burkina Faso" = "burkinische:r Staatsangehörige:r",
  "Cambodge" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanische Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "kambodschanischer Staatsangehörige" = "kambodschanische:r Staatsangehörige:r",
  "Kazakhstan" = "kasachische:r Staatsangehörige:r",
  "kasachische Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "kasachischer Staatsangehörige" = "kasachische:r Staatsangehörige:r",
  "zyprischer Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "zyprische Staatsangehörige" = "zyprische:r Staatsangehörige:r",
  "Chypre" = "zyprische:r Staatsangehörige:r",
  "cittadina ceca" = "tschechische:r Staatsangehörige:r",
  "cittadino ceco" = "tschechische:r Staatsangehörige:r",
  "tschechische Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "tschechischer Staatsangehörige" = "tschechische:r Staatsangehörige:r",
  "cittadina colombiana" = "kolumbianische:r Staatsangehörige:r",
  "cittadino colombiano" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianische Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "kolumbianischer Staatsangehörige" = "kolumbianische:r Staatsangehörige:r",
  "vietnamesische Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "vietnamesischer Staatsangehörige" = "vietnamesische:r Staatsangehörige:r",
  "Vietnam" = "vietnamesische:r Staatsangehörige:r",
  "venezolanische Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "venezolanischer Staatsangehörige" = "venezolanische:r Staatsangehörige:r",
  "Venezuela" = "venezolanische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "uruguayischer Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "uruguayische Staatsangehörige" = "uruguayische:r Staatsangehörige:r",
  "ugandische Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "ugandischer Staatsangehörige" = "ugandische:r Staatsangehörige:r",
  "tunesische Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "tunesischer Staatsangehörige" = "tunesische:r Staatsangehörige:r",
  "Tunisie" = "tunesische:r Staatsangehörige:r",
  "togoische Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "togoischer Staatsangehörige" = "togoische:r Staatsangehörige:r",
  "Togo" = "togoische:r Staatsangehörige:r",
  "Thaïlande" = "thailändische:r Staatsangehörige:r",
  "taiwanische Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "taiwanischer Staatsangehörige" = "taiwanische:r Staatsangehörige:r",
  "Taïwan" = "taiwanische:r Staatsangehörige:r",
  "tadschikische Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "tadschikischer Staatsangehörige" = "tadschikische:r Staatsangehörige:r",
  "Syrie" = "syrische:r Staatsangehörige:r",
  "Suède" = "schwedische:r Staatsangehörige:r",
  "schwedische Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "schwedischer Staatsangehörige" = "schwedische:r Staatsangehörige:r",
  "südkoreanische Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "südkoreanischer Staatsangehörige" = "südkoreanische:r Staatsangehörige:r",
  "Sri Lanka" = "srilankische:r Staatsangehörige:r",
  "somalische Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "somalischer Staatsangehörige" = "somalische:r Staatsangehörige:r",
  "Somalie" = "somalische:r Staatsangehörige:r",
  "slowenische Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "slowenischer Staatsangehörige" = "slowenische:r Staatsangehörige:r",
  "Slovénie" = "slowenische:r Staatsangehörige:r",
  "Slovaquie" = "slowakische:r Staatsangehörige:r",
  "singapurische Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "singapurischer Staatsangehörige" = "singapurische:r Staatsangehörige:r",
  "Singapour" = "singapurische:r Staatsangehörige:r",
  "Serbie" = "serbische:r Staatsangehörige:r",
  "senegalesische Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "senegalesischer Staatsangehörige" = "senegalesische:r Staatsangehörige:r",
  "Sénégal" = "senegalesische:r Staatsangehörige:r",
  "salvadorianische Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "salvadorianischer Staatsangehörige" = "salvadorianische:r Staatsangehörige:r",
  "Salvador" = "salvadorianische:r Staatsangehörige:r",
  "russische Staatsangehörige" = "russische:r Staatsangehörige:r",
  "russischer Staatsangehörige" = "russische:r Staatsangehörige:r",
  "Russie" = "russische:r Staatsangehörige:r",
  "Royaume-Uni" = "britische:r Staatsangehörige:r",
  "Pologne" = "polnische:r Staatsangehörige:r",
  "philippinische Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "philippinischer Staatsangehörige" = "philippinische:r Staatsangehörige:r",
  "Philippines" = "philippinische:r Staatsangehörige:r",
  "peruanische Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "peruanischer Staatsangehörige" = "peruanische:r Staatsangehörige:r",
  "Pérou" = "peruanische:r Staatsangehörige:r",
  "Pays-Bas" = "niederländische:r Staatsangehörige:r",
  "panamaische Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "panamaischer Staatsangehörige" = "panamaische:r Staatsangehörige:r",
  "Panama" = "panamaische:r Staatsangehörige:r",
  "pakistanische Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "pakistanischer Staatsangehörige" = "pakistanische:r Staatsangehörige:r",
  "Pakistan" = "pakistanische:r Staatsangehörige:r",
  "usbekische Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "usbekischer Staatsangehörige" = "usbekische:r Staatsangehörige:r",
  "Ouzbékistan" = "usbekische:r Staatsangehörige:r",
  "norwegische Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "norwegischer Staatsangehörige" = "norwegische:r Staatsangehörige:r",
  "Norvège" = "norwegische:r Staatsangehörige:r",
  "nigerianischer Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "nigerianische Staatsangehörige" = "nigerianische:r Staatsangehörige:r",
  "Nigéria" = "nigerianische:r Staatsangehörige:r",
  "nicaraguanischer Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "nicaraguanische Staatsangehörige" = "nicaraguanische:r Staatsangehörige:r",
  "neuseeländischer Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "neuseeländische Staatsangehörige" = "neuseeländische:r Staatsangehörige:r",
  "montenegrinischer Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "montenegrinische Staatsangehörige" = "montenegrinische:r Staatsangehörige:r",
  "Monténégro" = "montenegrinische:r Staatsangehörige:r",
  "mongolischer Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "mongolische Staatsangehörige" = "mongolische:r Staatsangehörige:r",
  "Mongolie" = "mongolische:r Staatsangehörige:r",
  "mexikanischer Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "mexikanische Staatsangehörige" = "mexikanische:r Staatsangehörige:r",
  "Mexique" = "mexikanische:r Staatsangehörige:r",
  "mazedonische Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "mazedonischer Staatsangehörige" = "mazedonische:r Staatsangehörige:r",
  "marokkanische Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "marokkanischer Staatsangehörige" = "marokkanische:r Staatsangehörige:r",
  "Maroc" = "marokkanische:r Staatsangehörige:r",
  "malaysische Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "malaysischer Staatsangehörige" = "malaysische:r Staatsangehörige:r",
  "Malaisie" = "malaysische:r Staatsangehörige:r",
  "madagassische Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "madagassischer Staatsangehörige" = "madagassische:r Staatsangehörige:r",
  "Madagascar" = "malaysische:r Staatsangehörige:r",
  "luxemburgische Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "luxemburgischer Staatsangehörige" = "luxemburgische:r Staatsangehörige:r",
  "Luxembourg" = "luxemburgische:r Staatsangehörige:r",
  "litauische Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "litauischer Staatsangehörige" = "litauische:r Staatsangehörige:r",
  "Lituanie" = "litauische:r Staatsangehörige:r",
  "liechtensteinische Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "liechtensteinischer Staatsangehörige" = "liechtensteinische:r Staatsangehörige:r",
  "libanesische Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "libanesischer Staatsangehörige" = "libanesische:r Staatsangehörige:r",
  "Liban" = "libanesische:r Staatsangehörige:r",
  "libysche Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "libyscher Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "Libye" = "libysche:r Staatsangehörige:r",
  "lybischer Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lybische Staatsangehörige" = "libysche:r Staatsangehörige:r",
  "lettische Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "lettischer Staatsangehörige" = "lettische:r Staatsangehörige:r",
  "Lettonie" = "lettische:r Staatsangehörige:r",
  "kubanische Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "kubanischer Staatsangehörige" = "kubanische:r Staatsangehörige:r",
  "jemenitische Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "jemenitischer Staatsangehörige" = "jemenitische:r Staatsangehörige:r",
  "japanische Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "japanischer Staatsangehörige" = "japanische:r Staatsangehörige:r",
  "Japon" = "japanische:r Staatsangehörige:r",
  "jamaikanische Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "jamaikanischer Staatsangehörige" = "jamaikanische:r Staatsangehörige:r",
  "Jamaïque" = "jamaikanische:r Staatsangehörige:r",
  "italianischer Staatsangehörige" = "italienische:r Staatsangehörige:r",
  "ivorische Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "ivorischer Staatsangehörige" = "ivorische:r Staatsangehörige:r",
  "israelische Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "israelischer Staatsangehörige" = "israelische:r Staatsangehörige:r",
  "Israël" = "israelische:r Staatsangehörige:r",
  "isländische Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "isländischer Staatsangehörige" = "isländische:r Staatsangehörige:r",
  "irische Staatsangehörige" = "irische:r Staatsangehörige:r",
  "irischer Staatsangehörige" = "irische:r Staatsangehörige:r",
  "Irlande" = "irische:r Staatsangehörige:r",
  "iranische Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "iranischer Staatsangehörige" = "iranische:r Staatsangehörige:r",
  "Iran" = "iranische:r Staatsangehörige:r",
  "irakische Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "irakischer Staatsangehörige" = "irakische:r Staatsangehörige:r",
  "Irak" = "irakische:r Staatsangehörige:r",
  "indonesische Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "indonesischer Staatsangehörige" = "indonesische:r Staatsangehörige:r",
  "Indonésie" = "indonesische:r Staatsangehörige:r",
  "Inde" = "indische:r Staatsangehörige:r",
  "hongkonger Staatsangehörige" = "hongkonger:r Staatsangehörige:r",
  "Hongrie" = "ungarische:r Staatsangehörige:r",
  "honduranischer Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "honduranische Staatsangehörige" = "honduranische:r Staatsangehörige:r",
  "guineischer Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "guineische Staatsangehörige" = "guineische:r Staatsangehörige:r",
  "Guinée" = "guineische:r Staatsangehörige:r",
  "grenadischer Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "grenadische Staatsangehörige" = "grenadische:r Staatsangehörige:r",
  "Grenade" = "grenadische:r Staatsangehörige:r",
  "Grèce" = "griechische:r Staatsangehörige:r",
  "griechische Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "griechischer Staatsangehörige" = "griechische:r Staatsangehörige:r",
  "Ghana" = "ghanaische:r Staatsangehörige:r",
  "ghanaische Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "ghanaischer Staatsangehörige" = "ghanaische:r Staatsangehörige:r",
  "georgische Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "georgischer Staatsangehörige" = "georgische:r Staatsangehörige:r",
  "Géorgie" = "georgische:r Staatsangehörige:r",
  "gabunische Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gabunischer Staatsangehörige" = "gabunische:r Staatsangehörige:r",
  "gambischer Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "gambische Staatsangehörige" = "gambische:r Staatsangehörige:r",
  "finnische Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "finnischer Staatsangehörige" = "finnische:r Staatsangehörige:r",
  "Finlande" = "finnische:r Staatsangehörige:r",
  "estnische Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "estnischer Staatsangehörige" = "estnische:r Staatsangehörige:r",
  "eritreische Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "eritreischer Staatsangehörige" = "eritreische:r Staatsangehörige:r",
  "Érythrée" = "eritreische:r Staatsangehörige:r",
  "ecuadorianische Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "ecuadorianischer Staatsangehörige" = "ecuadorianische:r Staatsangehörige:r",
  "Équateur" = "ecuadorianische:r Staatsangehörige:r",
  "dänische Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "dänischer Staatsangehörige" = "dänische:r Staatsangehörige:r",
  "Danemark" = "dänische:r Staatsangehörige:r",
  "Cuba" = "kubanische:r Staatsangehörige:r", 
  "Croatie" = "kroatische:r Staatsangehörige:r", 
  "Costa Rica" = "costaricanische:r Staatsangehörige:r", 
  "Corée du Sud" = "südkoreanische:r Staatsangehörige:r", 
  "Colombie" = "kolumbianische:r Staatsangehörige:r", 
  "cittadino venezuelano" = "venezolanische:r Staatsangehörige:r",
  "cittadina venezuelana" = "venezolanische:r Staatsangehörige:r",
  "cittadino ungherese" = "ungarische:r Staatsangehörige:r",
  "cittadino ucraino" = "ukrainische:r Staatsangehörige:r",
  "cittadina ucraina" = "ukrainische:r Staatsangehörige:r",
  "cittadino turco" = "türkische:r Staatsangehörige:r", 
  "cittadina svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino svedese" = "schwedische:r Staatsangehörige:r", 
  "cittadino statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadina statunitense" = "amerikanische:r Staatsangehörige:r", 
  "cittadino spagnolo" = "spanische:r Staatsangehörige:r", 
  "cittadina spagnola" = "spanische:r Staatsangehörige:r", 
  "cittadino sloveno" = "slowenische:r Staatsangehörige:r", 
  "cittadina slovena" = "slowenische:r Staatsangehörige:r", 
  "cittadino siriano" = "syrische:r Staatsangehörige:r",
  "cittadina slovacca" = "slowakische:r Staatsangehörige:r",
  "cittadina croata" = "kroatische:r Staatsangehörige:r",
  "cittadino croato" = "kroatische:r Staatsangehörige:r",
  "cittadina danese" = "dänische:r Staatsangehörige:r",
  "cittadino danese" = "dänische:r Staatsangehörige:r",
  "cittadina cubano" = "kubanische:r Staatsangehörige:r",
  "cittadina domenicana" = "domenikanische:r Staatsangehörige:r",
  "cittadina eritrea" = "eritreische:r Staatsangehörige:r",
  "cittadino russo" = "russische:r Staatsangehörige:r",
  "cittadina russa" = "russische:r Staatsangehörige:r",
  "Cap-Vert" = "kapverdische:r Staatsangehörige:r",
  "cittadina francese" = "französische:r Staatsangehörige:r",
  "cittadina giapponese" = "japanische:r Staatsangehörige:r",
  "cittadina greca" = "griechische:r Staatsangehörige:r",
  "cittadina iraniana" = "iranische:r Staatsangehörige:r",
  "cittadina kazaka" = "kasachische:r Staatsangehörige:r",
  "cittadina kosovara" = "kosovarische:r Staatsangehörige:r",
  "cittadina lettone" = "lettische:r Staatsangehörige:r",
  "cittadina libanese" = "libanesische:r Staatsangehörige:r",
  "cittadina lituana" = "litauische:r Staatsangehörige:r",
  "cittadina macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadina messicana" = "mexikanische:r Staatsangehörige:r",
  "cittadina moldova" = "moldavische:r Staatsangehörige:r",
  "cittadina norvegese" = "norwegische:r Staatsangehörige:r",
  "cittadina olandese" = "niederländische:r Staatsangehörige:r",
  "cittadina polacca" = "polnische:r Staatsangehörige:r",
  "cittadina portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadina romena" = "rumänische:r Staatsangehörige:r",
  "cittadina serba" = "serbische:r Staatsangehörige:r",
  "cittadino angolano" = "angolanische:r Staatsangehörige:r",
  "cittadino austriaco" = "österreichische:r Staatsangehörige:r",
  "cittadino belga" = "belgische:r Staatsangehörige:r",
  "cittadino boliviano" = "bolivianische:r Staatsangehörige:r",
  "cittadino cileno" = "chilenische:r Staatsangehörige:r",
  "cittadino cubano" = "kubanische:r Staatsangehörige:r",
  "cittadino ecuadoriano" = "ecuadorianische:r Staatsangehörige:r",
  "cittadino finlandese" = "finnische:r Staatsangehörige:r",
  "cittadino francese" = "französische:r Staatsangehörige:r",
  "cittadino greco" = "griechische:r Staatsangehörige:r",
  "cittadino iracheno" = "irakische:r Staatsangehörige:r",
  "cittadino irlandese" = "irische:r Staatsangehörige:r",
  "cittadino kosovaro" = "kosovarische:r Staatsangehörige:r",
  "cittadino lettone" = "lettische:r Staatsangehörige:r",
  "cittadino macedone" = "mazedonische:r Staatsangehörige:r",
  "cittadino marocchino" = "marokkanische:r Staatsangehörige:r",
  "cittadino messicano" = "mexikanische:r Staatsangehörige:r",
  "cittadino montenegrino" = "montenegrinische:r Staatsangehörige:r",
  "cittadino olandese" = "niederländische:r Staatsangehörige:r",
  "cittadino polacco" = "polnische:r Staatsangehörige:r",
  "cittadino portoghese" = "portugisische:r Staatsangehörige:r",
  "cittadino senegalese" = "senegalesische:r Staatsangehörige:r",
  "cittadino serbo" = "serbische:r Staatsangehörige:r",
  "cittadino tunisino" = "tunesische:r Staatsangehörige:r",
  "Curaçao" = "Curaçaoënarische:r Staatsangehörige:r",
  "Gibraltar" = "gibraltaische:r Staatsangehörige:r",
  "Honduras" = "honduranische:r Staatsangehörige:r",
  "jordanischer Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "jordanische Staatsangehörige" = "jordanische:r Staatsangehörige:r",
  "Jordanie" = "jordanische:r Staatsangehörige:r",
  "Koweït" = "kuweitische:r Staatsangehörige:r",
  "Macédoine du Nord" = "nordmazedonische:r Staatsangehörige:r",
  "Moldavie" = "moldavische:r Staatsangehörige:r",
  "Nicaragua" = "nicaraguanische:r Staatsangehörige:r",
  "Niger" = "nigeranische:r Staatsangehörige:r",
  "Nouvelle-Zélande" = "neuseeländische:r Staatsangehörige:r",
  "Ouganda" = "ugandische:r Staatsangehörige:r",
  "Paraguay" = "paraguayanische:r Staatsangehörige:r",
  "ruandischer Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ruandische Staatsangehörige" = "ruandische:r Staatsangehörige:r",
  "ricanischer Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "ricanische Staatsangehörige" = "puertoricanische:r Staatsangehörige:r",
  "Tchéquie" = "tschechische:r Staatsangehörige:r",
  "Yémen" = "jemenitische:r Staatsangehörige:r",
  "cittadina di" = "unbekannte Staatsangehörigkeit",
  "cittadino di" = "unbekannte Staatsangehörigkeit",
  "cittadino romeno"  = "rumänische:r Staatsangehörige:r",
  "unbekannte Staatsangehörig" = "unbekannte Staatsangehörigkeit",
  "Mali" = "malische:r Staatsangehörige:r",
  "Monaco" = "monegassische:r Staatsangehörige:r",
  "République centrafricaine" = "zentralafrikanische:r Staatsangehörige:r",
  "andorrine Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "andorriner Staatsangehörige" = "andorrine:r Staatsangehörige:r",
  "arabische Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "arabischer Staatsangehörige" = "arabische:r Staatsangehörige:r",
  "burkinischer Staatsangehörige" = "burkinische:r Staatsangehörige:r",
  "cittadino argentino" = "argentinische:r Staatsangehörige:r",
  "cittadino australiano" = "australische:r Staatsangehörige:r",
  "cittadino canadese" = "kanadische:r Staatsangehörige:r",
  "cittadino cipriota" = "zyprische:r Staatsangehörige:r",
  "cittadino indiano" = "indische:r Staatsangehörige:r",
  "cittadino lussemburghese" = "luxemburgische:r Staatsangehörige:r",
  "cittadino norvegese" = "norwegische:r Staatsangehörige:r",
  "guatemaltekischer Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "guatemaltekische Staatsangehörige" = "guatemaltekische:r Staatsangehörige:r",
  "haitianischer Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "haitianische Staatsangehörige" = "haitianische:r Staatsangehörige:r",
  "Kirghizistan" = "krigisische:r Staatsangehörige:r",
  "krigisische Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "krigisischer Staatsangehörige" = "krigisische:r Staatsangehörige:r",
  "kiribatischer Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "kiribatische Staatsangehörige" = "kiribatische:r Staatsangehörige:r",
  "moldauische Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "moldauischer Staatsangehörige" = "moldauische:r Staatsangehörige:r",
  "mosambikanische Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "mosambikanischer Staatsangehörige" = "mosambikanische:r Staatsangehörige:r",
  "myanmarische Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "myanmarischer Staatsangehörige" = "myanmarische:r Staatsangehörige:r",
  "namibische Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "namibischer Staatsangehörige" = "namibische:r Staatsangehörige:r",
  "nepalesische Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "nepalesischer Staatsangehörige" = "nepalesische:r Staatsangehörige:r",
  "Soudan" = "sudanesische:r Staatsangehörige:r",
  "sudanesische Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "sudanesischer Staatsangehörige" = "sudanesische:r Staatsangehörige:r",
  "kenianische Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "kenianischer Staatsangehörige" = "kenianische:r Staatsangehörige:r",
  "palästinischer Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "palästinische Staatsangehörige" = "palästinische:r Staatsangehörige:r",
  "paraguayische Staatsangehörige" = "paraguayanische:r Staatsangehörige:r",
  "antiguanischer Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "antiguanische Staatsangehörige" = "antiguanische:r Staatsangehörige:r",
  "simbabwischer Staatsangehörige" = "simbabwische:r Staatsangehörige:r",
  "simbabwische Staatsangehörige" = "simbabwische:r Staatsangehörige:r", 
  "Jersey" = "jerseyische:r Staatsangehörige:r",
  "Émirats arabes unis" = "emiratische:r Staatsangehörige:r",
  "Estonie" = "estnische:r Staatsangehörige:r",
  "Fidji" = "fidschianische:r Staatsangehörige:r",
  "Qatar" = "katarische:r Staatsangehörige:r",
  "Montserrat" = "montserratische:r Staatsangehörige:r",
  "Liechtenstein" = "liechtensteinische:r Staatsangehörige:r",
  "Uruguay" = "uruguayische:r Staatsangehörige:r",
  "Éthiopie" = "ethiopische:r Staatsangehörige:r",
  "Kenya" = "kenianische:r Staatsangehörige:r",
  "Maldives" = "maledivische:r Staatsangehörige:r",
  "Mozambique" = "mosambikanische:r Staatsangehörige:r",
  "Rwanda" = "ruandische:r Staatsangehörige:r",
  "Trinité-et-Tobago" = "trinidadianische und tobagoische:r Staatsangehörige:r",
  "citoyen afghan" = "afghanische:r Staatsangehörige:r",
  "ressortissant afghan" = "afghanische:r Staatsangehörige:r",
  "citoyen algérien" = "algerische:r Staatsangehörige:r",
  "citoyen allemand" = "deutsche:r Staatsangehörige:r",
  "citoyen américain" = "amerikanische:r Staatsangehörige:r",
  "citoyen arménien" = "armenische:r Staatsangehörige:r",
  "citoyen australien" = "australische:r Staatsangehörige:r",
  "citoyen belge" = "belgische:r Staatsangehörige:r",
  "citoyen bosniaque" = "bosnische:r Staatsangehörige:r",
  "citoyen brésilien" = "brasilianische:r Staatsangehörige:r",
  "citoyen britannique" = "britische:r Staatsangehörige:r",
  "citoyen bulgare" = "bulgarische:r Staatsangehörige:r",
  "citoyen danois" = "dänische:r Staatsangehörige:r",
  "citoyen espagnol" = "spanische:r Staatsangehörige:r",
  "citoyen français" = "französische:r Staatsangehörige:r",
  "citoyen hongrois" = "ungarische:r Staatsangehörige:r",
  "citoyen indien" = "indische:r Staatsangehörige:r",
  "citoyen irlandais" = "irische:r Staatsangehörige:r",
  "citoyen italien" = "italienische:r Staatsangehörige:r",
  "citoyen kosovar" = "kosovarische:r Staatsangehörige:r",
  "citoyen letton" = "lettische:r Staatsangehörige:r",
  "citoyen macédonien" = "mazedonische:r Staatsangehörige:r",
  "citoyen moldave" = "moldavische:r Staatsangehörige:r",
  "citoyen néerlandais" = "niederländische:r Staatsangehörige:r",
  "citoyen péruvien" = "peruanische:r Staatsangehörige:r",
  "citoyen polonais" = "polnische:r Staatsangehörige:r",
  "citoyen portugais" = "portugisische:r Staatsangehörige:r",
  "citoyen roumain" = "rumänische:r Staatsangehörige:r",
  "citoyen sénégalais" = "senegalesische:r Staatsangehörige:r",
  "citoyen serbe" = "serbische:r Staatsangehörige:r",
  "citoyen slovaque" = "slowakische:r Staatsangehörige:r",
  "citoyen somalien" = "somalische:r Staatsangehörige:r",
  "citoyen sri" = "srilankische:r Staatsangehörige:r",
  "ressortissant sri" = "srilankische:r Staatsangehörige:r",
  "ressortissante sri" = "srilankische:r Staatsangehörige:r",
  "citoyen suédois" = "schwedische:r Staatsangehörige:r",
  "citoyen syrien" = "syrische:r Staatsangehörige:r",
  "citoyen tchèque" = "tschechische:r Staatsangehörige:r",
  "citoyen turc" = "türkische:r Staatsangehörige:r",
  "citoyen ukrainien" = "ukrainische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "österreichische:r Staatsangehörige:r",
  "citoyenne belge" = "belgische:r Staatsangehörige:r",
  "citoyenne brésilienne" = "brasilianische:r Staatsangehörige:r",
  "citoyenne britannique" = "britische:r Staatsangehörige:r",
  "citoyenne chinoise" = "chinesische:r Staatsangehörige:r",
  "citoyenne espagnole" = "spanische:r Staatsangehörige:r",
  "citoyenne française" = "französische:r Staatsangehörige:r",
  "citoyenne guineische" = "guineische:r Staatsangehörige:r",
  "citoyenne hongroise" = "ungarische:r Staatsangehörige:r",
  "citoyenne irlandaise" = "irische:r Staatsangehörige:r",
  "citoyenne italienne" = "italienische:r Staatsangehörige:r",
  "citoyenne kosovare" = "kosovarische:r Staatsangehörige:r",
  "citoyenne autrichienne" = "mazedonische:r Staatsangehörige:r",
  "citoyenne marocaine" = "marokkanische:r Staatsangehörige:r",
  "citoyenne néo" = "neuseeländische:r Staatsangehörige:r",
  "citoyenne polonaise" = "polnische:r Staatsangehörige:r",
  "citoyenne portugaise" = "portugisische:r Staatsangehörige:r",
  "citoyenne roumaine" = "rumänische:r Staatsangehörige:r",
  "citoyenne russe" = "russische:r Staatsangehörige:r",
  "citoyenne rwandaise" = "ruandische:r Staatsangehörige:r",
  "citoyenne turque" = "türkische:r Staatsangehörige:r",
  "citoyenne ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "Grande-Bretagne" = "britische:r Staatsangehörige:r",
  "Mauritanie" = "mauretanische:r Staatsangehörige:r",
  "ressortissant albanais" = "albanische:r Staatsangehörige:r",
  "ressortissant algérien" = "algerische:r Staatsangehörige:r",
  "ressortissant allemand" = "deutsche:r Staatsangehörige:r",
  "ressortissant américain" = "amerikanische:r Staatsangehörige:r",
  "ressortissant autrichien" = "österreichische:r Staatsangehörige:r",
  "ressortissant belge" = "belgische:r Staatsangehörige:r",
  "ressortissant bosniaque" = "bosnische:r Staatsangehörige:r",
  "ressortissant brésilien" = "brasilianische:r Staatsangehörige:r",
  "ressortissant britannique" = "britische:r Staatsangehörige:r",
  "ressortissant bulgare" = "bulgarische:r Staatsangehörige:r",
  "ressortissant camerounais" = "kamerunische:r Staatsangehörige:r",
  "ressortissant canadien" = "kanadische:r Staatsangehörige:r",
  "ressortissant chinois" = "chinesische:r Staatsangehörige:r",
  "ressortissant croate" = "kroatische:r Staatsangehörige:r",
  "ressortissant érythréen" = "eritreische:r Staatsangehörige:r",
  "ressortissant espagnol" = "spanische:r Staatsangehörige:r",
  "ressortissant français" = "französische:r Staatsangehörige:r",
  "ressortissant hongrois" = "ungarische:r Staatsangehörige:r",
  "ressortissant indien" = "indische:r Staatsangehörige:r",
  "ressortissant iranien" = "iranische:r Staatsangehörige:r",
  "ressortissant iraquien" = "irakische:r Staatsangehörige:r",
  "ressortissant italien" = "italienische:r Staatsangehörige:r",
  "ressortissant ivoirien" = "ivorische:r Staatsangehörige:r",
  "ressortissant kosovar" = "kosovarische:r Staatsangehörige:r",
  "ressortissant libanais" = "libanesische:r Staatsangehörige:r",
  "ressortissant lituanien" = "lituanische:r Staatsangehörige:r",
  "ressortissant macédonien" = "mazedonische:r Staatsangehörige:r",
  "ressortissant malgache" = "madagassische:r Staatsangehörige:r",
  "ressortissant marocain" = "marokkanische:r Staatsangehörige:r",
  "ressortissant mauricien" = "mauritische:r Staatsangehörige:r",
  "ressortissant mexicain" = "mexikanische:r Staatsangehörige:r",
  "ressortissant monténégrin" = "montenegrinische:r Staatsangehörige:r",
  "ressortissant polonais" = "polnische:r Staatsangehörige:r",
  "ressortissant portugais" = "portugisische:r Staatsangehörige:r",
  "ressortissant roumain" = "rumänische:r Staatsangehörige:r",
  "ressortissant russe" = "russische:r Staatsangehörige:r",
  "ressortissant rwandais" = "ruandische:r Staatsangehörige:r",
  "ressortissant serbe" = "serbische:r Staatsangehörige:r",
  "ressortissant slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissant somalien" = "somalische:r Staatsangehörige:r",
  "ressortissant syrien" = "syrische:r Staatsangehörige:r",
  "ressortissant thaïlandais" = "thailändische:r Staatsangehörige:r",
  "ressortissant tunisien" = "tunesische:r Staatsangehörige:r",
  "ressortissant turc" = "türkische:r Staatsangehörige:r",
  "ressortissante algérienne" = "algerische:r Staatsangehörige:r",
  "ressortissante allemande" = "deutsche:r Staatsangehörige:r",
  "ressortissante américaine" = "amerikanische:r Staatsangehörige:r",
  "ressortissante belge" = "belgische:r Staatsangehörige:r",
  "ressortissante béninoise" = "beninische:r Staatsangehörige:r",
  "ressortissante brésilienne" = "brasilianische:r Staatsangehörige:r",
  "ressortissante britannique" = "britische:r Staatsangehörige:r",
  "ressortissante burkinabè" = "burkinische:r Staatsangehörige:r",
  "ressortissante chinoise" = "chinesische:r Staatsangehörige:r",
  "ressortissante coréenne" = "südkoreanische:r Staatsangehörige:r",
  "ressortissante croate" = "koratische:r Staatsangehörige:r",
  "ressortissante dominicaine" = "domenikanische:r Staatsangehörige:r",
  "ressortissante espagnole" = "spanische:r Staatsangehörige:r",
  "ressortissante française" = "französische:r Staatsangehörige:r",
  "ressortissante gabonaise" = "gabunische:r Staatsangehörige:r",
  "ressortissante indienne" = "indische:r Staatsangehörige:r",
  "ressortissante italienne" = "italienische:r Staatsangehörige:r",
  "ressortissante ivoirienne" = "ivorische:r Staatsangehörige:r",
  "ressortissante kosovare" = "kosovarische:r Staatsangehörige:r",
  "ressortissante lettone" = "lettische:r Staatsangehörige:r",
  "ressortissante libanaise" = "libanesische:r Staatsangehörige:r",
  "ressortissante marocaine" = "marokkanische:r Staatsangehörige:r",
  "ressortissante mauricienne" = "mauritische:r Staatsangehörige:r",
  "ressortissante paraguayenne" = "paraguayanische:r Staatsangehörige:r",
  "ressortissante polonaise" = "polnische:r Staatsangehörige:r",
  "ressortissante portugaise" = "portugisische:r Staatsangehörige:r",
  "ressortissante roumaine" = "rumänische:r Staatsangehörige:r",
  "ressortissante russe" = "russische:r Staatsangehörige:r",
  "ressortissante slovaque" = "slowakische:r Staatsangehörige:r",
  "ressortissante syrienne" = "syrische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante thaïlandaise" = "thailändische:r Staatsangehörige:r",
  "ressortissante tunisienne" = "tunesische:r Staatsangehörige:r",
  "ressortissante turque" = "türkische:r Staatsangehörige:r",
  "ressortissante ukrainienne" = "ukrainische:r Staatsangehörige:r",
  "ressortissante vietnamienne" = "vietnamesische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "ressortissante sud" = "südafrikanische:r Staatsangehörige:r",
  "citoyenne guinéenne" = "guineische:r Staatsangehörige:r",
  "citoyenne macédonienne" = "mazedonische:r Staatsangehörige:r",
  "Guinée-Bissau" = "guinea-bissauische:r Staatsangehörige:r",
  "Mauritius" = "mauritische:r Staatsangehörige:r",
  "verdischer Staatsangehörige" = "verdische:r Staatsangehörige:r",
  "vanuatuischer Staatsangehörige"  = "vanuatuische:rr Staatsangehörige:r"


  
              # Add more mappings here as needed. For example if the analysis is done for another year, where different names appear.
)


##################"Gesellschafter_counts_normal" focuses on all the "eingetragenen Personen"
#Replace non-German expressions with their German counterparts
Gesellschafter_counts_normal <- Gesellschafter_counts_normal %>%
  mutate(nationality = ifelse(nationality %in% names(mapping),
                              mapping[nationality],
                              nationality)) %>%
  mutate(nationality = as.character(nationality))


#Regroup and count the occurrences
Gesellschafter_counts_normal <- Gesellschafter_counts_normal %>%
  group_by(nationality) %>%
  summarize(count = sum(count))  # Replace 'n' with 'count'



##################"Gesellschafter_counts_spezial" focuses only on the "Geselschafter:innen
#Replace non-German expressions with their German counterparts
Gesellschafter_counts_spezial <- Gesellschafter_counts_spezial %>%
  mutate(nationality = ifelse(nationality %in% names(mapping),
                              mapping[nationality],
                              nationality)) %>%
  mutate(nationality = as.character(nationality))

#Regroup and count the occurrences
Gesellschafter_counts_spezial <- Gesellschafter_counts_spezial %>%
  group_by(nationality) %>%
  summarize(count = sum(count))  # Replace 'n' with 'count'



#Create new dichotomous variable for "Gesellschafter_counts_normal" and "Gesellschafter_counts_spezial"
Gesellschafter_counts_normal2 <- Gesellschafter_counts_normal %>% mutate(nat_dich = ifelse(nationality == "schweizer Staatsangehörige:r", "Schweizer:innen", "Ausländer:innen")) 

Gesellschafter_counts_spezial2 <- Gesellschafter_counts_spezial %>% mutate(nat_dich = ifelse(nationality == "schweizer Staatsangehörige:r", "Schweizer:innen", "Ausländer:innen")) 


#Create the two bar plots
##Bar plot for "Gesellschafter_counts_normal"
Robustheitsplot_GesellschafterandGeschäftsführer <- ggplot(Gesellschafter_counts_normal2, aes(x = reorder(nat_dich, count, FUN = sum), y = count)) +
  geom_bar(stat = "identity") +
  labs(x = "Nationalität", y = "Anzahl", title = "Nationalitäten der Gründer:innen von GmbHs mit allen eingetragenen Personen") +
  theme(legend.position = "bottom") + theme_minimal() + 
  theme(plot.title=element_text(face="bold", size=16, vjust=2, family="Times New Roman"),  
        axis.title.x=element_text(size=12, family="Times New Roman"),
        axis.title.y=element_text(size=12, family="Times New Roman"),
        axis.text.x = element_text(angle = 45, hjust = 1, size=12, family="Times New Roman"),
        axis.text.y=element_text(size=12, family="Times New Roman"),
        legend.text=element_text(size=12, family="Times New Roman"),
        legend.title=element_text(size=12, family="Times New Roman")
)


##Bar plot for "Gesellschafter_counts_spezial"
Robustheitsplot_onlyGesellschafter <- ggplot(Gesellschafter_counts_spezial2, aes(x = reorder(nat_dich, count, FUN = sum), y = count)) +
  geom_bar(stat = "identity") +
  labs(x = "Nationalität", y = "Anzahl", title = "Nationalitäten der Gründer:innen von GmbHs nur Gesellschafter:innen") +
  theme(legend.position = "bottom") + theme_minimal() + 
  theme(plot.title=element_text(face="bold", size=16, vjust=2, family="Times New Roman"),  
        axis.title.x=element_text(size=12, family="Times New Roman"),
        axis.title.y=element_text(size=12, family="Times New Roman"),
        axis.text.x = element_text(angle = 45, hjust = 1, size=12, family="Times New Roman"),
        axis.text.y=element_text(size=12, family="Times New Roman"),
        legend.text=element_text(size=12, family="Times New Roman"),
        legend.title=element_text(size=12, family="Times New Roman")
)

#Display plot 1
print(Robustheitsplot_GesellschafterandGeschäftsführer)

dev.copy(jpeg, filename = "Robustheitsplot_GesellschafterandGeschäftsführer.jpg", width = 1200, height = 800, units = "px", res = 100)
dev.off()

#Display plot 2
print(Robustheitsplot_onlyGesellschafter)

dev.copy(jpeg, filename = "Robustheitsplot_onlyGesellschafter.jpg", width = 1200, height = 800, units = "px", res = 100)
dev.off()

````


#Table for frequencies
This code generates a table and a bar plot showing the counts on how many individuals launch a new company separated by legal form.
```{r}
#Load the data
Firmengründungen2022 <- readRDS("Firmengründungen2022.Rds")

#Load the necessary packages
library(tidyverse)
library(stringr)
library(openxlsx)

#Create a new frequency table
Freq_table <- Firmengründungen2022 %>%
  mutate(words = str_split(owner_nationality_wcomp2, ",|;"),
         `Anzahl eingetragene Personen` = map_int(words, length)) %>%
  group_by(Rechtsform, `Anzahl eingetragene Personen`) %>%
  summarise(Anzahl = n()) %>%
  arrange(Rechtsform, `Anzahl eingetragene Personen`)


#Export the frequency table to excel
write.xlsx(Freq_table, "Freq_table.xlsx")


#Create a new variable that combines founders of 6 and above
##This step should ensure a better overview, because some few companies have up to 24 founders. All with 6 or more founders are now shown as one category.
Freq_table$`Anzahl eingetragene Personen` <- ifelse(Freq_table$`Anzahl eingetragene Personen` >= 6, 
                                                     "6 oder mehr", 
                                                     as.character(Freq_table$`Anzahl eingetragene Personen`))


#Aggregate the data for the new category
Freq_table <- Freq_table %>%
  group_by(`Anzahl eingetragene Personen`, Rechtsform) %>%
  summarise(Anzahl = sum(Anzahl))


#Bar Plot
barplotHäufigkeiten2022 <- ggplot(Freq_table, aes(x=`Anzahl eintableetragene Personen`, y=Anzahl, fill=Rechtsform)) +
  geom_bar(stat="identity", position="dodge") +
  scale_x_discrete() +
  theme_minimal() + 
  ggtitle("Häufigkeit der Anzahl genannten Personen") + 
  theme(plot.title=element_text(face="bold", size=42, vjust=2, family="Times New Roman"),  
        axis.title.x=element_text(vjust=-1, size=36, family="Times New Roman"),
        axis.title.y=element_text(size=36, family="Times New Roman"),
        axis.text.x=element_text(size=36, family="Times New Roman"),
        axis.text.y=element_text(size=36, family="Times New Roman"),
        legend.text=element_text(size=36, family="Times New Roman"),
        legend.title=element_text(size=36, family="Times New Roman")
)


#Save the bar plot
ggsave("barplotHäufigkeiten2022.jpg",  barplotHäufigkeiten2022, height= 8, width=12)


#Data quality control
Einzelunternehmen_2ormore <- Firmengründungen2022 %>%
  mutate(words = str_split(owner_nationality_wcomp2, ",|;"),
         `Anzahl eingetragene Personen` = map_int(words, length)) %>%
  filter(Rechtsform == "Einzelunternehmen" & `Anzahl eingetragene Personen` >= 2)

```




#Sectors/"Wirtschaftszweige" 2022
The following chunks entail all the code that was necessary to create the graphs displaying "Wirtschaftszweige".

##Step 1: Translation and extraction of "Zweck-Text" i.e. description of the purposes of the newly founded companies
```{r, eval = F}
#Translating "publication.text" to german, using the Google Cloud Translation API (Note: This code snippet only works when being authenticated for the Google Cloud Translation API via the package "googleLanguageR")
shab22_complete <- readRDS("shab22_complete.Rds")
shab22_complete <- shab22_complete %>% mutate(
  publicationText_translated = gl_translate(shab22_complete$publicationText, target = "de")$translatedText)

#Saving
write_rds(shab22_complete, "shab22_comp_translated.rds")

#Loading back in the file with translated text
shab22_translated <- readRDS("shab22_comp_translated.Rds")

#Function to extract text between "Zweck" (german signal word) or "But" (french signal word) and "Eingetragene Personen" or "Eingetragene Person"
extract_text_between <- function(text) {
  if (str_detect(text, "Zweck|Unternehmenszweck|Verwendungszweck|Gegenstand|Geltungsbereich|Angaben zur Zweigniederlassung|Ziel|Geschäftszweck|Einsatzzweck|Unternehmensgegenstand|Gegenstand des Unternehmens")) {
    extracted_text <- str_extract(text, "(?i)(Zweck|Unternehmenszweck|Verwendungszweck|Gegenstand|Geltungsbereich|Angaben zur Zweigniederlassung|Ziel|Geschäftszweck|Einsatzzweck|Unternehmensgegenstand|Gegenstand des Unternehmens).*?(Eingetragene Person(en)?|Stammkapital|\\Z)")
    
    #Remove "Eingetragene Person(en)" from the extracted text
    extracted_text <- str_remove(extracted_text, "(?i)(Eingetragene Person(en)?)$")
    return(str_trim(extracted_text))
  } else {
    return(NA)
  }
}

df_zweck <- shab22_translated %>%
  mutate(
    zweck_company = sapply(publicationText_translated, extract_text_between)
  )


#Save the data
saveRDS(df_zweck, "dataframe_ZweckeDE.Rds")


###############Check the NAs and merge the old data frame "df" with the new one with the translated and extracted purposes of the companies
#Read data
dataframe_ZweckeDE <- readRDS("dataframe_ZweckeDE.Rds")

#Investigating reasons for NAs
dataframe_ZweckeNA <- dataframe_ZweckeDE %>% filter(is.na(zweck_company))

#Merge both data frames
df_merged <- merge(df, dataframe_ZweckeDE[c('id', 'zweck_company')], by = 'id', all.x = TRUE)

#Create a new data frame where each row is TRUE if both 'owner_info' and 'zweck_company' are NA, and FALSE otherwise
both_na <- is.na(df_merged$owner_info) & is.na(df_merged$zweck_company)

#Count how many times both are NA
count_both_na <- sum(both_na)

#Create a new data frame where each row is TRUE if either 'owner_info' or 'zweck_company' are NA, and FALSE otherwise
either_na <- is.na(df_merged$owner_info) | is.na(df_merged$zweck_company)

#Count how many times either is NA
count_either_na <- sum(either_na)

# Print the counts
print(paste("Number of rows where both are NA: ", count_both_na))
print(paste("Number of rows where either is NA: ", count_either_na))

#Save data
saveRDS(df_merged, "df_mergedmitNA.Rds")
```

##Step 2: Manual annotation/coding of Zweck-Texte
###Preparation
```{r}
set.seed(123)
library(sampling)


#Read in the dataframe
df_mergedmitNA <- readRDS("df_mergedmitNA.rds")



#Creating the stratification variables to draw a stratified random sample for handcoding by classifying the language of the original descriptions
df_mergedmitNA <- df_mergedmitNA%>% mutate(
 stratvar_language = cld3::detect_language(publicationText),

 ID = row_number()
)

#Manual correction for cases in which language classification failed
df_mergedmitNA_langna <- df_mergedmitNA %>% select(publicationText, stratvar_language, ID) %>% filter(is.na(stratvar_language))
df_mergedmitNA$stratvar_language[c(2098,2858,3079,3213,6196,9401,18939,23071,24478,32790,36293,40906,41045,45145,45666,47570,48370,49649)] <- "de"
df_mergedmitNA$stratvar_language[c(10512, 17728, 31016, 33463, 36042,42937,48757)] <- "fr"
df_mergedmitNA$stratvar_language[c(22523, 46214, 33108, 40803)] <- "it"


table(df_mergedmitNA$stratvar_language, useNA="ifany") #No more NA's left


#Some additional cleaning of the "Zweck"-Column
patterns <- c("^Zweck:", "^Gegenstand:", "^Ziel:")


df_mergedmitNA$zweck_cleaned <- df_mergedmitNA$zweck_company 
for (pattern in patterns) {
  df_mergedmitNA$zweck_cleaned <- str_replace(df_mergedmitNA$zweck_cleaned, pattern, "")
}


#Excluding NA's
df_nozweckna <- df_mergedmitNA %>% filter(!is.na(zweck_cleaned))


#Pulling a stratified sample
#Create a new data frame that contains the strata as well as their size and their inclusion probability
df_nozweckena_strat <- df_nozweckna %>%
 group_by(stratvar_language) %>% #stratifying by language
 summarise(n_h = n()) %>% #Calculating the number of obs. in each group
 ungroup() %>%
 mutate(prop_h = n_h/nrow(df_nozweckna))
#new variable (prop_h) shows propability of observation in each group


#Proportional allocation
df_sampleobject <- sampling::strata(data = df_nozweckna, stratanames = c("stratvar_language"), size = c(df_nozweckena_strat$n_h*1002/sum(df_nozweckena_strat$n_h)), method = "srswor")


#stratified sample of size 1,000 without replacement
df22_stratsample <- getdata(data = df_nozweckna, m = df_sampleobject) #extract strat. sample
df22_stratsample <- merge(df22_stratsample, df_nozweckena_strat, by = c("stratvar_language"))
#merges shab22_stratsample object (which contains the stratified sample) with the
#shab22_strat object (which contains the stratification information) based on variables (by)



#Checking if the sample is representative
#Real value
prop.table(table(df_nozweckna$stratvar_language, useNA="ifany")) #prop of obs in original dataset
prop.table(table(df22_stratsample$stratvar_language, useNA="ifany")) #prop in stratified sample
#Proportions are very close to the real numbers







#Randomize the order of the dataframe to ensure that not every coder starts with the same observation. Learning progress should not be made on the same observations but on different once
df22_stratsample_orlando <- df22_stratsample[sample(nrow(df22_stratsample)), ]
df22_stratsample_ronja <- df22_stratsample[sample(nrow(df22_stratsample)), ]
df22_stratsample_fatos <- df22_stratsample[sample(nrow(df22_stratsample)), ]
df22_stratsample_jonas <- df22_stratsample[sample(nrow(df22_stratsample)), ]


#Splitting the dataset into smaller coding jobs and saving them
split_and_save_dataset <- function(dataset, output_dir) {
  num_rows <- nrow(dataset)
  split_size <- num_rows / 4

  #Split the dataset into four equally sized dataframes
  job1 <- dataset[1:split_size, ]
  job2 <- dataset[(split_size + 1):(2 * split_size), ]
  job3 <- dataset[(2 * split_size + 1):(3 * split_size), ]
  job4 <- dataset[(3 * split_size + 1):num_rows, ]
  
  # Save the four dataframes as RDS files
  saveRDS(job1, file.path(output_dir, "job1.rds"))
  saveRDS(job2, file.path(output_dir, "job2.rds"))
  saveRDS(job3, file.path(output_dir, "job3.rds"))
  saveRDS(job4, file.path(output_dir, "job4.rds"))
}


output_directory1 <- "handcoding/orlando"
output_directory2 <- "handcoding/ronja"
output_directory3 <- "handcoding/fatos"
output_directory4 <- "handcoding/jonas"

split_and_save_dataset(df22_stratsample_orlando, output_directory1)
split_and_save_dataset(df22_stratsample_ronja, output_directory2)
split_and_save_dataset(df22_stratsample_fatos, output_directory3)
split_and_save_dataset(df22_stratsample_jonas, output_directory4)


#Saving the datasets
write_rds(df_nozweckna, "handcoding/df_nozweckna,.rds")
write_rds(df22_stratsample, "handcoding/df22_stratsample.rds")
write_rds(df22_stratsample_orlando, "handcoding/df22_stratsample_orlando.rds")
write_rds(df22_stratsample_ronja, "handcoding/df22_stratsample_ronja.rds")
write_rds(df22_stratsample_fatos, "handcoding/df22_stratsample_fatos.rds")
write_rds(df22_stratsample_jonas, "handcoding/df22_stratsample_jonas.rds")
```



###Manual annotation
The following code chunks entails the calibration and execution of the annotation interface that was used for handcoding the Zwecktexte. The chunk was executed by each coder separately. The four different annotationsfiles were then merged in the next section.
```{r}
#Install annotinder with remotes::install_github('ccs-amsterdam/annotinder-r')
library(annotinder)
library(conflicted)
library(quanteda)
library(tidyverse)
library(DescTools)
library(irr)


#Read in the datasets
job1 <- readRDS("handcoding/jonas/job1.rds")
job2 <- readRDS("handcoding/jonas/job2.rds")
job3 <- readRDS("handcoding/jonas/job3.rds")
job4 <- readRDS("handcoding/jonas/job4.rds")

#Set up the annotation interface
minijob <- head(job1)

units <- create_units(
  minijob,
  set_text(name = "zweck_cleaned", value = zweck_cleaned),
  id = "id"
)
units

zwecke <- question(
  name = "zweck",
  question = "Welchen Zweck hat diese Firma?",
  codes = c(
    orange = "1 Land- und Forstwirtschaft",
    grey = "2 Verarbeitendes Gewerbe/Energieversorgung",
    blue = "3 Baugewerbe",
    azure = "4 Handel, Reparaturgewerbe",
    burlywood = "5 Verkehr und Lagerei",
    coral = "6 Gastgewerbe",
    DarkGrey = "7 Information und Kommunikation",
    GhostWhite = "8 Kredit- und Versicherungsgewerbe",
    GoldenRod = "9 Immobilien, sonstige wirtschaftliche Dienstleistungen",
    LightSalmon = "10 Freiberufliche, wissenschaftliche und technische Dienstleistungen",
    LightYellow = "11 Öffentliche Verwaltung und exterritoriale Körperschaften",
    MintCream = "12 Erziehung und Unterricht",
    Olive = "13 Gesundheits- und Sozialwesen",
    Peru = "14 Kunst und Unterhaltung",
    PowderBlue = "15 Sonstige und persönliche Dienstleistungen, sowie private Haushalte",
    SandyBrown = "16 Nicht zuweisbar"
  )
)
zwecke


codebook <- create_codebook(zwecke)
codebook

minijobfile <- create_job(
  title = "minijob",
  units = units,
  codebook = codebook
)
minijobfile

minijob_db1 <- create_job_db(minijobfile, overwrite = F)
minijob_db1 

#Open annotation interface and start annotating
start_annotator(minijob_db1, background = TRUE)

#Retrieve the saved annotations
minijob <- gimme_annotations("annotinder_jobs/minijob.db")
job1 <- gimme_annotations("annotinder_jobs/job1.db")
job2 <- gimme_annotations("annotinder_jobs/job2.db")
job3 <- gimme_annotations("annotinder_jobs/job3.db")
job4 <- gimme_annotations("annotinder_jobs/job4.db")

#Save
write_rds(minijob, "handcoding/minijob.rds")
write_rds(job1, "handcoding/job1_coded.rds")
write_rds(job2, "handcoding/job2_coded.rds")
write_rds(job3, "handcoding/job3_coded.rds")
write_rds(job4, "handcoding/job4_coded.rds")


jonas_all <- rbind(job1, job2, job3, job4)
write_rds(jonas_all, "handcoding/jonas_all.rds")
```

###Merging the annotations and finding an agreement
```{r}
#Adding the codes together
df22_stratsample_jonas <- readRDS("handcoding/df22_stratsample_jonas.rds")
jonas_all <- readRDS("handcoding/done/jonas_all.rds")
fatos_all <- readRDS("handcoding/done/fatos_all.rds")
ronja_all <- readRDS("handcoding/done/ronja_all.rds")
orlando_all <- readRDS("handcoding/done/orlando_all.rds")

fatos_all <- fatos_all %>% rename(code_fatos = value)
jonas_all <- jonas_all %>% rename(code_jonas = value)
ronja_all <- ronja_all %>% rename(code_ronja = value)
orlando_all <- orlando_all %>% rename(code_orlando = value)

stratsample_coded <- left_join(df22_stratsample_jonas, jonas_all, by =c("id" = "id"))
stratsample_coded <- left_join(stratsample_coded, fatos_all[,c(1,4)], by=c("id" = "id"))
stratsample_coded <- left_join(stratsample_coded, ronja_all[,c(1,4)], by=c("id" = "id"))
stratsample_coded <- left_join(stratsample_coded, orlando_all[,c(1,4)], by=c("id" = "id"))


#Calculating match-metrics
stratsample_coded <- stratsample_coded %>% mutate(
  code_jonas_n = as.numeric(str_extract(code_jonas, "\\d+")),
  code_fatos_n = as.numeric(str_extract(code_fatos, "\\d+")),
  code_ronja_n = as.numeric(str_extract(code_ronja, "\\d+")),
  code_orlando_n = as.numeric(str_extract(code_orlando, "\\d+")),
  code_match_all = case_when(
    code_jonas == code_orlando & code_jonas == code_ronja & code_jonas == code_fatos ~ T,
    T ~ F
  ),
  
  code_mode_raw = pmap_chr(select(., code_jonas:code_orlando), ~ {
    values <- c(...)
    mode <- names(table(values))[which.max(table(values))]
    mode
  })

) %>%
  rowwise() %>%
  mutate(
    match_count = sum(lengths(unique(c_across(code_jonas_n:code_orlando_n))))
) %>% ungroup(
  
) %>% mutate(
  match_desc = case_when(
    match_count == 1 ~ "4vs0",
    match_count == 4 ~ "4vs4",
    match_count == 3 ~ "2vs1vs1",
    match_count == 2 ~ case_when(
      code_jonas_n == code_fatos_n & code_jonas_n == code_ronja_n ~ "3vs1",
      code_jonas_n == code_fatos_n & code_jonas_n == code_orlando_n ~ "3vs1",
      code_jonas_n == code_ronja_n & code_jonas_n == code_orlando_n ~ "3vs1",
      code_fatos_n == code_ronja_n & code_fatos_n == code_orlando_n ~ "3vs1",
      TRUE ~ "2vs2"
    ),
    TRUE ~ NA_character_
  ),
   code_mode = case_when(
     match_desc == "4vs0" ~ code_mode_raw,
     match_desc == "3vs1" ~ code_mode_raw,
     T ~ NA_character_),
  code_mode2vs1vs1 = case_when(
     match_desc == "4vs0" ~ code_mode_raw,
     match_desc == "3vs1" ~ code_mode_raw,
     match_desc == "2vs1vs1" ~ code_mode_raw,
     T ~ NA_character_),
  code_mode_n = as.numeric(str_extract(code_mode, "\\d+")),
  code_mode2vs1vs1_n = as.numeric(str_extract(code_mode2vs1vs1, "\\d+"))
  )


table(stratsample_coded$match_desc)

#Calculating pairwise intercoderreliability metric
ratertab <- xtabs (~ stratsample_coded$code_jonas + stratsample_coded$code_orlando)
DescTools::CohenKappa(ratertab, conf.level = 0.95)

#Fleiss Cappa for all coders together
coder_matrix <- as.matrix(stratsample_coded[, c("code_jonas", "code_fatos", "code_ronja", "code_orlando")])
irr::kappam.fleiss(coder_matrix)


#Agreement
#Filtering cases with disagreements
stratsample_discussion <- stratsample_coded |> filter(match_desc != "4vs0" & match_desc != "3vs1") |> select(id, zweck_cleaned, code_jonas:code_orlando, match_count:code_mode2vs1vs1_n)

#Manual imputation based on discussion in team meeting
stratsample_discussion$code_mode_n[c(29,47,85,93,115)] <- 1
stratsample_discussion$code_mode_n[c(2,3,15,23,43,45,60,77,81,84,100,109,118,126,129,133)] <- 2
stratsample_discussion$code_mode_n[c(50,72,92,96,101,108,116,119)] <- 3
stratsample_discussion$code_mode_n[c(1,12,49,79,98,110)] <- 4
stratsample_discussion$code_mode_n[c(145)] <- 5
stratsample_discussion$code_mode_n[c(71,111)] <- 6
stratsample_discussion$code_mode_n[c(4,27,40,70,74,91,112)] <- 7
stratsample_discussion$code_mode_n[c(13,30,48,57,61,64,65,67,75,82,97,123,124,125,137)] <- 8
stratsample_discussion$code_mode_n[c(28,31,32,33,34,35,54,95,99,127,131,138,140)] <- 9
stratsample_discussion$code_mode_n[c(6,7,9,10,14,22,26,41,44,51,53,58,59,62,66,73,78,89,102,105,106,117,120,128,130,132,134,142,143)] <- 10
stratsample_discussion$code_mode_n[c()] <- 11
stratsample_discussion$code_mode_n[c(11,17,39,63,103,114,139,141)] <- 12
stratsample_discussion$code_mode_n[c(5,69,107)] <- 13
stratsample_discussion$code_mode_n[c(8,21,38,56,121,135)] <- 14
stratsample_discussion$code_mode_n[c(18,19,20,25,36,37,42,52,55,68,76,80,83,87,88,90,94,104,113,122,144,146)] <- 15
stratsample_discussion$code_mode_n[c(16,24,46,86,136)] <- 16


#Imputing new codes into the final dataframe
stratsample_coded_final <- stratsample_coded
stratsample_coded_final$code_mode_n[stratsample_coded_final$id %in% stratsample_discussion$id] <- stratsample_discussion$code_mode_n

#Calculating majority vote baseline to evaluate the performance of the classifier afterwards
table(stratsample_coded_final$code_mode_n)/1000*100


#Saving
write_rds(stratsample_discussion, "handcoding/stratsample_discussion.rds")
write_rds(stratsample_coded_final, "handcoding/stratsample_coded_final.rds")
```



##Step 3: Training the classifier
The following code chunks entail all code that was necessary to train the machine learning classifier.
###Preparation
```{r}
library(conflicted)
library(glmnet)
library(gt)
library(textrecipes)
library(themis)
library(tidymodels)
library(tidyverse)
library(vip)
library(dials)
library(doParallel)
library(bonsai)
library(janitor)
library(texreg)
library(tictoc)
library(usemodels)
library(lightgbm)
conflicts_prefer(
  dplyr::filter,
  dplyr::slice,
  vip::vi
)




#Read in the annotated dataset
df_training <- readRDS("handcoding/stratsample_coded_final.rds")



#Set ggplot theme
theme_set(
  theme_minimal() +
    theme(
      plot.title = element_text(face = "bold"),
      plot.title.position = "plot",
      legend.position = "top",
      panel.grid.minor = element_blank()
    )
)

#Use colorblind-friendly color palette
okabe_ito <- unname(palette.colors(palette = "Okabe-Ito")[c(2:8, 1)])
options(ggplot2.continuous.color = okabe_ito)
options(ggplot2.continuous.colour = okabe_ito)
options(ggplot2.continuous.fill = okabe_ito)
options(ggplot2.discrete.color = okabe_ito)
options(ggplot2.discrete.colour = okabe_ito)
options(ggplot2.discrete.fill = okabe_ito)




#Turn off scientific notation
options(scipen = 999)



#Clean the data
#Impute corrected Rechtsform-data
df_training <- left_join(df_training, Firmengründungen2022[,c("id","Rechtsform")])

#Deleting cases in which the category could not be determined by the human coders and recoding
df_training <- df_training |> filter(code_mode_n != 16)
df_training <- df_training |> mutate(
  
  company_sector = factor(case_when(
                          code_mode_n == 1 ~ "2 Verarbeitendes Gewerbe/Energieversorgung",
                          code_mode_n == 2 ~ "2 Verarbeitendes Gewerbe/Energieversorgung",
                          code_mode_n == 3 ~ "3 Baugewerbe",
                          code_mode_n == 4 ~ "4 Handel, Reparaturgewerbe",
                          code_mode_n == 5 ~ "5 Verkehr und Lagerei",
                          code_mode_n == 6 ~ "6 Gastgewerbe",
                          code_mode_n == 7 ~ "7 Information und Kommunikation",
                          code_mode_n == 8 ~ "8 Kredit- und Versicherungsgewerbe",
                          code_mode_n == 9 ~ "9 Immobilien, sonstige wirtschaftliche Dienstleistungen",
                          code_mode_n == 10 ~ "10 Freiberufliche, wissenschaftliche und technische Dienstleistungen",
                          code_mode_n == 12 ~ "12 Erziehung und Unterricht",
                          code_mode_n == 13 ~ "13 Gesundheits- und Sozialwesen",
                          code_mode_n == 14 ~ "14 Kunst und Unterhaltung",
                          code_mode_n == 15 ~ "15 Sonstige und persönliche Dienstleistungen, Unterhaltung, sowie private Haushalte",
                          T ~ NA_character_
                                       ), levels = c("2 Verarbeitendes Gewerbe/Energieversorgung", "3 Baugewerbe", "4 Handel, Reparaturgewerbe", "5 Verkehr und Lagerei", "6 Gastgewerbe","7 Information und Kommunikation", "8 Kredit- und Versicherungsgewerbe", "9 Immobilien, sonstige wirtschaftliche Dienstleistungen", "10 Freiberufliche, wissenschaftliche und technische Dienstleistungen", "12 Erziehung und Unterricht", "13 Gesundheits- und Sozialwesen","14 Kunst und Unterhaltung", "15 Sonstige und persönliche Dienstleistungen, Unterhaltung, sowie private Haushalte" )),
  
  
    zweck_cleaned2 = ifelse(str_detect(zweck_cleaned, "(?i)(?<=Die Gesellschaft kann|Das Einzelunternehmen kann|Kann Zweigniederlassungen und Tochtergesellschaften|Zweig- oder Tochtergesellschaften im In- und Ausland errichten|Sie kann Zweigniederlassungen|Sie kann Agenturen|Sie kann Tochtergesellschaften|Im Allgemeinen darf die Gesellschaft|Im Allgemeinen darf das Einzelunternehmen|Zu diesem Zweck kann die Gesellschaft|Zu diesem Zweck kann das Einzelunternehmen|Die Gesellschaft kann alle Geschäfte tätigen|Das Einzelunternehmen kann alle Geschäftige tätigen|Die Gesellschaft darf|Das Einzelunternehmen darf|Die Stiftung kann|Die Stiftung darf|Die Genossenschaft kann|Die Genossenschaft darf|Publikationsorgan: Schweizerisches Handelsamtsblatt|Publikationsorgan: SHAB|Darüber hinaus kann die Gesellschaft|Darüber hinaus kann das Einzelunternehmen|Darüber hinaus kann die Genossenschaft|Darüber hinaus kann die Stiftung|Das Unternehmen kann|Das Unternehmen darf|Mit Ausnahme der durch das Bundesgesetz über den Erwerb von Grundstücken durch Personen im Ausland (LFAIE) verbotenen Geschäfte|Kann Zweigniederlassungen errichten|Kann Tochterunternehmen errichten|Die Firma kann|Die Firma darf|Aktienkapital: CHF|Die Unternehmung kann|Die Unternehmung darf).*"),
                                 str_replace(zweck_cleaned, "(?i)(Die Gesellschaft kann|Das Einzelunternehmen kann|Kann Zweigniederlassungen und Tochtergesellschaften|Zweig- oder Tochtergesellschaften im In- und Ausland errichten|Sie kann Zweigniederlassungen|Sie kann Agenturen|Sie kann Tochtergesellschaften|Im Allgemeinen darf die Gesellschaft|Im Allgemeinen darf das Einzelunternehmen|Zu diesem Zweck kann die Gesellschaft|Zu diesem Zweck kann das Einzelunternehmen|Die Gesellschaft kann alle Geschäfte tätigen|Das Einzelunternehmen kann alle Geschäftige tätigen|Die Gesellschaft darf|Das Einzelunternehmen darf|Die Stiftung kann|Die Stiftung darf|Die Genossenschaft kann|Die Genossenschaft darf|Publikationsorgan: Schweizerisches Handelsamtsblatt|Publikationsorgan: SHAB|Darüber hinaus kann die Gesellschaft|Darüber hinaus kann das Einzelunternehmen|Darüber hinaus kann die Genossenschaft|Darüber hinaus kann die Stiftung|Das Unternehmen kann|Das Unternehmen darf|Mit Ausnahme der durch das Bundesgesetz über den Erwerb von Grundstücken durch Personen im Ausland (LFAIE) verbotenen Geschäfte|Kann Zweigniederlassungen errichten|Kann Tochterunternehmen errichten|Die Firma kann|Die Firma darf|Aktienkapital: CHF|Die Unternehmung kann|Die Unternehmung darf).*", ""),
                                 zweck_cleaned),
  
  zweck_cleaned3 = str_replace_all(zweck_cleaned2, 
                                    "\\s*\\b(Die Unternehmung bezweckt|Das Unternehmen bezweckt|Die Gesellschaft bezweckt|Die Firma bezweckt|Gegenstand des Unternehmens|Unternehmensgegenstand:|Das Einzelunternehmen|Zweck des Unternehmens|Zweck der Gesellschaft|Geschäftszweck|Gegenstand des Unternehmens:|Unternehmensgegenstand:ist|Gegenstand und Zweck des Unternehmens ist|Der Zweck der Gesellschaft ist|Der Zweck des Unternehmens|Die Stiftung bezweckt|Die Stiftung will|Der Verein will|Der Verein bezweckt|Die Ziele des Unternehmens sind|Das Ziel des Unternehmens ist|bezweckt|Zweck|Unternehmensgegenstand|:)\\b\\s*",""),
    
  rechtsform_train = ifelse(is.na(Rechtsform), "Anderes", Rechtsform)
  
)

#Remove extra white spaces and ":"
df_training$zweck_cleaned2 <- str_squish(df_training$zweck_cleaned3)
df_training$zweck_cleaned2 <- gsub(":", "", df_training$zweck_cleaned2)




#Split data into training and test sets
set.seed(4321)
df_training_split <- initial_split(df_training, prop = 0.7)

df_train <- training(df_training_split)
df_test <- testing(df_training_split)


#Create folds for cross-validation
set.seed(4321)
df_folds <- vfold_cv(df_training, v = 5)


#Build a recipe (formula and preprocessing steps)
recipe <-
  recipe(company_sector ~ zweck_cleaned2 + rechtsform_train, data = df_train) |>
  step_tokenize(c(zweck_cleaned2,rechtsform_train), token = "words", options = list(strip_numeric = TRUE)) |>
  step_stopwords(c(zweck_cleaned2,rechtsform_train), language = "de") |>
  step_stem(c(zweck_cleaned2,rechtsform_train)) |>
  step_tfidf(c(zweck_cleaned2, rechtsform_train)) |> #this is a normalized term-feature matrix, that accounts for different text lengths
  step_normalize(all_predictors()) |>
  #step_upsample(company_sector) |> #Accounts for inbalance in category occurence. 
  step_smote(company_sector, neighbors = 5) #More complex approach to account for inbalance in dataset


#How does the data look like?
# Apply the preprocessing steps to the training data
baked_train <- recipe |> prep() |> bake(new_data = NULL)
baked_train

# Apply the preprocessing steps to the test data
baked_test <- recipe |> prep() |> bake(new_data = df_test)
baked_test
```



###Applying the Algorithms and checking their performance
####Lasso-Regression
```{r}
#Specifiying the model
lasso_spec <-
  multinom_reg(penalty = tune(), mixture = 1) |>
  set_mode("classification") |>
  set_engine("glmnet")

#Mixture = lasso parameter if it is 1. If it is set to 0, we get ridge regression -> We thus choose to fit lasso regression


#Defining the workflow 
lasso_workflow <-
  workflow() |>
  add_recipe(recipe) |>
  add_model(lasso_spec)


#Tuning the model -> Finding out what the best alpha for the lasso regression is
#Inspect ranges set for hyperparameters that we can tune
penalty()

#Create a grid of values for tuning -> generates 100 different values of lambda
lambda_grid <- grid_regular(penalty(), levels = 100)

#Now it’s time to tune the grid, using our workflow object.
tic()
set.seed(1234)
lasso_tune <- lasso_workflow |>
  tune_grid(
    resamples = df_folds,
    grid = lambda_grid,
    control = control_resamples(save_pred = TRUE)
  )
toc()

#Inspecting the performance of the different tuning models
lasso_tune |> collect_metrics()
lasso_tune |> show_best("roc_auc") #better metric
lasso_tune |> show_best("accuracy")
lasso_tune |> select_best("roc_auc")
lasso_tune |> select_best("accuracy")

#Figure to compare performance of different parameters
lasso_tune |>
  collect_metrics() |>
  ggplot() +
  aes(
    x = penalty,
    y = mean,
    color = .metric,
    ymin = mean - std_err,
    ymax = mean + std_err
  ) +
  geom_line(show.legend = FALSE) +
  geom_errorbar(show.legend = FALSE) +
  facet_wrap(~.metric, scales = "free", nrow = 2) +
  scale_x_log10()


#Select best roc_auc
lasso_final <- lasso_workflow |>
  finalize_workflow(parameters = lasso_tune |> select_best("roc_auc")) #we feed in the best penalty value


#Out-of-sample prediction for test dataset
lasso_last_fit <- lasso_final |>
  last_fit(split = df_training_split)
```



#####Performance-Checking
```{r}
#Obtain test performance
lasso_last_fit |>
  collect_metrics()

#Create the confusion matrix
conf_mat <- lasso_last_fit |>
  collect_predictions() |>
  conf_mat(truth = company_sector, estimate = .pred_class)

# Plot the confusion matrix
conf_mat |> autoplot(type = "heatmap")
conf_mat |> autoplot(type = "mosaic")

# Create a table of the performance metrics
conf_mat |>
  summary() |>
  select(Metric = .metric, Estimate = .estimate) |>
  filter(Metric %in% c("accuracy", "sens", "spec", "precision", "recall", "f_meas")) |>
  mutate(
    Metric = factor(Metric,
      levels = c("f_meas", "accuracy", "precision", "recall", "sens", "spec"),
      labels = c("F1 Score", "Accuracy", "Precision", "Recall", "Sensitivity", "Specificity")
    )
  ) |>
  arrange(Metric) |>
  gt() |>
  cols_align("left") |>
  fmt_number(columns = 2, decimals = 2) |>
  tab_header(title = "Test Set Classification Performance Metrics")
```


####Ridge-Regression
```{r}
#Specifiying the model
ridge_spec <-
  multinom_reg(penalty = tune(), mixture = 0) |>
  set_mode("classification") |>
  set_engine("glmnet")


#Defining the workflow -> helps to manage modeling pipelines
ridge_workflow <-
  workflow() |>
  add_recipe(recipe) |>
  add_model(ridge_spec)


#Tuning the model
penalty()

#Create a grid of values for tuning -> generates 100 different values of lambda
lambda_grid <- grid_regular(penalty(), levels = 100)

#Now it’s time to tune the grid, using our workflow object.
tic()
set.seed(1234)
ridge_tune <- lasso_workflow |>
  tune_grid(
    resamples = df_folds,
    grid = lambda_grid,
    control = control_resamples(save_pred = TRUE)
  )
toc()

#Inspecting the performance of the different tuning models
ridge_tune |> collect_metrics()
ridge_tune |> show_best("roc_auc") #better metric
ridge_tune |> show_best("accuracy")
ridge_tune |> select_best("roc_auc")
ridge_tune |> select_best("accuracy")

#Figure to compare performance of different parameters
ridge_tune |>
  collect_metrics() |>
  ggplot() +
  aes(
    x = penalty,
    y = mean,
    color = .metric,
    ymin = mean - std_err,
    ymax = mean + std_err
  ) +
  geom_line(show.legend = FALSE) +
  geom_errorbar(show.legend = FALSE) +
  facet_wrap(~.metric, scales = "free", nrow = 2) +
  scale_x_log10()

# Select best roc_auc
ridge_final <- ridge_workflow |>
  finalize_workflow(parameters = ridge_tune |> select_best("roc_auc")) #we feed in the best penalty value


# Out-of-sample prediction
ridge_last_fit <- ridge_final |>
  last_fit(split = df_training_split)
```

#####Performance Checking
```{r}
#Obtain test performance
ridge_last_fit |>
  collect_metrics()

#Create the confusion matrix
conf_mat <- ridge_last_fit |>
  collect_predictions() |>
  conf_mat(truth = company_sector, estimate = .pred_class)

#Plot the confusion matrix
conf_mat |> autoplot(type = "heatmap")
conf_mat |> autoplot(type = "mosaic")

#Table of the performance metrics
conf_mat |>
  summary() |>
  select(Metric = .metric, Estimate = .estimate) |>
  filter(Metric %in% c("accuracy", "sens", "spec", "precision", "recall", "f_meas")) |>
  mutate(
    Metric = factor(Metric,
      levels = c("f_meas", "accuracy", "precision", "recall", "sens", "spec"),
      labels = c("F1 Score", "Accuracy", "Precision", "Recall", "Sensitivity", "Specificity")
    )
  ) |>
  arrange(Metric) |>
  gt() |>
  cols_align("left") |>
  fmt_number(columns = 2, decimals = 2) |>
  tab_header(title = "Test Set Classification Performance Metrics")
```



####Elastic Net-Regression
This was the model that we used in the end because it had the best performance of all the models
```{r}
#Specify the model
elastic_spec <- 
  multinom_reg(penalty = tune(), mixture = tune()) |>
  set_mode("classification") |>
  set_engine("glmnet")

#Define the workflow
elastic_workflow <- 
  workflow() |>
  add_recipe(recipe) |>
  add_model(elastic_spec)

#Tune the model
lambda_grid <- grid_regular(penalty(), mixture(), levels = 20)


#Now it’s time to tune the grid, using our workflow object.
tic()
set.seed(1234)
elastic_tune <- elastic_workflow |>
  tune_grid(
    resamples = df_folds,
    grid = lambda_grid,
    control = control_resamples(save_pred = TRUE)
  )
toc()


# Save tuning results
elastic_tune |>
  write_rds("classifier/Elastic_tuned_nr.rds")

# Retrieve the saved tuning results
elastic_tune <- read_rds("classifier/Elastic_tuned_nr.rds")

#Select model and finalize workflow
elastic_final <- elastic_workflow |>
  finalize_workflow(parameters = elastic_tune |> select_best("roc_auc"))

#Fit the model on the test data
elastic_last_fit <- elastic_final |>
  last_fit(split = df_training_split)
```


#####Performance-Checking
```{r}
#Obtain test performance
elastic_last_fit |>
  collect_metrics()

#Create the confusion matrix
conf_mat <- elastic_last_fit |>
  collect_predictions() |>
  conf_mat(truth = company_sector, estimate = .pred_class)

# Plot the confusion matrix
conf_mat_plot <- autoplot(conf_mat, type = "heatmap")  + theme_minimal() + 
  scale_x_discrete(labels = c("2","3","4","5","6","7","8","9","10","12","13","14","15")) + 
  scale_y_discrete(labels = function(labels) str_wrap(labels, width = 50)) +
  ylab("Automatische Kategorisierung") + 
  xlab("Manuelle Kategorisierung") +
  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=0), 
        legend.title = element_text(size=20),
        legend.position = "none",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18))

ggsave(
  "plots/conf_mat_plot.jpg",
  plot = conf_mat_plot, height= 8, width=12)



# Create a table of the performance metrics
conf_mat |>
  summary() |>
  select(Metric = .metric, Estimate = .estimate) |>
  filter(Metric %in% c("accuracy", "sens", "spec", "precision", "recall", "f_meas")) |>
  mutate(
    Metric = factor(Metric,
      levels = c("f_meas", "accuracy", "precision", "recall", "sens", "spec"),
      labels = c("F1 Score", "Accuracy", "Precision", "Recall", "Sensitivity", "Specificity")
    )
  ) |>
  arrange(Metric) |>
  gt() |>
  cols_align("left") |>
  fmt_number(columns = 2, decimals = 2) |>
  tab_header(title = "Test Set Classification Performance Metrics")


#Variable importance plot
best_roc_auc <- elastic_tune |> select_best("roc_auc")

elastic_importance <- elastic_last_fit |>
  extract_fit_parsnip() |>
  vi(lambda = best_roc_auc$penalty, num_features = 20)

elastic_importance |>
  mutate(
    Importance = abs(Importance),
    Variable = str_remove_all(Variable, "tfidf_text_")
  ) |>
  group_by(Sign) |>
  arrange(desc(Importance)) |>
  slice_head(n = 30) |>
  ungroup() |>
  ggplot(aes(
    x = Importance,
    y = fct_reorder(Variable, Importance),
    fill = Sign
  )) +
  geom_col(show.legend = FALSE) +
  scale_x_continuous(expand = c(0, 0)) +
  facet_wrap(~Sign, scales = "free") +
  labs(
    title = "Variable Importance for Predicting Uncivil Tweets",
    y = NULL
  )



#ROC-Curve
library(yardstick)
roc_plot <- elastic_tune |>
  collect_predictions() |> mutate(company_sector2 = factor(case_when(
                          company_sector == "2 Verarbeitendes Gewerbe/Energieversorgung" ~ "2 Verarbeitendes",
                          company_sector == "3 Baugewerbe"~ "3 Baugewerbe",
                          company_sector == "4 Handel, Reparaturgewerbe" ~ "4 Handel",
                          company_sector == "5 Verkehr und Lagerei" ~ "5 Verkehr",
                          company_sector == "6 Gastgewerbe" ~ "6 Gastgewerbe",
                          company_sector == "7 Information und Kommunikation" ~ "7 Information",
                          company_sector == "8 Kredit- und Versicherungsgewerbe" ~ "8 Kredit",
                          company_sector == "9 Immobilien, sonstige wirtschaftliche Dienstleistungen" ~ "9 Immobilien",
                          company_sector == "10 Freiberufliche, wissenschaftliche und technische Dienstleistungen" ~ "10 Freiberufliche",
                          company_sector == "12 Erziehung und Unterricht" ~ "12 Erziehung",
                          company_sector == "13 Gesundheits- und Sozialwesen" ~ "13 Gesundheits",
                          company_sector == "14 Kunst und Unterhaltung" ~ "14 Kunst",
                          company_sector == "15 Sonstige und persönliche Dienstleistungen, Unterhaltung, sowie private Haushalte" ~ "15 Sonstige",
                          T ~ NA_character_
                                       ), levels = c("2 Verarbeitendes","3 Baugewerbe", "4 Handel", "5 Verkehr", "6 Gastgewerbe", "7 Information", "8 Kredit", "9 Immobilien", "10 Freiberufliche", "12 Erziehung", "13 Gesundheits", "14 Kunst", "15 Sonstige"))) |> group_by(id) |>
  roc_curve(truth = company_sector2, `.pred_2 Verarbeitendes Gewerbe/Energieversorgung`:`.pred_15 Sonstige und persönliche Dienstleistungen, Unterhaltung, sowie private Haushalte`)|>
  autoplot() + theme_minimal() +
  labs(
    x = "False Positive Rate \n(1 - Specificity)",
    y = "True Positive Rate \n(Sensitivity)",
    color = "Folds der Kreuzvalidierung"
  ) +  theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=12), 
        axis.text.x = element_text(size=8), 
        axis.text.y = element_text(size=9), 
        legend.text = element_text(size=12), 
        legend.title = element_text(size=20),
        legend.position = "right",
        plot.title = element_text(size=25, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18))



ggsave(
  "plots/roc_plot.jpg",
  plot = roc_plot, height= 8, width=13)

```



####Random Forest
```{r}
#Test of random forest, because this method can take class imbalances better into account
#Specifiying the model
rf_spec <- rand_forest(
  mtry = tune(),
  trees = tune(),
  min_n = tune()
) %>%
  set_mode("classification") %>%
  set_engine("ranger")


#Defining the workflow
rf_workflow <-
  workflow() |>
  add_recipe(recipe) |>
  add_model(rf_spec)


#Tuning the hyperparameters (parallel processing enabled)
doParallel::registerDoParallel()

set.seed(345)
rf_tune <- tune_grid(
  rf_workflow,
  resamples = df_folds,
  grid = 50
)
rf_tune



#Inspecting the performance of the different tuning models
rf_tune |> collect_metrics()
rf_tune |> show_best("roc_auc") #better metric
rf_tune |> show_best("accuracy")
rf_tune |> select_best("roc_auc")
rf_tune |> select_best("accuracy")


# Select best roc_auc
rf_final <- rf_workflow |>
  finalize_workflow(parameters = rf_tune |> select_best("roc_auc")) #we feed in the best penalty value


# Out-of-sample prediction (test set)
rf_last_fit <- rf_final |>
  last_fit(split = df_training_split)
```


#####Performance-Checking
```{r}
#Obtain test performance
rf_last_fit |>
  collect_metrics()

#Create the confusion matrix
conf_mat <- rf_last_fit |>
  collect_predictions() |>
  conf_mat(truth = company_sector, estimate = .pred_class)

# Plot the confusion matrix
conf_mat |> autoplot(type = "heatmap")
conf_mat |> autoplot(type = "mosaic")

#Create a table of the performance metrics
conf_mat |>
  summary() |>
  select(Metric = .metric, Estimate = .estimate) |>
  filter(Metric %in% c("accuracy", "sens", "spec", "precision", "recall", "f_meas")) |>
  mutate(
    Metric = factor(Metric,
      levels = c("f_meas", "accuracy", "precision", "recall", "sens", "spec"),
      labels = c("F1 Score", "Accuracy", "Precision", "Recall", "Sensitivity", "Specificity")
    )
  ) |>
  arrange(Metric) |>
  gt() |>
  cols_align("left") |>
  fmt_number(columns = 2, decimals = 2) |>
  tab_header(title = "Test Set Classification Performance Metrics")

```


####Boosted Trees with Lightgbm
```{r}
#LightGBM
#Model specification
lightgbm_spec <- boost_tree(
  tree_depth = tune(),
  trees = tune(),
  learn_rate = tune(),
  min_n = tune(),
  loss_reduction = tune()
) |>
  set_mode("classification") |>
  set_engine("lightgbm")

lightgbm_workflow <-
  workflow() |>
  add_recipe(recipe) |>
  add_model(lightgbm_spec)

# Tune models
tic()
set.seed(1234)
lightgbm_tune <- lightgbm_workflow |>
  tune_grid(
    resamples = df_folds,
    grid = 100
  )
toc()


#Define model specification and workflow for LIGHTGBM
lightgbm_spec <- boost_tree(
  tree_depth = tune(),
  trees = tune(),
  learn_rate = tune(),
  mtry = tune(),
  min_n = tune(),
  loss_reduction = tune()
) |>
  set_mode("classification") |>
  set_engine("lightgbm")

#Specify the workflow
lightgbm_workflow <-
  workflow() |>
  add_recipe(recipe) |>
  add_model(lightgbm_spec)

#Tune models
set.seed(1234)
lightgbm_tune <- lightgbm_workflow |>
  tune_grid(
    resamples = df_folds,
    grid = 3
  )


#Save tuning results
lightgbm_tune |>
  write_rds(paste0("classifier/LightGBM-fitted-model-", format(Sys.time(), "%Y-%m-%d-%H-%M-%S"), ".rds"))

#Retrieve the saved tuning results
lightgbm_tune_retrieved <- read_rds("classifier/LightGBM-fitted-model-2023-07-10-21-45-00.rds")

#Show tuning results
lightgbm_tune_retrieved |>
  autoplot() +
  labs(title = "Tuning Results of Predicting Stance with LightGBM Multiclass Classification") +
  theme_minimal()

#Select best model
lightgbm_final <- lightgbm_workflow |>
  finalize_workflow(parameters = lightgbm_tune_retrieved |> select_best("roc_auc"))

#Fit best model and predict on test set
tic()
lightgbm_last_fit <- lightgbm_final |>
  last_fit(split = df_training_split)
toc() 
```


#####Performance checking
```{r}
#Obtain performance on test set
lightgbm_last_fit |> collect_metrics()

#Create confusion matrix
conf_mat <- lightgbm_last_fit |>
  collect_predictions() |>
  conf_mat(truth = company_sector, estimate = .pred_class)

conf_mat |> autoplot(type = "heatmap")

ggsave(
  filename = "Figures/Figure-LightGBM-confusion-matrix.pdf",
  width = 8, height = 6
)

#Create table of performance metrics
conf_mat |>
  summary() |>
  select(Metric = .metric, Estimate = .estimate) |>
  filter(Metric %in% c("accuracy", "sens", "spec", "precision", "f_meas")) |>
  mutate(
    Metric = factor(
      Metric,
      levels = c("f_meas", "accuracy", "sens", "spec", "precision"),
      labels = c("F1 Score", "Accuracy", "Sensitivity", "Specificity", "Precision")
    )
  ) |>
  arrange(Metric) |>
  kableExtra::kbl(
    format = "latex",
    caption = "Performance of LightGBM Multiclass Classification Model",
    label = "LightGBM-performance",
    digits = 2
  )

```



##Step 4: Out-of-Sample Prediction
This code chunks applies the best machine learning model to the whole dataset of 2022
```{r}
#Training the model on full labeled training data using the best tuned hyperparameters
elastic_fit <- elastic_final |>
  fit(df_training)
elastic_fit

#Create dataset with unannotated Zweck-Texte
firmengründungen2022 <- readRDS("dataframes/Firmengründungen2022.rds")
df_nozweckna <- readRDS("handcoding/df_nozweckna.rds")

fg22_zwecke <- firmengründungen2022 |> mutate(
  indicator = case_when(
  id %in% df_training$id ~ 1,
  T ~ 0)
) |> filter(indicator == 0)

#Adding back in the translated zweck column
fg22_zwecke <- left_join(fg22_zwecke, df_nozweckna[,c(1,38)], by = c("id" = "id"))


#Cleaning the Zweck column the same way as was done for the training of the classifier
fg22_zwecke <- fg22_zwecke |> mutate(
  
    zweck_cleaned2 = ifelse(str_detect(zweck_cleaned, "(?i)(?<=Die Gesellschaft kann|Das Einzelunternehmen kann|Kann Zweigniederlassungen und Tochtergesellschaften|Zweig- oder Tochtergesellschaften im In- und Ausland errichten|Sie kann Zweigniederlassungen|Sie kann Agenturen|Sie kann Tochtergesellschaften|Im Allgemeinen darf die Gesellschaft|Im Allgemeinen darf das Einzelunternehmen|Zu diesem Zweck kann die Gesellschaft|Zu diesem Zweck kann das Einzelunternehmen|Die Gesellschaft kann alle Geschäfte tätigen|Das Einzelunternehmen kann alle Geschäftige tätigen|Die Gesellschaft darf|Das Einzelunternehmen darf|Die Stiftung kann|Die Stiftung darf|Die Genossenschaft kann|Die Genossenschaft darf|Publikationsorgan: Schweizerisches Handelsamtsblatt|Publikationsorgan: SHAB|Darüber hinaus kann die Gesellschaft|Darüber hinaus kann das Einzelunternehmen|Darüber hinaus kann die Genossenschaft|Darüber hinaus kann die Stiftung|Das Unternehmen kann|Das Unternehmen darf|Mit Ausnahme der durch das Bundesgesetz über den Erwerb von Grundstücken durch Personen im Ausland (LFAIE) verbotenen Geschäfte|Kann Zweigniederlassungen errichten|Kann Tochterunternehmen errichten|Die Firma kann|Die Firma darf|Aktienkapital: CHF|Die Unternehmung kann|Die Unternehmung darf).*"),
                                 str_replace(zweck_cleaned, "(?i)(Die Gesellschaft kann|Das Einzelunternehmen kann|Kann Zweigniederlassungen und Tochtergesellschaften|Zweig- oder Tochtergesellschaften im In- und Ausland errichten|Sie kann Zweigniederlassungen|Sie kann Agenturen|Sie kann Tochtergesellschaften|Im Allgemeinen darf die Gesellschaft|Im Allgemeinen darf das Einzelunternehmen|Zu diesem Zweck kann die Gesellschaft|Zu diesem Zweck kann das Einzelunternehmen|Die Gesellschaft kann alle Geschäfte tätigen|Das Einzelunternehmen kann alle Geschäftige tätigen|Die Gesellschaft darf|Das Einzelunternehmen darf|Die Stiftung kann|Die Stiftung darf|Die Genossenschaft kann|Die Genossenschaft darf|Publikationsorgan: Schweizerisches Handelsamtsblatt|Publikationsorgan: SHAB|Darüber hinaus kann die Gesellschaft|Darüber hinaus kann das Einzelunternehmen|Darüber hinaus kann die Genossenschaft|Darüber hinaus kann die Stiftung|Das Unternehmen kann|Das Unternehmen darf|Mit Ausnahme der durch das Bundesgesetz über den Erwerb von Grundstücken durch Personen im Ausland (LFAIE) verbotenen Geschäfte|Kann Zweigniederlassungen errichten|Kann Tochterunternehmen errichten|Die Firma kann|Die Firma darf|Aktienkapital: CHF|Die Unternehmung kann|Die Unternehmung darf).*", ""),
                                 zweck_cleaned),
  
  zweck_cleaned3 = str_replace_all(zweck_cleaned2, 
                                    "\\s*\\b(Die Unternehmung bezweckt|Das Unternehmen bezweckt|Die Gesellschaft bezweckt|Die Firma bezweckt|Gegenstand des Unternehmens|Unternehmensgegenstand:|Das Einzelunternehmen|Zweck des Unternehmens|Zweck der Gesellschaft|Geschäftszweck|Gegenstand des Unternehmens:|Unternehmensgegenstand:ist|Gegenstand und Zweck des Unternehmens ist|Der Zweck der Gesellschaft ist|Der Zweck des Unternehmens|Die Stiftung bezweckt|Die Stiftung will|Der Verein will|Der Verein bezweckt|Die Ziele des Unternehmens sind|Das Ziel des Unternehmens ist|bezweckt|Zweck|Unternehmensgegenstand|:)\\b\\s*",""),

  rechtsform_train = case_when(
    is.na(Rechtsform) ~ "Anderes",
    T ~ Rechtsform
  )
)


#Remove extra white spaces and :
fg22_zwecke$zweck_cleaned2 <- str_squish(fg22_zwecke$zweck_cleaned3)
fg22_zwecke$zweck_cleaned2 <- gsub(":", "", fg22_zwecke$zweck_cleaned2)


#Predict unlabeled zwecktexte
#Issue: memory limit exhausted error, need to do batch processing
#Split the dataframe into a list of smaller dataframes for batch processing

#Batch-Splitting
rownames(fg22_zwecke) <- fg22_zwecke$id
num_dfs <- ceiling(nrow(fg22_zwecke) / 49)
split_var <- rep(1:num_dfs, each = 49, length.out = nrow(fg22_zwecke))
split_list <- split(fg22_zwecke, split_var)


#Check if batching worked
#test <- bind_rows(split_list)
#test <- test |> mutate(rownames = rownames(test),
                       #indicator = ifelse(rownames == id, 1,0))
#table(test$indicator, useNA="ifany") #Everything worked


split_list |> head()
preds_list <- list()


tic()
for (i in 1:965) {
  if (i %in% seq(from = 1, to = 975, by = 100)) {
    message("Predicting Batch: ", i)
  }

  #Predict unlabeled zwecktexte
  preds_unlabelled <- elastic_fit |>
    predict(new_data = split_list[[i]])

  preds_list[[i]] <- preds_unlabelled

  rm(preds_unlabelled)
}

toc() #Took 39 Minutes

preds_fg22_zwecke <- bind_rows(preds_list)

preds_fg22_zwecke |>
  write_rds("classifier/elastic-predicted-labels.rds")

# Retrieve saved predictions
preds_fg22_zwecke_ret <-
  read_rds("classifier/elastic-predicted-labels.rds")

View(preds_fg22_zwecke_ret$.pred_class)

#Merge predicted labels with full dataset
fg22_zwecke_classified <- fg22_zwecke |>
  bind_cols(preds_fg22_zwecke_ret) |>
  rename(company_sector = .pred_class) |> mutate(sample = 0)
fg22_zwecke_classified


#Adding in sample-indicator and adding everything to the Firmengründungen2022 dataset
df_sample <- df_training

Firmengründungen2022 <- readRDS("dataframes/Firmengründungen2022.rds")

Firmengründungen2022_classified2 <- left_join(Firmengründungen2022, fg22_zwecke_classified)

#Imputing values for sample through the id-variable because dplyr::left_join did fail for some reason
Firmengründungen2022_classified2 <- Firmengründungen2022_classified2 |> mutate(
  sample = ifelse(is.na(sample), 1, sample)
)

Firmengründungen2022_classified2$company_sector[is.na(Firmengründungen2022_classified2$company_sector)] <-
  df_sample$company_sector[match(
    Firmengründungen2022_classified2$id[is.na(Firmengründungen2022_classified2$company_sector)],
    df_sample$id
  )]


Firmengründungen2022_classified2$zweck_cleaned2[is.na(Firmengründungen2022_classified2$zweck_cleaned2)] <-
  df_sample$zweck_cleaned2[match(
    Firmengründungen2022_classified2$id[is.na(Firmengründungen2022_classified2$zweck_cleaned2)],
    df_sample$id
  )]


#Save dataset with predictions
write_rds(Firmengründungen2022_classified2, "classifier/Firmengründungen2022_classified.rds")
```



##Step 5: Plots
Finally this code chunks creates all the different plots with "Wirtschaftszweige" that are presented in the study using the sample and the fully classified dataset
```{r}
fg22_class <- readRDS("classifier/Firmengründungen2022_classified.rds")
conflicts_prefer(dplyr::summarize)

#Recoding for plots
fg22_class <- fg22_class|> mutate(
  company_sector2 = factor(case_when(
                          company_sector == "2 Verarbeitendes Gewerbe/Energieversorgung" ~ "Landwirtschaft/Verarbeitendes Gewerbe/Energieversorgung",
                          company_sector == "3 Baugewerbe" ~ "Baugewerbe",
                          company_sector == "4 Handel, Reparaturgewerbe" ~ "Handel, Reparaturgewerbe",
                          company_sector == "5 Verkehr und Lagerei" ~ "Verkehr und Lagerei",
                          company_sector == "6 Gastgewerbe" ~ "Gastgewerbe",
                          company_sector == "7 Information und Kommunikation" ~ "Information und Kommunikation",
                          company_sector == "8 Kredit- und Versicherungsgewerbe" ~ "Kredit- und Versicherungsgewerbe",
                          company_sector == "9 Immobilien, sonstige wirtschaftliche Dienstleistungen" ~ "Immobilien, sonstige wirtschaftliche Dienstleistungen",
                          company_sector == "10 Freiberufliche, wissenschaftliche und technische Dienstleistungen" ~ "Freiberufliche, wissenschaftliche und technische Dienstleistungen",
                          company_sector == "12 Erziehung und Unterricht" ~ "Erziehung und Unterricht",
                          company_sector == "13 Gesundheits- und Sozialwesen" ~ "Gesundheits- und Sozialwesen",
                          company_sector == "14 Kunst und Unterhaltung" ~ "Kunst und Unterhaltung",
                          company_sector == "15 Sonstige und persönliche Dienstleistungen, Unterhaltung, sowie private Haushalte" ~ "Sonstige und persönliche Dienstleistungen/private Haushalte",
                          T ~ NA_character_
                                       ), levels = c("Landwirtschaft/Verarbeitendes Gewerbe/Energieversorgung", "Baugewerbe", "Handel, Reparaturgewerbe", "Verkehr und Lagerei", "Gastgewerbe","Information und Kommunikation", "Kredit- und Versicherungsgewerbe", "Immobilien, sonstige wirtschaftliche Dienstleistungen", "Freiberufliche, wissenschaftliche und technische Dienstleistungen", "Erziehung und Unterricht", "Gesundheits- und Sozialwesen","Kunst und Unterhaltung", "Sonstige und persönliche Dienstleistungen/private Haushalte")),
  company_sector2 = fct_relevel(company_sector2, 
            "Sonstige und persönliche Dienstleistungen/private Haushalte", "Kunst und Unterhaltung",  "Gesundheits- und Sozialwesen", "Erziehung und Unterricht",  "Freiberufliche, wissenschaftliche und technische Dienstleistungen", "Immobilien, sonstige wirtschaftliche Dienstleistungen", "Kredit- und Versicherungsgewerbe", "Information und Kommunikation", "Gastgewerbe", "Verkehr und Lagerei", "Handel, Reparaturgewerbe", "Baugewerbe", "Landwirtschaft/Verarbeitendes Gewerbe/Energieversorgung"),
  
  Rechtsform2 = factor(case_when(
  Rechtsform == "AG" ~ "AG",
  Rechtsform == "GmbH" ~ "GmbH",
  Rechtsform == "Einzelunternehmen" ~ "Einzelfirmen",
  T ~ "Andere Formen"), levels = c("AG", "GmbH", "Einzelfirmen", "Andere Formen"))
    
)



#Plots with AG's
#Sample-plot
fg22_sample <- fg22_class |> filter(sample == 1)

#Check if imputation in previous code-chunk worked correctly
#fg22_sample_test <- fg22_sample |> select(id, company_sector)
#df_sample_test <- df_sample |> select(id, company_sector) |> filter(id %in% Firmengründungen2022$id)
#table(fg22_sample_test$company_sector)
#table(df_sample_test$company_sector)
#Everything worked correctly, the observations are indeed indentical

#Creating percentages
fg22_sample_sector <- fg22_sample |> group_by(company_sector2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)


#Plot
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer",
                   "Schweizer und Ausländer" = "Schweizer & Ausländer zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer")

sectors_sample_plot <- ggplot(data=fg22_sample_sector, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),      
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Sample, n=982)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + scale_x_continuous(labels = scales::percent)
sectors_sample_plot


ggsave(
  "plots/sectors_sample_plot.jpg",
  plot = sectors_sample_plot, height= 8, width=12)



#Full dataset
fg22_sector <- fg22_class|> group_by(company_sector2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)

#Plot
sectors_full_plot <- ggplot(data=fg22_sector, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),      
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Alle Beobachtungen, n=48224)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + scale_x_continuous(labels = scales::percent)
sectors_full_plot

ggsave(
  "plots/sectors_full_plot.jpg",
  plot = sectors_full_plot, height= 8, width=12)




#Sectors + Form
#Sample
#Creating percentages
fg22_sample_sector2 <- fg22_sample |> group_by(company_sector2, Rechtsform2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)


sectors_sample_plot2 <- ggplot(data=fg22_sample_sector2, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),
        strip.text.x = element_text(size=15.75),
        axis.text.x = element_text(size=13, angle=45, hjust=1), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Sample, n=982)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + facet_grid(~ Rechtsform2) + scale_x_continuous(labels = scales::percent)
sectors_sample_plot2


ggsave(
  "plots/sectors_sample_plot_rechtsformen.jpg",
  plot = sectors_sample_plot2, height= 8, width=12)




#Full
fg22_sector2 <- fg22_class |> group_by(company_sector2, Rechtsform2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)


sectors_full_plot2 <- ggplot(data=fg22_sector2, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),
        strip.text.x = element_text(size=15.75),
        axis.text.x = element_text(size=13, angle=45, hjust=1), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Alle Beobachtungen, n=48224)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + facet_grid(~ Rechtsform2) + scale_x_continuous(labels = scales::percent)
sectors_full_plot2


ggsave(
  "plots/sectors_full_plot_rechtsformen.jpg",
  plot = sectors_full_plot2, height= 8, width=12)



#Branch Occurence-Plot
table(fg22_class$sample)
fg22_sector_occ <- fg22_class |> group_by(company_sector2, sample) |> summarize(
  n = n()) |> mutate(n_allsectors = ifelse(sample == 1, 982, 47242),
                     sample = case_when(sample == 1 ~ "Sample", sample == 0 ~ "Ml-Classified"),
                     perc = n/n_allsectors)


sectors_occurence <- ggplot(data=fg22_sector_occ, aes(x = perc, y = company_sector2, fill = sample)) + geom_bar(position="dodge", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        plot.title = element_text(size=20, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen", x = "", y = "Wirtschaftszweige",fill = "Anteile in:") +
  scale_fill_manual(labels = c("automatisch klassifizierten Beobachtungen", "manuell klassifiziertem Sample"), values = c("#0028A5","#A5B5D9")) + scale_x_continuous(labels = scales::percent) +
  scale_y_discrete(labels = function(labels) str_wrap(labels, width = 50)) + guides(fill = guide_legend(nrow = 2)) 
sectors_occurence


ggsave(
  "plots/sectors_occurence.jpg",
  plot = sectors_occurence, height= 8, width=12)








#Plots without AG's
#Sample-plot
fg22_sample_oag <- fg22_class |> filter(sample == 1) |> filter(Rechtsform2 != "AG" | is.na(Rechtsform2))


#Creating percentages
fg22_sample_sector <- fg22_sample_oag |> group_by(company_sector2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)


#Plot
custom_labels <- c("Ausländer" = "einen oder mehrere Ausländer",
                   "Schweizer und Ausländer" = "Schweizer & Ausländer zusammen",
                   "Schweizer" = "einen oder mehrere Schweizer")

sectors_sample_plot_oag <- ggplot(data=fg22_sample_sector, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),      
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Sample ohne AG's, n=791)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + scale_x_continuous(labels = scales::percent)
sectors_sample_plot


ggsave(
  "plots/sectors_sample_plot_oag.jpg",
  plot = sectors_sample_plot_oag, height= 8, width=12)



#Full dataset
fg22_class_oag <- fg22_class |> filter(Rechtsform2 != "AG" | is.na(Rechtsform2))
fg22_sector <- fg22_class_oag|> group_by(company_sector2, Staatsbürgerschaft2) |> summarize(
  n = n()) |> mutate(n_sector = sum(n),
                     perc = n/n_sector)

#Plot
sectors_full_plot_oag<- ggplot(data=fg22_sector, aes(x = perc, y = company_sector2, fill = Staatsbürgerschaft2)) + geom_bar(position="stack", stat="identity") +  
  theme_minimal() + theme(
        text = element_text(family = "Times New Roman"),      
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        legend.justification = "right",
        plot.title = element_text(size=20, face="bold"),
        plot.title.position = "plot",
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (Alle Beobachtungen ohne AG's, n=38419)", x = "", y = "Wirtschaftszweige",fill = "Neugründungen durch:") +
  scale_fill_manual(values = c("Ausländer" = "#0028A5",
                               "Schweizer und Ausländer" = "#A5B5D9",
                               "Schweizer" = "#F1977A"),
                    labels = custom_labels) + scale_x_continuous(labels = scales::percent)
sectors_full_plot_oag

ggsave(
  "plots/sectors_full_plot_oag.jpg",
  plot = sectors_full_plot_oag, height= 8, width=12)


#Branch Occurence-Plot without AG's
table(fg22_class_oag$sample)
fg22_sector_occ <- fg22_class_oag |> group_by(company_sector2, sample) |> summarize(
  n = n()) |> mutate(n_allsectors = ifelse(sample == 1, 791,37628),
                     sample = case_when(sample == 1 ~ "Sample", sample == 0 ~ "Ml-Classified"),
                     perc = n/n_allsectors)


sectors_occurence_oag <- ggplot(data=fg22_sector_occ, aes(x = perc, y = company_sector2, fill = sample)) + geom_bar(position="dodge", stat="identity") +  
  theme_minimal() +   theme(
        text = element_text(family = "Times New Roman"),      
        strip.text.x = element_text(size=7), 
        axis.text.x = element_text(size=16), 
        axis.text.y = element_text(size=16), 
        legend.text = element_text(size=15), 
        legend.title = element_text(size=15),
        legend.position = "bottom",
        plot.title = element_text(size=18, face="bold"),
        plot.subtitle = element_text(size=15),
        axis.title = element_text(size=18)) +
  labs(title = "Anteil an Neugründungen nach Wirtschaftszweigen (ohne AG's)", x = "", y = "Wirtschaftszweige",fill = "Anteile in:") +
  scale_fill_manual(labels = c("automatisch klassifizierten Beobachtungen", "manuell klassifiziertem Sample"), values = c("#0028A5","#A5B5D9")) + scale_x_continuous(labels = scales::percent) +
  scale_y_discrete(labels = function(labels) str_wrap(labels, width = 50)) + guides(fill = guide_legend(nrow = 2)) 
sectors_occurence


ggsave(
  "plots/sectors_occurence_oag.jpg",
  plot = sectors_occurence_oag, height= 8, width=12)

```



#Final saving of datasets
```{r}
#rds
write_rds(Firmengründungen2022_classified2, "finaldata/Firmengründungen2022_classified.rds")
write_rds(Firmengründungen2022, "finaldata/Firmengründungen2022.rds")
write_rds(Firmengründungen2021, "finaldata/Firmengründungen2021.rds")
write_rds(Firmengründungen2020, "finaldata/Firmengründungen2020.rds")
write_rds(Firmengründungen2019, "finaldata/Firmengründungen2019.rds")

#csv
write.csv(Firmengründungen2022_classified2, "finaldata/Firmengründungen2022_classified.csv", row.names=FALSE)
write.csv(Firmengründungen2022, "finaldata/Firmengründungen2022.csv", row.names=FALSE)
write.csv(Firmengründungen2021, "finaldata/Firmengründungen2021.csv", row.names=FALSE)
write.csv(Firmengründungen2020, "finaldata/Firmengründungen2020.csv", row.names=FALSE)
write.csv(Firmengründungen2019, "finaldata/Firmengründungen2019.csv", row.names=FALSE)

```






